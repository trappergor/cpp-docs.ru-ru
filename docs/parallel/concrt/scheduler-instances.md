---
title: Экземпляры планировщика | Документация Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-concrt
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- scheduler instances
ms.assetid: 4819365f-ef99-49cc-963e-50a2a35a8d6b
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: fc11888c3f655572bbdf33a5238e07f8ef99ba90
ms.sourcegitcommit: 799f9b976623a375203ad8b2ad5147bd6a2212f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/19/2018
ms.locfileid: "46375658"
---
# <a name="scheduler-instances"></a>Экземпляры планировщика

В этом документе описывается роль экземпляров планировщика в среде выполнения с параллелизмом и способы использования [concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) и [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) классы для создания и управления ими экземпляры планировщика. Экземпляры планировщика полезны в тех случаях, когда требуется связать явные политики планирования с определенными типами рабочих нагрузок. Например, можно создать один экземпляр планировщика для выполнения некоторых задач с повышенным приоритетом потока и использовать планировщик по умолчанию для выполнения задач с обычным приоритетом потока.

> [!TIP]
>  Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, и таким образом не требуется создавать планировщик в приложении. Поскольку планировщик задач помогает оптимизировать производительность приложений, мы рекомендуем начать с [библиотеки параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) или [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) при наличии создать среду выполнения с параллелизмом.

##  <a name="top"></a> Разделы

- [Планировщик и классы CurrentScheduler](#classes)

- [Создание экземпляра планировщика](#creating)

- [Управление временем существования экземпляра планировщика](#managing)

- [Методы и функции](#features)

- [Пример](#example)

##  <a name="classes"></a> Планировщик и классы CurrentScheduler

Планировщик задач позволяет приложениям использовать один или несколько *экземпляры планировщика* для планирования работы. [Concurrency::Scheduler](../../parallel/concrt/reference/scheduler-class.md) класс представляет экземпляр планировщика и содержит функциональные возможности, связанные с планированием задач.

Поток, который присоединяется к планировщика называется *контекст выполнения*, или просто *контекст*. В любое время может быть активными в текущем контексте один планировщик. Активный планировщик также называется *текущего планировщика*. Среда выполнения с параллелизмом использует [concurrency::CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) класс для предоставления доступа к текущему планировщику. Текущий планировщик для одного контекста может отличаться от текущего планировщика для другого контекста. Среда выполнения не поддерживает уровень процесса представлением текущего планировщика.

Как правило `CurrentScheduler` класс используется для доступа к текущему планировщику. `Scheduler` Класс может быть полезен, если вам нужно управлять планировщиком, не является текущим.

В следующих разделах рассматривается создание и управление экземпляром планировщика. Полный пример, иллюстрирующий эти задачи, см. в разделе [как: управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md).

[[В начало](#top)]

##  <a name="creating"></a> Создание экземпляра планировщика

Существует три способа создания `Scheduler` объекта:

- Если планировщика не существует, среда выполнения создает планировщик по умолчанию, при использовании функции среды выполнения, например, параллельный алгоритм, для выполнения работы. Планировщик по умолчанию становится текущим планировщиком для контекста, который инициирует параллельную работу.

- [Concurrency::CurrentScheduler:: CREATE](reference/currentscheduler-class.md#create) метод создает `Scheduler` , использующий конкретную политику и связывающий этот планировщик с текущим контекстом.

- [Concurrency::Scheduler:: CREATE](reference/scheduler-class.md#create) метод создает `Scheduler` объект, использующий конкретную политику, но не связывает его с текущим контекстом.

Среде выполнения для создания планировщика по умолчанию включает все параллельные задачи могут совместно использовать тот же планировщик. Обычно функциональные возможности, предоставляемые [библиотеку параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL) или [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) используется для выполнения параллельной работы. Таким образом у вас нет работать непосредственно с планировщиком, чтобы контролировать политику или время существования. При использовании PPL или Библиотека агентов, среда выполнения создает планировщик по умолчанию, если он не существует и делает его текущим планировщиком для каждого контекста. При создании планировщика и задать его в качестве текущего планировщика, среда выполнения использует этот планировщик для планирования задач. Создайте дополнительные экземпляры планировщика, только в том случае, когда требуется определенная политика планирования. Дополнительные сведения о политиках, которые связаны с планировщиком, см. в разделе [политики планировщика](../../parallel/concrt/scheduler-policies.md).

[[В начало](#top)]

##  <a name="managing"></a> Управление временем существования экземпляра планировщика

Среда выполнения использует механизм подсчета ссылок для управления временем существования `Scheduler` объектов.

При использовании `CurrentScheduler::Create` метод или `Scheduler::Create` метод для создания `Scheduler` объекта, среда выполнения задает начальное число ссылок этот планировщик на один. Среда выполнения увеличивает счетчик ссылок при вызове [Concurrency::Scheduler:: Attach](reference/scheduler-class.md#attach) метод. `Scheduler::Attach` Связывает метод `Scheduler` объект с текущим контекстом. Это делает текущего планировщика. При вызове `CurrentScheduler::Create` метод, среда выполнения создает `Scheduler` и присоединяет его к текущему контексту (и устанавливает счетчик ссылок на один). Можно также использовать [Concurrency::Scheduler:: Reference](reference/scheduler-class.md#reference) метод для увеличения значения счетчика ссылок `Scheduler` объекта.

Среда выполнения уменьшает счетчик ссылок при вызове [Concurrency::CurrentScheduler:: Detach](reference/currentscheduler-class.md#detach) метод для отсоединения текущего планировщика или вызвать [Concurrency::Scheduler:: Release](reference/scheduler-class.md#release) метод. Когда число ссылок достигает нуля, среда выполнения уничтожает `Scheduler` объект после завершения всех запланированных задач. Выполняемая задача может приращение счетчика ссылок текущего планировщика. Таким образом, если число ссылок достигает нуля, и задача увеличивает счетчик ссылок, среда выполнения не уничтожает `Scheduler` объект пока еще раз, число ссылок достигает нуля, и завершения всех задач.

Среда выполнения сохраняет внутренний стек `Scheduler` объекты для каждого контекста. При вызове `Scheduler::Attach` или `CurrentScheduler::Create` метода, среда выполнения отправлений `Scheduler` объект в стек для текущего контекста. Это делает текущего планировщика. При вызове `CurrentScheduler::Detach`, среда выполнения извлекает текущий планировщик из стека для текущего контекста и задает в качестве текущего планировщика предыдущий.

Среда выполнения предоставляет несколько способов управления временем существования экземпляра планировщика. Следующей таблице показан соответствующий метод, который освобождает или отсоединяется планировщика из текущего контекста для каждого метода, который создает и присоединяет к текущему контексту планировщика.

|Создать или присоединить метод|Метод освобождения или отсоединения|
|-----------------------------|------------------------------|
|`CurrentScheduler::Create`|`CurrentScheduler::Detach`|
|`Scheduler::Create`|`Scheduler::Release`|
|`Scheduler::Attach`|`CurrentScheduler::Detach`|
|`Scheduler::Reference`|`Scheduler::Release`|

Вызов неподходящего выпуска или отсоединить метод создает незаданное поведение в среде выполнения.

При использовании функций, например, PPL, которая заставляет среду выполнения создавать планировщик по умолчанию, не освобождения или отсоединения данным планировщиком. Среда выполнения управляет временем существования любой планировщик, который он создает.

Так как среда выполнения не уничтожает `Scheduler` объекта до завершения всех задач, можно использовать [Concurrency::Scheduler:: registershutdownevent](reference/scheduler-class.md#registershutdownevent) метод или [concurrency::CurrentScheduler:: RegisterShutdownEvent](reference/currentscheduler-class.md#registershutdownevent) метод, чтобы получать уведомления при `Scheduler` уничтожении объекта. Это полезно, если необходимо подождать для каждой задачи, запланированной `Scheduler` объекта до конца.

[[В начало](#top)]

##  <a name="features"></a> Методы и функции

В этом разделе перечислены важные методы `CurrentScheduler` и `Scheduler` классы.

Можно рассматривать `CurrentScheduler` класс как вспомогательное средство для создания планировщика для использования в текущем контексте. `Scheduler` Класс позволяет контролировать планировщик, принадлежащий к другому контексту.

В следующей таблице показаны важные методы, которые определяются `CurrentScheduler` класса.

|Метод|Описание|
|------------|-----------------|
|[Создание](reference/currentscheduler-class.md#create)|Создает `Scheduler` объект, который использует заданную политику и связывает его с текущим контекстом.|
|[Get](reference/currentscheduler-class.md#get)|Извлекает указатель на `Scheduler` объект, связанный с текущим контекстом. Этот метод не увеличивает число ссылок `Scheduler` объекта.|
|[Detach](reference/currentscheduler-class.md#detach)|Отсоединяет текущий планировщик из текущего контекста и задает в качестве текущего планировщика предыдущий.|
|[RegisterShutdownEvent](reference/currentscheduler-class.md#registershutdownevent)|Регистрирует событие, которое среда выполнения задает при уничтожении текущего планировщика.|
|[CreateScheduleGroup](reference/currentscheduler-class.md#createschedulegroup)|Создает [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) объекта в текущем планировщике.|
|[ScheduleTask](reference/currentscheduler-class.md#scheduletask)|Добавляет упрощенной задачи в очередь планирования текущего планировщика.|
|[GetPolicy](reference/currentscheduler-class.md#getpolicy)|Извлекает копию политики, который связан с текущего планировщика.|

В следующей таблице показаны важные методы, которые определяются `Scheduler` класса.

|Метод|Описание|
|------------|-----------------|
|[Создание](reference/scheduler-class.md#create)|Создает `Scheduler` объект, который использует указанную политику.|
|[Attach](reference/scheduler-class.md#attach)|Связывает `Scheduler` объект с текущим контекстом.|
|[Ссылки](reference/scheduler-class.md#reference)|Увеличивает счетчик ссылок из `Scheduler` объекта.|
|[Релиз](reference/scheduler-class.md#release)|Уменьшает счетчик ссылок из `Scheduler` объекта.|
|[RegisterShutdownEvent](reference/scheduler-class.md#registershutdownevent)|Регистрирует событие, которое среда выполнения задает, когда `Scheduler` уничтожении объекта.|
|[CreateScheduleGroup](reference/scheduler-class.md#createschedulegroup)|Создает [concurrency::ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) объекта в `Scheduler` объекта.|
|[ScheduleTask](reference/scheduler-class.md#scheduletask)|Планирует упрощенной задачи из `Scheduler` объекта.|
|[GetPolicy](reference/scheduler-class.md#getpolicy)|Извлекает копию политики, связанные с `Scheduler` объекта.|
|[SetDefaultSchedulerPolicy](reference/scheduler-class.md#setdefaultschedulerpolicy)|Задает политику для среды выполнения для использования при создании планировщик по умолчанию.|
|[ResetDefaultSchedulerPolicy](reference/scheduler-class.md#resetdefaultschedulerpolicy)|Восстанавливает политику по умолчанию, который был активным перед вызовом `SetDefaultSchedulerPolicy`. Если планировщик по умолчанию создается после этого вызова, среда выполнения использует параметры политики по умолчанию для создания планировщика.|

[[В начало](#top)]

##  <a name="example"></a> Пример

Простые примеры того, как создание и управление экземпляром планировщика см. в разделе [как: управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md).

## <a name="see-also"></a>См. также

[Планировщик задач](../../parallel/concrt/task-scheduler-concurrency-runtime.md)<br/>
[Практическое руководство. Управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)<br/>
[Политики планировщика](../../parallel/concrt/scheduler-policies.md)<br/>
[Группы планирования](../../parallel/concrt/schedule-groups.md)

