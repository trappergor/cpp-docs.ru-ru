---
title: Использование dllimport и dllexport в классах C++ | Документация Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-language
ms.topic: language-reference
dev_langs:
- C++
helpviewer_keywords:
- exporting classes [C++]
- declarations [C++], class
- exportable classes [C++]
- classes [C++], declaring
- classes [C++], exportable and inheritance
- inheritance [C++], exportable classes [C++]
- dllimport attribute [C++], classes
- declaring classes [C++]
- dllexport attribute [C++]
- dllexport attribute [C++], classes [C++]
ms.assetid: 8d7d1303-b9e9-47ca-96cc-67bf444a08a9
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: fe1454ee615f489190ec455adabcd4bdecb4e0f0
ms.sourcegitcommit: 51f804005b8d921468775a0316de52ad39b77c3e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/02/2018
ms.locfileid: "39460824"
---
# <a name="using-dllimport-and-dllexport-in-c-classes"></a>Использование dllimport и dllexport в классах C++
## <a name="microsoft-specific"></a>Блок, относящийся только к системам Microsoft  
 Можно объявить классы C++ с **dllimport** или **dllexport** атрибута. Эти формы подразумевают, что импортирован или экспортирован весь класс. Классы, которые можно экспортировать таким образом, называются экспортируемыми классами.  
  
 В следующем примере определяется экспортируемый класс. Экспортируются все его функции-члены и статические данные.  
  
```cpp 
#define DllExport   __declspec( dllexport )  
  
class DllExport C {  
   int i;  
   virtual int func( void ) { return 1; }  
};  
```  
  
 Обратите внимание, что явное использование **dllimport** и **dllexport** атрибуты в членах экспортируемого класса запрещено.  
  
##  <a name="_pluslang_using_dllimport_and_dllexport_in_c2b2bdllexportclasses"></a> Классы dllexport  
 При объявлении класса **dllexport**, экспортируются все его функции-члены и статические данные-члены. Необходимо предоставить определения всех таких членов в одной программе. В противном случае возникает ошибка компоновщика. Единственным исключением из этого правила являются чистые виртуальные функции, для которых не требуется предоставлять явные определения. Однако, поскольку деструктор абстрактного класса всегда вызывается деструктором базового класса, чистые виртуальные деструкторы должны всегда предоставлять определение. Обратите внимание, что те же правила применяются и к неэкспортируемым классам.  
  
 При экспорте данных типа класса или функций, которые возвращают классы, не забудьте экспортировать класс.  
  
##  <a name="_pluslang_dllexport_classesdllexportclasses"></a> Классы dllimport  
 При объявлении класса **dllimport**, импортируются все его функции-члены и статические данные-члены. В отличие от **dllimport** и **dllexport** в неклассовых типах, статические данные-члены невозможно указать определение в той же программе, в котором **dllimport** класс определен.  
  
##  <a name="_pluslang_using_dllimport_and_dllexport_in_c2b2binheritanceandexportableclasses"></a> Наследование и экспортируемые классы  
 Все базовые классы экспортируемого класса должны быть экспортируемыми. В противном случае создается предупреждение компилятора. Кроме того, все доступные члены, которые также являются классами, должны быть доступными для экспорта. Это правило позволяет **dllexport** наследование из класса **dllimport** класса и **dllimport** наследование из класса **dllexport** класс (хотя последнее не рекомендуется). Как правило, все, что доступно клиенту библиотеки DLL (в соответствии с правилами доступа C++), должно быть частью экспортируемого интерфейса. Сюда входят закрытые данные-члены, на которые ссылаются встраиваемые функции.  
  
##  <a name="_pluslang_using_dllimport_and_dllexport_in_c2b2bselectivememberimportexport"></a> Выборочный Импорт и экспорт членов  
 Так как функции-члены и статические данные в классе неявно имеют внешнюю компоновку, можно объявить их с помощью **dllimport** или **dllexport** атрибута, если не экспортируется весь класс. Если импортируется или экспортируется, явное объявление функции-члены и данные в виде весь класс **dllimport** или **dllexport** запрещено. Если вы объявите статические данные-член в определении класса как **dllexport**, определение должно быть выполнено в той же программе (как и в случае внешней неклассовой компоновки).  
  
 Аналогичным образом можно объявить член функции с **dllimport** или **dllexport** атрибуты. В этом случае необходимо предоставить **dllexport** определение где-нибудь в одной программе.  
  
 Обратите внимание на несколько важных аспектов выборочного импорта и экспорта членов.  
  
-   Выборочный импорт и экспорт членов рекомендуется использовать для предоставления версии экспортированного интерфейса класса, который является более ограничивающим, то есть для которого можно разработать библиотеку DLL, предоставляющую меньше открытых и закрытых компонентов, чем разрешил бы язык. Кроме того, это может пригодиться для точной настройки экспортируемого интерфейса: если известно, что клиент по определению не может получить доступ к некоторым закрытым данным, не требуется экспортировать целый класс.  
  
-   При экспорте одной виртуальной функции в классе необходимо экспортировать все функции или хотя бы предоставить версии, которые клиент может использовать напрямую.  
  
-   Если имеется класс, в котором используется выборочный импорт и экспорт членов с виртуальными функциями, функции должны быть расположены в экспортируемом интерфейсе или определены встроенным образом (видимым клиенту).  
  
-   Если вы член определяется как **dllexport** , но не включайте его в определении класса, выдается ошибка компилятора. Необходимо определить член в заголовке класса.  
  
-   Хотя определение членов класса как **dllimport** или **dllexport** — допускается, невозможно переопределить интерфейс, указанный в определении класса.  
  
-   Если вы определили функцию-член в том месте, отличном от тела определения класса, в котором он объявлен, выдается предупреждение, если функция определена как **dllexport** или **dllimport** (при этом Определение отличается от указанного в объявлении класса).  
  
**Завершение блока, относящегося только к системам Майкрософт**  
  
## <a name="see-also"></a>См. также  
 [dllexport, dllimport](../cpp/dllexport-dllimport.md)