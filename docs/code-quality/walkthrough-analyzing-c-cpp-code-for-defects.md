---
title: Пошаговое руководство. анализ кода C/C++ для дефектов
description: Демонстрирует использование анализа кода с Microsoft C++ в Visual Studio.
ms.date: 04/14/2020
ms.topic: conceptual
helpviewer_keywords:
- C/C++, code analysis
- code analysis, walkthroughs
- code, analyzing C/C++
- code analysis tool, walkthroughs
ms.openlocfilehash: bb81ca376651c17c760ee776510303efaa13fd9a
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924776"
---
# <a name="walkthrough-analyzing-cc-code-for-defects"></a>Пошаговое руководство. анализ кода C/C++ для дефектов

В этом пошаговом руководстве показано, как анализировать код C/C++ для потенциальных дефектов кода. Он использует средства анализа кода для кода C/C++.

В этом пошаговом руководстве вы выполните следующие действия:

- Выполнение анализа кода в машинном коде.
- Анализ предупреждений о дефектах кода.
- Рассматривать предупреждение как ошибку.
- Закомментировать исходный код, чтобы улучшить анализ дефектов кода.

## <a name="prerequisites"></a>Предварительные требования

- Копия [образца кппдемо](../code-quality/demo-sample.md).
- Основные сведения о C/C++.

## <a name="run-code-analysis-on-native-code"></a>Выполнение анализа кода в машинном коде

### <a name="to-run-code-defect-analysis-on-native-code"></a>Выполнение анализа дефектов кода в машинном коде

::: moniker range=">=msvc-160"

1. Откройте решение Кппдемо в Visual Studio.

     Решение Кппдемо теперь заполняет **Обозреватель решений** .

1. В меню **Сборка** выберите пункт **Перестроить решение** .

     Решение строится без ошибок или предупреждений.

1. В **Обозреватель решений** выберите проект кодедефектс.

1. В меню **Проект** выберите пункт **Свойства** .

     Откроется диалоговое окно **страницы свойств кодедефектс** .

1. Выберите страницу свойств **анализ кода** .

1. Установите для свойства **Включить анализ кода при сборке** значение **Да** . Выберите **ОК** для сохранения внесенных изменений.

1. Перестройте проект Кодедефектс.

     Предупреждения анализа кода отображаются в окне **Список ошибок** .

::: moniker-end

::: moniker range="<=msvc-150"

1. Откройте решение Кппдемо в Visual Studio.

     Решение Кппдемо теперь заполняет **Обозреватель решений** .

1. В меню **Сборка** выберите пункт **Перестроить решение** .

     Решение строится без ошибок или предупреждений.

     > [!NOTE]
     > В Visual Studio 2017 может появиться ложное предупреждение `E1097 unknown attribute "no_init_all"` в подсистеме IntelliSense. Это предупреждение можно проигнорировать.

1. В **Обозреватель решений** выберите проект кодедефектс.

1. В меню **Проект** выберите пункт **Свойства** .

     Откроется диалоговое окно **страницы свойств кодедефектс** .

1. Выберите страницу свойств **анализ кода** .

1. Установите флажок **Включить анализ кода при сборке** . Выберите **ОК** для сохранения внесенных изменений.

1. Перестройте проект Кодедефектс.

     Предупреждения анализа кода отображаются в окне **Список ошибок** .

::: moniker-end

### <a name="to-analyze-code-defect-warnings"></a>Анализ предупреждений о дефектах кода

1. В меню **вид** выберите **Список ошибок** .

     Этот пункт меню может быть невидимым. Это зависит от профиля разработчика, выбранного в Visual Studio. Может потребоваться указать **другие окна** в меню **вид** , а затем выбрать **Список ошибок** .

1. В окне **Список ошибок** дважды щелкните следующее предупреждение:

     C6230: неявное приведение между семантически различными типами: использование HRESULT в логическом контексте.

     Редактор кода отображает строку, вызвавшую предупреждение внутри функции `bool ProcessDomain()` . Это предупреждение означает, что объект `HRESULT` используется в операторе if, где ожидается логический результат. Как правило, это ошибка, так как при `S_OK` возвращении HRESULT из функции она указывает на успешное выполнение, но при преобразовании в логическое значение, результатом которого является **`false`** .

1. Исправьте это предупреждение с помощью `SUCCEEDED` макроса, который преобразует в, **`true`** когда `HRESULT` возвращаемое значение указывает на успешное выполнение. Код должен выглядеть следующим образом:

   ```cpp
   if (SUCCEEDED(ReadUserAccount()))
   ```

1. В **Список ошибок** дважды щелкните следующее предупреждение:

     C6282: неверный оператор: присваивание константы в логическом контексте. Вместо этого рекомендуется использовать "= =".

1. Исправьте это предупреждение, проверив его на равенство. Код должен выглядеть примерно так, как показано в следующем коде:

   ```cpp
   if ((len == ACCOUNT_DOMAIN_LEN) || (g_userAccount[len] != L'\\'))
   ```

1. Исправьте оставшиеся C6001 предупреждения в **Список ошибок** , инициализируя `i` и `j` до 0.

1. Перестройте проект Кодедефектс.

     Проект строится без предупреждений или ошибок.

## <a name="correct-source-code-annotation-warnings"></a>Правильные предупреждения в заметках исходного кода

### <a name="to-enable-the-source-code-annotation-warnings-in-annotationc"></a>Включение предупреждений в заметках исходного кода в аннотации. c

::: moniker range=">=msvc-160"

1. В обозреватель решений выберите проект аннотации.

1. В меню **Проект** выберите пункт **Свойства** .

     Откроется диалоговое окно **страницы свойств заметки** .

1. Выберите страницу свойств **анализ кода** .

1. Установите для свойства **Включить анализ кода при сборке** значение **Да** . Выберите **ОК** для сохранения внесенных изменений.

::: moniker-end

::: moniker range="<=msvc-150"

1. В обозреватель решений выберите проект аннотации.

1. В меню **Проект** выберите пункт **Свойства** .

     Откроется диалоговое окно **страницы свойств заметки** .

1. Выберите страницу свойств **анализ кода** .

1. Установите флажок **Включить анализ кода при сборке** . Выберите **ОК** для сохранения внесенных изменений.

::: moniker-end

### <a name="to-correct-the-source-code-annotation-warnings-in-annotationc"></a>Исправление предупреждений в заметке исходного кода в аннотации. c

1. Перестройте проект Annotations.

1. В меню **Сборка** выберите пункт **выполнить анализ кода для заметок** .

1. В **Список ошибок** дважды щелкните следующее предупреждение:

     C6011: разыменование ПУСТого указателя "newNode".

     Это предупреждение указывает на сбой вызывающей стороны для проверки возвращаемого значения. В этом случае вызов метода `AllocateNode` может вернуть значение null. См. h файл заголовков Annotations для объявления функции для `AllocateNode` .

1. Курсор находится в расположении файла Annotations. cpp, в котором возникло предупреждение.

1. Чтобы исправить это предупреждение, используйте оператор "If" для проверки возвращаемого значения. Код должен выглядеть следующим образом:

   ```cpp
   LinkedList* newNode = AllocateNode();
   if (nullptr != newNode)
   {
       newNode->data = value;
       newNode->next = 0;
       node->next = newNode;
   }
   ```

1. Перестройте проект Annotations.

     Проект строится без предупреждений или ошибок.

## <a name="use-source-code-annotation-to-discover-more-issues"></a>Использование заметок к исходному коду для обнаружения дополнительных проблем

### <a name="to-use-source-code-annotation"></a>Использование заметок к исходному коду

1. Закомментировать формальные параметры и возвращаемое значение функции `AddTail` , чтобы указать, что значения указателя могут быть равны NULL:

   ```cpp
   _Ret_maybenull_ LinkedList* AddTail(_Maybenull_ LinkedList* node, int value)
   ```

1. В меню **Сборка** выберите **Выполнить анализ кода в решении** .

1. В **Список ошибок** дважды щелкните следующее предупреждение:

     C6011: разыменование ПУСТого указателя "Node".

     Это предупреждение означает, что узел, переданный в функцию, может иметь значение null.

1. Чтобы исправить это предупреждение, используйте оператор "If" в начале функции, чтобы проверить переданное значение. Код должен выглядеть следующим образом:

   ```cpp
   if (nullptr == node)
   {
        return nullptr;
   }
   ```

1. В меню **Сборка** выберите **Выполнить анализ кода в решении** .

     Теперь проект строится без предупреждений или ошибок.

## <a name="see-also"></a>См. также статью

[Пошаговое руководство. анализ управляемого кода на предмет дефектов кода](/visualstudio/code-quality/walkthrough-analyzing-managed-code-for-code-defects)\
[Анализ кода для C/C++](../code-quality/code-analysis-for-c-cpp-overview.md)
