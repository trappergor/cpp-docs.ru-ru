---
title: 'Практическое: Создание пользовательского элемента управления и узла Просмотр MDI | Документация Майкрософт'
ms.custom: get-started-article
ms.date: 11/04/2016
ms.technology:
- cpp-cli
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- MFC [C++], Windows Forms Controls
- Windows Forms [C++], MFC support
ms.assetid: 625b5821-f923-4701-aca0-c1a4ceca4f63
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
- dotnet
ms.openlocfilehash: 2e61a69661034fb582039c744c3483f461405581
ms.sourcegitcommit: a9dcbcc85b4c28eed280d8e451c494a00d8c4c25
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50056975"
---
# <a name="how-to-create-the-user-control-and-host-mdi-view"></a>Практическое руководство. Создание пользовательского элемента управления и просмотр ведущего интерфейса MDI

Ниже показано, как создать пользовательский элемент управления .NET Framework, регистрации пользовательского элемента управления в библиотеке классов (в частности, проект Windows Control Library) и затем скомпилировать проект в сборку. Элемент управления затем могут использоваться из приложения MFC, использующего классы, производные от [CView Class](../mfc/reference/cview-class.md) и [класс CWinFormsView](../mfc/reference/cwinformsview-class.md).

Сведения о том, как создать пользовательский элемент управления Windows Forms и о разработке библиотеки класса для элемента управления, см. в разделе [как: Разработка пользовательских элементов управления](/dotnet/framework/winforms/controls/how-to-author-composite-controls).

> [!NOTE]
>  В некоторых случаях элементы управления Windows Forms, например, элемент управления сетки независимых производителей, работают не стабильно при размещении в приложении MFC. Рекомендуемый обходной путь — поместить пользовательский элемент управления Windows Forms в приложении MFC и поместите элемент управления сетки сторонних внутри пользовательского элемента управления.

Эта процедура предполагает, что вы создали проект библиотеки элементов управления Windows Forms с именем WindowsFormsControlLibrary1 как одна процедура в [как: Создание пользовательского элемента управления и ведущего приложения в диалоговом окне](../dotnet/how-to-create-the-user-control-and-host-in-a-dialog-box.md).

### <a name="to-create-the-mfc-host-application"></a>Создание ведущего приложения MFC

1. Создайте проект приложения MFC.

   На **файл** меню, выберите **New**, а затем нажмите кнопку **проекта**. В **Visual C++** папку, выберите **приложения MFC**.

   В **имя** введите `MFC02` и измените **решение** присвоить **добавить решение**. Нажмите кнопку **ОК**.

   В **мастер приложений MFC**, примите все значения по умолчанию и нажмите кнопку **Готово**. Это создает приложение MFC с интерфейсом MDI.

1. Настройка проекта для поддержки Common Language Runtime (CLR).

   В **обозревателе решений**, щелкните правой кнопкой мыши `MFC01` узел проекта и выберите **свойства** в контекстном меню. **Страницы свойств** откроется диалоговое окно.

   В разделе **свойства конфигурации**выберите **Общие**. В разделе **проекта по умолчанию** задайте **поддержки Common Language Runtime** для **поддержка среды CLR (/ clr)**.

   В разделе **свойства конфигурации**, разверните **C/C++** и нажмите кнопку **Общие** узла. Задайте **формат отладочной информации** для **база данных (/Zi) программы**.

   Нажмите кнопку **создание кода** узла. Задайте **включить минимальное перестроение** для **нет (/ Gm-)**. Также задайте **основные проверки времени выполнения** для **по умолчанию**.

   Нажмите кнопку **ОК** для применения изменений.

1. В файле stdafx.h добавьте следующую строку:

    ```
    #using <System.Windows.Forms.dll>
    ```

1. Добавьте ссылку на элемент управления .NET.

   В **обозревателе решений**, щелкните правой кнопкой мыши `MFC02` узел проекта и выберите **добавить**, **ссылки**. В **страницу свойств**, нажмите кнопку **добавить новую ссылку**, выберите WindowsFormsControlLibrary1 (в разделе **проекты** вкладку) и нажмите кнопку **ОК** . Это действие добавляет ссылку в виде [/FU](../build/reference/fu-name-forced-hash-using-file.md) компилятора параметр, чтобы программа будет скомпилирована; он также копирует WindowsFormsControlLibrary1.dll в `MFC02` каталог проекта, что программа будет выполняться.

1. В файле stdafx.h найдите следующую строку:

    ```
    #endif // _AFX_NO_AFXCMN_SUPPORT
    ```

   Добавьте следующие строки над ним:

    ```
    #include <afxwinforms.h>   // MFC Windows Forms support
    ```

1. Изменить представление класса таким образом, чтобы он наследует от [CWinFormsView](../mfc/reference/cwinformsview-class.md).

   В MFC02View.h замените [CView](../mfc/reference/cview-class.md) с [CWinFormsView](../mfc/reference/cwinformsview-class.md) таким образом, чтобы код выглядит следующим образом:

    ```
    class CMFC02View : public CWinFormsView
    {
    };
    ```

   Если нужно добавить дополнительные представления в приложение MDI, необходимо вызвать [CWinApp::AddDocTemplate](../mfc/reference/cwinapp-class.md#adddoctemplate) для каждого представления, можно создать.

1. Измените файл MFC02View.cpp, чтобы изменить CView на CWinFormsView в IMPLEMENT_DYNCREATE макрос, сопоставить сообщение и заменить существующий пустой конструктор на нижеуказанный конструктор:

    ```
    IMPLEMENT_DYNCREATE(CMFC02View, CWinFormsView)

    CMFC02View::CMFC02View(): CWinFormsView(WindowsFormsControlLibrary1::UserControl1::typeid)
    {
    }
    BEGIN_MESSAGE_MAP(CMFC02View, CWinFormsView)
    //leave existing body as is
    END_MESSAGE_MAP()
    ```

1. Постройте и запустите проект.

   В **обозревателе решений**, щелкните правой кнопкой мыши MFC02 и выберите **Назначить запускаемым проектом**.

   В меню **Сборка** выберите **Собрать решение**.

   На **Отладка** меню, щелкните **Запуск без отладки**.

## <a name="see-also"></a>См. также

[Размещение пользовательского элемента управления формы Windows Forms в качестве представления MFC](../dotnet/hosting-a-windows-forms-user-control-as-an-mfc-view.md)