---
title: "_environ, _wenviron | Документация Майкрософт"
ms.custom: 
ms.date: 11/04/2016
ms.reviewer: 
ms.suite: 
ms.technology: cpp-standard-libraries
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords:
- environ
- wenviron
- _wenviron
- _environ
dev_langs: C++
helpviewer_keywords:
- environ function
- _environ function
- _wenviron function
- process environment
- wenviron function
ms.assetid: 7e639962-6536-47cd-8095-0cbe44a56e03
caps.latest.revision: "13"
author: corob-msft
ms.author: corob
manager: ghogen
ms.workload: cplusplus
ms.openlocfilehash: f89c777a25da5288709683750c907114dac1e5c9
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="environ-wenviron"></a>_environ, _wenviron
Переменная `_environ` является указателем на массив указателей на строки многобайтовых символов, которые составляют среду процесса. Использование этой глобальной переменной не рекомендуется, поскольку существуют более безопасные функциональные версии [getenv_s, _wgetenv_s](../c-runtime-library/reference/getenv-s-wgetenv-s.md) и [putenv_s, _wputenv_s](../c-runtime-library/reference/putenv-s-wputenv-s.md), которые следует использовать вместо нее. `_environ` объявлена в файле Stdlib.h.  
  
> [!IMPORTANT]
>  Этот API нельзя использовать в приложениях, выполняемых в среде выполнения Windows. Дополнительные сведения см. в статье [Функции CRT, которые не поддерживаются с ключом /ZW](http://msdn.microsoft.com/library/windows/apps/jj606124.aspx).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
extern char **_environ;  
```  
  
## <a name="remarks"></a>Примечания  
 В программе, которая использует функцию `main`, переменная `_environ` инициализируется при запуске программы в соответствии с настройками, полученными из среды операционной системы. Среда состоит из одной или нескольких записей следующего вида:  
  
 `ENVVARNAME` `=string`  
  
 Функции `getenv_s` и `putenv_s` используют переменную `_environ` для получения доступа к таблице среды и ее изменения. При вызове функции `_putenv` для добавления или удаления параметров среды размер таблица среды изменяется. Ее расположение в памяти также может изменяться, это зависит от требований к памяти программы. Значение переменной `_environ` автоматически изменяется соответствующим образом.  
  
 Переменная `_wenviron`, объявленная в файле Stdlib.h как:  
  
```  
extern wchar_t **_wenviron;  
```  
  
 представляет собой версию переменной `_environ` для расширенных символов. В программе, которая использует функцию `wmain`, переменная `_wenviron` инициализируется при запуске программы в соответствии с настройками, полученными из среды операционной системы.  
  
 В программе, которая использует `main`, переменная `_wenviron` изначально имеет значение `NULL`, поскольку среда состоит из строк многобайтовых символов. При первом вызове функции `_wgetenv` или `_wputenv` создается соответствующая строка среды из расширенных символов, на которую указывает переменная `_wenviron`.  
  
 Аналогично, в программе, которая использует `wmain`, переменная `_environ` изначально имеет значение `NULL`, поскольку среда состоит из строк расширенных символов. При первом вызове функции `_getenv` или `_putenv` создается соответствующая строка среды из многобайтовых символов, на которую указывает переменная `_environ`.  
  
 Если в программе одновременно существуют две копии среды (многобайтовой кодировки и Юникода), система времени выполнения должна поддерживать обе копии, что отрицательно сказывается на скорости выполнения программы. Например, при вызове функции `_putenv` также автоматически производится вызов функции `_wputenv`, чтобы строки в двух средах совпадали.  
  
> [!CAUTION]
>  В редких случаях, когда система времени выполнения поддерживает и версию Юникода, и многобайтовую версию, эти две версии среды могут не полностью соответствовать друг другу. Это происходит потому, что хотя любая уникальная расширенная строка сопоставляется уникальной строке Юникода, сопоставление уникальной строки Юникода со строкой многобайтовой кодировки не обязательно будет уникальными. Поэтому две различных строки Юникода могут сопоставляться одной и той же многобайтовой строке.  
  
 Запрос переменной `_environ` в контексте Юникода не имеет смысла, если используется компоновка [/MD](../build/reference/md-mt-ld-use-run-time-library.md) или `/MDd`. Библиотеке DLL CRT неизвестен тип (расширенная или многобайтовая) программы. Создается только многобайтовый тип, поскольку это наиболее вероятный сценарий.  
  
 Следующий псевдокод иллюстрирует, как это может произойти.  
  
```  
int i, j;  
i = _wputenv( "env_var_x=string1" );  // results in the implicit call:  
                                      // putenv ("env_var_z=string1")  
j = _wputenv( "env_var_y=string2" );  // also results in implicit call:  
                                      // putenv("env_var_z=string2")  
```  
  
 В нотации, используемой для данного примера, символьные строки не являются строковыми литералами C; скорее это местозаполнители, которые представляют литералы строки среды Юникода в вызове функции `_wputenv` и многобайтовые строки среды в вызове функции `putenv`. Местозаполнители символов "`x`" и "`y`" в двух различных строках среды Юникода не сопоставляются однозначно символам в текущей многобайтовой кодировке. Вместо этого они сопоставляются определенному символу многобайтовой кодировки "`z`", который является результатом по умолчанию для попытки преобразовать строки.  
  
 Поэтому в многобайтовых средах значение "`env_var_z`" после первого неявного вызова функции `putenv` будет равно "`string1`", но это значение будет перезаписано при втором неявном вызове функции `putenv`, если для "`env_var_z`" будет установлено значение "`string2`". Поэтому после такой последовательности вызовов среда Юникода (в `_wenviron`) и многобайтовая среда (в `_environ`) будут отличаться.  
  
## <a name="see-also"></a>См. также  
 [Глобальные переменные](../c-runtime-library/global-variables.md)   
 [getenv, _wgetenv](../c-runtime-library/reference/getenv-wgetenv.md)   
 [getenv_s, _wgetenv_s](../c-runtime-library/reference/getenv-s-wgetenv-s.md)   
 [_putenv, _wputenv](../c-runtime-library/reference/putenv-wputenv.md)   
 [_putenv_s, _wputenv_s](../c-runtime-library/reference/putenv-s-wputenv-s.md)