---
title: Возможности безопасности в CRT
description: Общие сведения о защищенных функциях CRT в среде выполнения Microsoft C.
ms.date: 09/29/2020
ms.topic: conceptual
f1_keywords:
- _CRT_SECURE_NO_DEPRECATE
- _CRT_NONSTDC_NO_WARNINGS
- _CRT_SECURE_NO_WARNINGS
helpviewer_keywords:
- security deprecation warnings [C++]
- CRT_NONSTDC_NO_DEPRECATE
- buffers [C++], buffer overruns
- deprecation warnings (security-related), disabling
- _CRT_NONSTDC_NO_WARNINGS
- security [CRT]
- _CRT_SECURE_NO_WARNINGS
- _CRT_NONSTDC_NO_DEPRECATE
- _CRT_SECURE_NO_DEPRECATE
- security-enhanced CRT
- CRT_SECURE_NO_WARNINGS
- CRT_SECURE_NO_DEPRECATE
- deprecation warnings (security-related)
- buffer overruns
- CRT_NONSTDC_NO_WARNINGS
- CRT, security enhancements
- parameters [C++], validation
ms.assetid: d9568b08-9514-49cd-b3dc-2454ded195a3
ms.openlocfilehash: 963f5510350aa3be25586811889189d28a5f7b66
ms.sourcegitcommit: 9451db8480992017c46f9d2df23fb17b503bbe74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2020
ms.locfileid: "91589891"
---
# <a name="security-features-in-the-crt"></a>Возможности безопасности в CRT

Многие старые функции CRT имеют новые, более безопасные версии. Если безопасная функция существует, то старая менее безопасная версия помечена как нерекомендуемая, а новая версия имеет суффикс `_s` ("secure" — "безопасный").

В этом контексте "устарело" — использование функции не рекомендуется. Это не означает, что функция планируется удалить из CRT.

Безопасные функции не предотвращают или не исправляет ошибки безопасности. Вместо этого они перехватывают ошибки при их возникновении. Они выполняют дополнительные проверки условий ошибок. При возникновении ошибки они вызывают обработчик ошибок (см. раздел [Проверка параметров](../c-runtime-library/parameter-validation.md)).

Например, `strcpy` функция не может определить, является ли копируемая строка слишком большой для буфера назначения. Его безопасный аналог, `strcpy_s` , принимает размер буфера в качестве параметра. Поэтому он может определить, произойдет ли переполнение буфера. Если вы используете, `strcpy_s` чтобы скопировать 11 символов в буфер 10 символов, это ошибка на вашем этапе; `strcpy_s` не может исправить ошибку. Но он может обнаружить ошибку и сообщить о ней, вызвав обработчик недопустимых параметров.

## <a name="eliminating-deprecation-warnings"></a>Устранение предупреждений о нерекомендуемых функциях

Существует несколько способов устранить предупреждения о нерекомендуемых функциях для старых менее безопасных функций. Самый простой — определить символ `_CRT_SECURE_NO_WARNINGS` или использовать директиву pragma [warning](../preprocessor/warning.md). Отключает предупреждения об устаревании, но проблемы безопасности, вызвавшие предупреждения, по-прежнему существуют. Лучше оставить предупреждения об устаревании включенными и воспользоваться новыми функциями безопасности CRT.

В C++ самый простой способ сделать это — использовать [безопасные перегрузки шаблонов](../c-runtime-library/secure-template-overloads.md). Это позволит избежать предупреждений об устаревании, во многих случаях путем замены вызовов к устаревшим функциям вызовами для защиты версий этих функций. Например, рассмотрим нерекомендуемый вызов функции `strcpy`:

```
char szBuf[10];
strcpy(szBuf, "test"); // warning: deprecated
```

Задание символа `_CRT_SECURE_CPP_OVERLOAD_STANDARD_NAMES` равным 1 устраняет предупреждение, заменяя вызов функции `strcpy` вызовом функции `strcpy_s`, которая предотвращает переполнение буфера. Дополнительные сведения см. в разделе [Безопасные перегрузки шаблонов](../c-runtime-library/secure-template-overloads.md).

Для тех нерекомендуемых функций, у которых нет безопасных шаблонных перегрузок, определенно стоит рассмотреть возможность обновления кода вручную для использования безопасных функций.

Еще один источник предупреждений о нерекомендуемых функциях, не связанный с безопасностью, — POSIX-функции. Заменяйте имена POSIX-функций их стандартными эквивалентами (например, меняйте [access](../c-runtime-library/reference/access-crt.md) на [_access](../c-runtime-library/reference/access-waccess.md)) или отключите связанные с POSIX предупреждения о нерекомендуемых функциях, определив `_CRT_NONSTDC_NO_WARNINGS`. Дополнительные сведения см. в разделе [Совместимость](compatibility.md).

## <a name="additional-security-features"></a>Дополнительные средства безопасности

Ниже перечислены некоторые из функций безопасности.

- `Parameter Validation`. Безопасные функции и многие их небезопасные аналоги проверяют параметры. Проверка может включать:

  - Проверка на наличие значений **null** .
  - Проверка допустимости перечислимых значений.
  - Проверка принадлежности целочисленных значений допустимым диапазонам.

- Дополнительные сведения см. в разделе [Проверка параметров](../c-runtime-library/parameter-validation.md).

- Разработчику также доступен обработчик недопустимого параметра. Если функция обнаруживает недопустимый параметр, вместо утверждения и выхода приложения CRT позволяет проверять эти проблемы с помощью [_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler](../c-runtime-library/reference/set-invalid-parameter-handler-set-thread-local-invalid-parameter-handler.md).

- `Sized Buffers`. Необходимо передать размер буфера в любую безопасную функцию, которая записывает данные в буфер. Безопасные версии подтверждают, что буфер достаточно велик, прежде чем записывать в него. Это помогает избежать небезопасных ошибок переполнения буфера, которые могут привести к выполнению вредоносного кода. Эти функции обычно возвращают `errno` код ошибки и вызывают обработчик недопустимого параметра, если размер буфера слишком мал. Функции, выполняющие чтение из буферов ввода, например `gets`, имеют безопасные версии, требующие указания максимального размера.

- `Null termination`. Некоторые функции, которые остались потенциально незавершенными строками, имеют безопасные версии, что гарантирует, что строки должны завершаться нулем.

- `Enhanced error reporting`. Безопасные функции возвращают коды ошибок с дополнительными сведениями об ошибках, чем были доступны в уже существующих функциях. Безопасные функции и многие существовавшие ранее функции теперь устанавливают `errno` и часто возвращают `errno` тип кода, чтобы обеспечить лучшую отправку отчетов об ошибках.

- `Filesystem security`. API безопасного файлового ввода-вывода по умолчанию поддерживает безопасный доступ к файлам.

- `Windows security`. Безопасные API для работы с процессами принудительно реализуют политики безопасности и позволяют задавать списки управления доступом (ACL).

- `Format string syntax checking`. Недопустимые строки обнаруживаются, например, с помощью символов полей неправильного типа в строках формата`printf`.

## <a name="see-also"></a>См. также

[Проверка параметров](../c-runtime-library/parameter-validation.md)<br/>
[Безопасные перегрузки шаблонов](../c-runtime-library/secure-template-overloads.md)<br/>
[Возможности библиотеки CRT](../c-runtime-library/crt-library-features.md)
