---
title: Функции безопасности в CRT | Документация Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-standard-libraries
ms.topic: conceptual
f1_keywords:
- _CRT_SECURE_NO_DEPRECATE
- _CRT_NONSTDC_NO_WARNINGS
- _CRT_SECURE_NO_WARNINGS
dev_langs:
- C++
helpviewer_keywords:
- security deprecation warnings [C++]
- CRT_NONSTDC_NO_DEPRECATE
- buffers [C++], buffer overruns
- deprecation warnings (security-related), disabling
- _CRT_NONSTDC_NO_WARNINGS
- security [CRT]
- _CRT_SECURE_NO_WARNINGS
- _CRT_NONSTDC_NO_DEPRECATE
- _CRT_SECURE_NO_DEPRECATE
- security-enhanced CRT
- CRT_SECURE_NO_WARNINGS
- CRT_SECURE_NO_DEPRECATE
- deprecation warnings (security-related)
- buffer overruns
- CRT_NONSTDC_NO_WARNINGS
- CRT, security enhancements
- parameters [C++], validation
ms.assetid: d9568b08-9514-49cd-b3dc-2454ded195a3
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: 1ce188ea5d28fa99d6133129edbace8e2886f0f5
ms.sourcegitcommit: be2a7679c2bd80968204dee03d13ca961eaa31ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="security-features-in-the-crt"></a>Возможности безопасности в CRT
Многие старые функции CRT имеют новые, более безопасные версии. Если безопасная функция существует, то старая менее безопасная версия помечена как нерекомендуемая, а новая версия имеет суффикс `_s` ("secure" — "безопасный").  
  
 В этом контексте "нерекомендуемая" означает только то, что использование этой функции не рекомендуется; это не означает, что функцию планируется удалить из CRT.  
  
 Безопасные функции не предотвращают и не исправляют ошибки безопасности; вместо этого они перехватывают ошибки при их возникновении. Они выполняют дополнительные проверки на состояния ошибки, а в случае ошибки вызывают обработчик ошибок (см. статью [Проверка параметров](../c-runtime-library/parameter-validation.md)).  
  
 Например, функция `strcpy` не может сообщить о том, что копируемая строка слишком велика для буфера назначения. Однако ее безопасный аналог, `strcpy_s`, принимает размер буфера в качестве параметра, так что она может определить, произойдет ли переполнение буфера. Если вы используете функцию `strcpy_s` для копирования одиннадцати символов в буфер из десяти символов, это ошибка с вашей стороны; `strcpy_s` не может исправить вашу ошибку, но может обнаружить ее и предупредить о ней путем вызова обработчика недопустимого параметра.  
  
## <a name="eliminating-deprecation-warnings"></a>Устранение предупреждений о нерекомендуемых функциях  
 Существует несколько способов устранить предупреждения о нерекомендуемых функциях для старых менее безопасных функций. Самый простой — определить символ `_CRT_SECURE_NO_WARNINGS` или использовать директиву pragma [warning](../preprocessor/warning.md). В обоих случаях предупреждения о нерекомендуемых функциях будут отключены, но, разумеется, сами проблемы безопасности, вызывающие эти предупреждения, останутся. Гораздо лучше оставить предупреждения о нерекомендуемых возможностях включенными и использовать новые безопасные возможности CRT.  
  
 Самый простой способ сделать это в C++ — использовать [безопасные перегрузки шаблонов](../c-runtime-library/secure-template-overloads.md), которые во многих случаях устраняют предупреждения о нерекомендуемых функциях, заменяя вызовы этих функций вызовами их новых безопасных версий. Например, рассмотрим нерекомендуемый вызов функции `strcpy`:  
  
```  
char szBuf[10];   
strcpy(szBuf, "test"); // warning: deprecated   
```  
  
 Задание символа `_CRT_SECURE_CPP_OVERLOAD_STANDARD_NAMES` равным 1 устраняет предупреждение, заменяя вызов функции `strcpy` вызовом функции `strcpy_s`, которая предотвращает переполнение буфера. Дополнительные сведения см. в разделе [Secure Template Overloads](../c-runtime-library/secure-template-overloads.md).  
  
 Для тех нерекомендуемых функций, у которых нет безопасных шаблонных перегрузок, определенно стоит рассмотреть возможность обновления кода вручную для использования безопасных функций.  
  
 Еще один источник предупреждений о нерекомендуемых функциях, не связанный с безопасностью, — POSIX-функции. Заменяйте имена POSIX-функций их стандартными эквивалентами (например, меняйте [access](../c-runtime-library/reference/access-crt.md) на [_access](../c-runtime-library/reference/access-waccess.md)) или отключите связанные с POSIX предупреждения о нерекомендуемых функциях, определив `_CRT_NONSTDC_NO_WARNINGS`. Дополнительные сведения см. в разделе [Совместимость](compatibility.md).  
  
## <a name="additional-security-features"></a>Дополнительные средства безопасности  
 К дополнительным средствам обеспечения безопасности относятся, в частности, следующие.  
  
-   `Parameter Validation`. Параметры, передаваемые в функции CRT, проверяются и в безопасных функциях, и во многих существовавших ранее версиях функций. Эти проверки включают:  
  
    -   Проверка на значение `NULL`, переданное в функции.  
  
    -   Проверка допустимости перечислимых значений.  
  
    -   Проверка принадлежности целочисленных значений допустимым диапазонам.  
  
-   Дополнительные сведения см. в разделе [Проверка параметров](../c-runtime-library/parameter-validation.md).  
  
-   Разработчику также доступен обработчик недопустимого параметра. При обнаружении недопустимого параметра вместо использования утверждений и выхода из приложения CRT дает возможность проверить эти проблемы с помощью функции [_set_invalid_parameter_handler, _set_thread_local_invalid_parameter_handler](../c-runtime-library/reference/set-invalid-parameter-handler-set-thread-local-invalid-parameter-handler.md).  
  
-   `Sized Buffers`. Безопасные функции требуют передачи размера буфера в любую функцию, которая выполняет запись в буфер. Безопасные версии проверяют, что буфер достаточно велик, прежде чем выполнять в него запись; это помогает избежать опасных ошибок переполнений буфера, из-за которых возможно выполнение вредоносного кода. Обычно эти функции возвращают тип кода ошибки `errno` и вызывают обработчик недопустимого параметра, если размер буфера слишком мал. Функции, выполняющие чтение из буферов ввода, например `gets`, имеют безопасные версии, требующие указания максимального размера.  
  
-   `Null termination`. Некоторые функции, которые могут оставить строку потенциально незавершенной, имеют безопасные версии, обеспечивающие правильное завершение строк нуль-символом.  
  
-   `Enhanced error reporting`. Коды ошибок, возвращаемые безопасными функциями, содержат более подробные сведения об ошибке, чем у существовавших ранее функций. Безопасные функции и многие из существовавших ранее функций задают `errno` и часто также возвращают тип кода `errno`, что увеличивает информативность сообщений об ошибках.  
  
-   `Filesystem security`. API безопасного файлового ввода-вывода по умолчанию поддерживает безопасный доступ к файлам.  
  
-   `Windows security`. Безопасные API для работы с процессами принудительно реализуют политики безопасности и позволяют задавать списки управления доступом (ACL).  
  
-   `Format string syntax checking`. Недопустимые строки обнаруживаются, например, с помощью символов полей неправильного типа в строках формата`printf`.  
  
## <a name="see-also"></a>См. также  
 [Проверка параметров](../c-runtime-library/parameter-validation.md)   
 [Безопасные перегрузки шаблонов](../c-runtime-library/secure-template-overloads.md)   
 [Функции библиотеки CRT](../c-runtime-library/crt-library-features.md)