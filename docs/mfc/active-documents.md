---
title: Активные документы
ms.date: 11/04/2016
helpviewer_keywords:
- active documents [MFC]
- active documents [MFC], requirements
- view objects [MFC], requirements
- OLE [MFC], active documents
- views [MFC], active documents
- active documents [MFC], views
ms.assetid: 1378f18e-aaa6-420b-8501-4b974905baa0
ms.openlocfilehash: bfe91dcb42b97ddfbb0bf0be36a54b45e6dc0809
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84625157"
---
# <a name="active-documents"></a>Активные документы

Активные документы расширяют технологию составного документа OLE. Эти расширения предоставляются в виде дополнительных интерфейсов, управляющих представлениями, чтобы объекты могли работать в контейнерах и при этом хранить контроль над их функциями отображения и печати. Этот процесс позволяет отображать документы как в внешних кадрах (таких как Microsoft Office BINDER или Microsoft Internet Explorer), так и в собственных кадрах (например, в собственных портах представления продукта).

В этом разделе описываются функциональные [требования для активных документов](#requirements_for_active_documents). Активный документ владеет набором данных и имеет доступ к хранилищу, где можно сохранять и извлекать данные. Он может создавать одно или несколько представлений данных и управлять ими. В дополнение к поддержке стандартных интерфейсов внедрения и встроенной активации для документов OLE, активный документ обменивается своими возможностями по созданию представлений с помощью `IOleDocument` . С помощью этого интерфейса контейнер может попросить создать (и, возможно, перечислить) представления, которые может отображать активный документ. С помощью этого интерфейса активный документ также может предоставлять различные сведения о себе, например, поддерживает ли он несколько представлений или сложных прямоугольников.

Ниже приведен `IOleDocument` интерфейс. Обратите внимание, что `IEnumOleDocumentViews` интерфейс является стандартным перечислителем OLE для `IOleDocumentView*` типов.

```
interface IOleDocument : IUnknown
    {
    HRESULT CreateView(
        [in] IOleInPlaceSite *pIPSite,
        [in] IStream *pstm,
        [in] DWORD dwReserved,
        [out] IOleDocumentView **ppView);

    HRESULT GetDocMiscStatus([out] DWORD *pdwStatus);

    HRESULT EnumViews(
        [out] IEnumOleDocumentViews **ppEnum,
        [out] IOleDocumentView **ppView);
    }
```

Каждый активный документ должен иметь поставщик кадров представления с этим интерфейсом. Если документ не внедрен в контейнер, сам сервер документов должен предоставить кадр представления. Однако когда активный документ внедряется в контейнер активного документа, контейнер предоставляет кадр представления.

Активный документ может создать один или несколько типов [представлений](#requirements_for_view_objects) данных (например, «нормальный», «контур», «макет страницы» и т. д.). Представления действуют как фильтры, с помощью которых можно просматривать данные. Даже если документ имеет только один тип представления, может потребоваться поддержка нескольких представлений в качестве средства поддержки новых оконных функций (например, **новый элемент окна** в меню « **окно** » в приложениях Office).

## <a name="requirements-for-active-documents"></a><a name="requirements_for_active_documents"></a>Требования к активным документам

Активный документ, который может быть отображен в контейнере активного документа, должен:

- Использование составных файлов OLE в качестве механизма хранения путем реализации `IPersistStorage` .

- Поддержка базовых функций внедрения документов OLE, включая **Создание из файла**. Это требует интерфейсов `IPersistFile` , `IOleObject` и `IDataObject` .

- Поддержка одного или нескольких представлений, каждый из которых поддерживает активацию на месте. То есть представления должны поддерживать интерфейс, а `IOleDocumentView` также интерфейсы `IOleInPlaceObject` и `IOleInPlaceActiveObject` (с помощью `IOleInPlaceSite` `IOleInPlaceFrame` интерфейсов и контейнера).

- Поддержка стандартных интерфейсов активных документов `IOleDocument` , `IOleCommandTarget` и `IPrint` .

Сведения о том, когда и как использовать интерфейсы на стороне контейнера, подразумеваются в этих требованиях.

## <a name="requirements-for-view-objects"></a><a name="requirements_for_view_objects"></a>Требования к объектам представления

Активный документ может создать одно или несколько представлений данных. Функционально, эти представления подобны портам на определенный метод для отображения данных. Если активный документ поддерживает только одно представление, то активный документ и единственное представление могут быть реализованы с помощью одного класса. `IOleDocument::CreateView`Возвращает указатель интерфейса того же объекта `IOleDocumentView` .

Для представления в активном контейнере документа компонент просмотра должен поддерживать `IOleInPlaceObject` и `IOleInPlaceActiveObject` в дополнение к `IOleDocumentView` следующим:

```
interface IOleDocumentView : IUnknown
    {
    HRESULT SetInPlaceSite([in] IOleInPlaceSite *pIPSite);
    HRESULT GetInPlaceSite([out] IOleInPlaceSite **ppIPSite);
    HRESULT GetDocument([out] IUnknown **ppunk);
    [input_sync] HRESULT SetRect([in] LPRECT prcView);
    HRESULT GetRect([in] LPRECT prcView);
    [input_sync] HRESULT SetRectComplex(
        [in] LPRECT prcView,
        [in] LPRECT prcHScroll,
        [in] LPRECT prcVScroll,
        [in] LPRECT prcSizeBox);
    HRESULT Show([in] BOOL fShow);
    HRESULT UIActivate([in] BOOL fUIActivate);
    HRESULT Open(void);
    HRESULT CloseView([in] DWORD dwReserved);
    HRESULT SaveViewState([in] IStream *pstm);
    HRESULT ApplyViewState([in] IStream *pstm);
    HRESULT Clone(
        [in] IOleInPlaceSite *pIPSiteNew,
        [out] IOleDocumentView **ppViewNew);
    }
```

Каждое представление имеет связанный сайт представления, который инкапсулирует кадр представления и порт представления (HWND и прямоугольную область в этом окне). Этот веб-узел предоставляет эту функцию, хотя стандартный `IOleInPlaceSite` интерфейс. Обратите внимание, что для одного HWND можно использовать более одного порта представления.

Как правило, каждый тип представления имеет различные печатные представления. Поэтому представления и соответствующие сайты представлений должны реализовывать интерфейсы печати `IPrint` , если и `IContinueCallback` соответственно. Кадр представления должен согласовываться с поставщиком представления `IPrint` при начале печати, чтобы заголовки, нижние колонтитулы, поля и связанные элементы печатались правильно. Поставщик представления уведомляет кадр о событиях, связанных с печатью, с помощью `IContinueCallback` . Дополнительные сведения об использовании этих интерфейсов см. в разделе [Программная печать](programmatic-printing.md).

Обратите внимание, что если активный документ поддерживает только одно представление, то активный документ и единственное представление могут быть реализованы с помощью одного конкретного класса. `IOleDocument::CreateView`просто возвращает указатель интерфейса того же объекта `IOleDocumentView` . Вкратце, нет необходимости в наличии двух отдельных экземпляров объекта, когда требуется только одно представление.

Объект представления также может быть целевым объектом команды. Реализация `IOleCommandTarget` представления может принимать команды, которые происходят в пользовательском интерфейсе контейнера (например, " **создать**", " **Открыть**", " **Сохранить как**", " **Печать** " в меню " **файл** "; **Копировать**, **Вставить**, **отменить** в меню " **Правка** "). Дополнительные сведения см. в разделе [Обработка сообщений и целевые объекты команды](message-handling-and-command-targets.md).

## <a name="see-also"></a>См. также раздел

[Вложение активного документа](active-document-containment.md)
