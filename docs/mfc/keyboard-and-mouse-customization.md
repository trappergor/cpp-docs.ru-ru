---
title: Настройка мыши и клавиатуры
ms.date: 11/19/2018
helpviewer_keywords:
- customizations [MFC], keyboard and mouse (MFC Extensions)
- keyboard and mouse customizations (MFC Extensions)
ms.assetid: 1f789f1b-5f2e-4b11-b974-e3e2a2e49d82
ms.openlocfilehash: 262555b060f226a86438a2189eda44d83c55d5a2
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84621507"
---
# <a name="keyboard-and-mouse-customization"></a>Настройка мыши и клавиатуры

MFC позволяет пользователю приложения настраивать способ обработки ввода с клавиатуры и мыши. Пользователь может настраивать ввод с клавиатуры путем назначения сочетаний клавиш командам. Пользователь также может настроить ввод с помощью мыши, выбрав команду, которая должна выполняться при двойном щелчке в конкретном окне приложения. В этом разделе объясняется, как настроить входные данные для приложения.

В диалоговом окне **Настройка** пользователь может изменять пользовательские элементы управления для мыши и клавиатуры. Чтобы отобразить это диалоговое окно, пользователь **настраивается** в меню **вид** , а затем нажимает **панели инструментов и закрепление**. В диалоговом окне пользователь нажимает на вкладку **Клавиатура** или **мышь** .

## <a name="keyboard-customization"></a>Настройка клавиатуры

На следующем рисунке показана вкладка **Клавиатура** диалогового окна **Настройка** .

![Вкладка "Клавиатура" в диалоговом окне настройки](../mfc/media/mfcnextkeyboardtab.png "Вкладка "Клавиатура" в диалоговом окне настройки") <br/>
Вкладка настройки клавиатуры

Пользователь взаимодействует с вкладкой клавиатура для назначения одной или нескольких сочетаний клавиш команде. Доступные команды перечислены в левой части вкладки. Пользователь может выбрать любую доступную команду в меню. С сочетанием клавиш можно связать только команды меню. После того, как пользователь введет новый ярлык, кнопка **назначить** становится активной. Когда пользователь нажимает эту кнопку, приложение связывает выбранную команду с этим ярлыком.

Все назначенные в данный момент сочетания клавиш перечислены в списке в правом столбце. Пользователь также может выбрать отдельные ярлыки и удалить их или сбросить все сопоставления для приложения.

Если вы хотите обеспечить поддержку этой настройки в приложении, необходимо создать объект [CKeyboardManager](reference/ckeyboardmanager-class.md) . Чтобы создать `CKeyboardManager` объект, вызовите функцию [CWinAppEx:: иниткэйбоардманажер](reference/cwinappex-class.md#initkeyboardmanager). Этот метод создает и инициализирует диспетчер клавиатуры. Если вы создаете диспетчер клавиатуры вручную, вам по-прежнему необходимо вызывать `CWinAppEx::InitKeyboardManager` для его инициализации.

При использовании мастера для создания приложения мастер выполнит инициализацию диспетчера клавиатуры. После того как приложение инициализирует диспетчер клавиатуры, платформа добавляет вкладку **Клавиатура** в диалоговое окно **Настройка** .

## <a name="mouse-customization"></a>Настройка мыши

На следующем рисунке показана вкладка « **мышь** » диалогового окна « **Настройка** ».

![Вкладка "Мышь" в диалоговом окне настройки](../mfc/media/mfcnextmousetab.png "Вкладка "Мышь" в диалоговом окне настройки") <br/>
Вкладка настройки мыши

Пользователь взаимодействует с этой вкладкой, чтобы назначить команду меню для действия двойного щелчка мыши. Пользователь выбирает представление с левой стороны окна, а затем использует элементы управления справа, чтобы связать команду с действием двойного щелчка. После нажатия кнопки **Закрыть**приложение выполняет связанную команду, когда пользователь дважды щелкнет в любом месте представления.

По умолчанию при создании приложения с помощью мастера Настройка мыши не включена.

#### <a name="to-enable-mouse-customization"></a>Включение настройки мыши

1. Инициализируйте объект [кмаусеманажер](reference/cmousemanager-class.md) , вызвав [CWinAppEx:: инитмаусеманажер](reference/cwinappex-class.md#initmousemanager).

1. Получите указатель на диспетчер мыши с помощью [CWinAppEx:: жетмаусеманажер](reference/cwinappex-class.md#getmousemanager).

1. Добавьте представления в диспетчер мыши с помощью метода [кмаусеманажер:: аддвиев](reference/cmousemanager-class.md#addview) . Сделайте это для каждого представления, которое необходимо добавить в диспетчер мыши.

После того как приложение инициализирует диспетчер мыши, платформа добавляет вкладку **мыши** в диалоговое окно **Настройка** . Если не добавить представления, доступ к вкладке вызовет необработанное исключение. После создания списка представлений пользователь может получить доступ к вкладке **мыши** .

При добавлении нового представления в диспетчер мыши ему присваивается уникальный идентификатор. Если требуется обеспечить поддержку настройки мыши для окна, необходимо обработать сообщение WM_LBUTTONDBLCLICK и вызвать функцию [CWinAppEx:: онвиевдаублекликк](reference/cwinappex-class.md#onviewdoubleclick) . При вызове этой функции один из параметров является ИДЕНТИФИКАТОРом этого окна. Программист следит за тем, чтобы отслеживание ИДЕНТИФИКАЦИОНных номеров и связанных с ними объектов было ответственным.

## <a name="security-concerns"></a>Проблемы безопасности

Как описано в разделе пользовательские [средства](user-defined-tools.md), пользователь может связать идентификатор инструмента, определяемый пользователем, с событием двойного щелчка. Когда пользователь дважды щелкает представление, приложение ищет пользовательское средство, соответствующее соответствующему ИДЕНТИФИКАТОРу. Если приложение находит соответствующий инструмент, оно выполняет это средство. Если приложению не удается найти соответствующее средство, оно отправляет WM_COMMAND сообщение с ИДЕНТИФИКАТОРом в представление, которое было дважды выбрано.

Настроенные параметры хранятся в реестре. Изменив реестр, злоумышленник может заменить допустимый идентификатор пользовательского средства произвольной командой. Когда пользователь дважды щелкает представление, оно обрабатывает команду, выданную злоумышленником. Это может привести к непредвиденному и потенциально опасному поведению.

Кроме того, такая атака может обойти защиту пользовательского интерфейса. Например, предположим, что в приложении отключена печать. Это значит, что в пользовательском интерфейсе меню и кнопка **печати** недоступны. Как правило, это предотвращает печать приложения. Но если злоумышленник внес изменения в реестр, пользователь мог бы отправить команду Print напрямую, дважды щелкнув представление, минуя недоступные элементы пользовательского интерфейса.

Чтобы защититься от атак такого рода, добавьте код в обработчик команд приложения, чтобы убедиться, что команда допустима перед выполнением. Не зависят от пользовательского интерфейса, чтобы предотвратить отправку команды приложению.

## <a name="see-also"></a>См. также раздел

[Настройка для MFC](customization-for-mfc.md)<br/>
[Класс CKeyboardManager](reference/ckeyboardmanager-class.md)<br/>
[Класс Кмаусеманажер](reference/cmousemanager-class.md)<br/>
[Влияние настройки на безопасность](security-implications-of-customization.md)
