---
title: 'Элементы ActiveX в MFC: Лицензирование элемента управления ActiveX | Документация Майкрософт'
ms.custom: ''
ms.date: 09/12/2018
ms.technology:
- cpp-mfc
ms.topic: conceptual
f1_keywords:
- COleObjectFactory
dev_langs:
- C++
helpviewer_keywords:
- COleObjectFactory class [MFC], licensing controls
- MFC ActiveX controls [MFC], licensing
- VerifyLicenseKey method [MFC]
- VerifyUserLicense method [MFC]
- GetLicenseKey method [MFC]
- licensing ActiveX controls
ms.assetid: cacd9e45-701a-4a1f-8f1f-b0b39f6ac303
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: b66debe5c6401b4eee01bc81acc58b8445e20c21
ms.sourcegitcommit: a9dcbcc85b4c28eed280d8e451c494a00d8c4c25
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50068779"
---
# <a name="mfc-activex-controls-licensing-an-activex-control"></a>Элементы управления ActiveX в MFC. Лицензирование элемента управления ActiveX

Поддержки лицензирования, дополнительный компонент элементы управления ActiveX, можно контролировать, кто может использовать или распространите элемент управления. (Подробное обсуждение проблем с лицензированием, см. в разделе проблем лицензирования в [обновление существующего элемента управления ActiveX](../mfc/upgrading-an-existing-activex-control.md).)

>[!IMPORTANT]
> ActiveX — это устаревшая технология, которая не следует использовать для разработки новых приложений. Дополнительные сведения о современных технологий, которые следуют за ActiveX, см. в разделе [элементы управления ActiveX](activex-controls.md).

В этой статье рассматриваются следующие темы:

- [Обзор лицензирования элементов управления ActiveX](#_core_overview_of_activex_control_licensing)

- [Создание лицензированный элемент управления](#_core_creating_a_licensed_control)

- [Поддержка лицензионных функций](#_core_licensing_support)

- [Настройка Лицензирование элементов управления ActiveX](#_core_customizing_the_licensing_of_an_activex_control)

Элементы управления ActiveX, которые реализуют лицензирования можно, как разработчик элемента управления, чтобы определить, как другие пользователи будут использовать элемент управления ActiveX. Укажите покупатель элемента управления с элементом управления и. Файл LIC, по соглашению, что покупатель может распространять элемент управления, но не. Файл LIC с приложением, используется элемент управления. Благодаря этому пользователи этого приложения от написания новых приложений, использующих элемент управления без первого Лицензирование элемента управления, от вас.

##  <a name="_core_overview_of_activex_control_licensing"></a> Обзор лицензирования элементов управления ActiveX

Чтобы обеспечить поддержку лицензирования для элементов управления ActiveX, [COleObjectFactory](../mfc/reference/coleobjectfactory-class.md) класс предоставляет реализацию для нескольких функций в `IClassFactory2` интерфейс: `IClassFactory2::RequestLicKey`, `IClassFactory2::GetLicInfo`, и `IClassFactory2::CreateInstanceLic`. Когда разработчик приложения контейнера выполняет запрос для создания экземпляра элемента управления, вызов `GetLicInfo` вносится убедитесь, что элемент управления. Файл LIC присутствует. Если элемент управления предоставляется по лицензии, экземпляр элемента управления можно создать и расположен в контейнере. После завершения создания приложения-контейнера разработчик другую функцию вызвать, чтобы `RequestLicKey`, выполняется. Эта функция возвращает лицензионный ключ (простая символьная строка) для приложения-контейнера. Возвращаемый ключ включается в приложении.

На рисунке ниже показано проверки лицензии элемента управления ActiveX, который будет использоваться во время разработки приложения-контейнера. Как упоминалось ранее, разработчик приложения контейнера должен иметь правильные. Файл LIC установлен на компьютере разработки для создания экземпляра элемента управления.

![Лицензия управления ActiveX, проверяемый на этапе разработки](../mfc/media/vc374d1.gif "vc374d1") проверки лицензии ActiveX элемента управления во время разработки

Следующий процесс, показанный на рисунке ниже, выполняется, когда пользователь запускает приложение-контейнер.

Когда приложение запускается, экземпляр элемента управления обычно необходимо создать. Контейнер этого вносит вызов `CreateInstanceLic`, передавая embedded лицензионный ключ в качестве параметра. Сравнение строк, после чего производится между embedded лицензионный ключ и элемента управления собственной копии лицензионный ключ. Если сопоставление является успешным, создается экземпляр элемента управления, и приложение продолжает выполняться обычным образом. Обратите внимание, что. Файл LIC не обязательно на компьютер пользователя элемента управления.

![Лицензия управления ActiveX, проверяемый на этапе выполнения](../mfc/media/vc374d2.gif "vc374d2") проверки лицензии ActiveX элемента управления во время выполнения

Лицензирование элементов управления состоит из двух основных компонентов: конкретный код в реализации элемента управления библиотеки DLL и файл лицензии. Код состоит из двух (или даже три) вызовов функций и строку символов, далее — «лицензии строкой», содержащий уведомление об авторских правах. Эти вызовы и строке лицензий можно найти в реализации элемента управления (. Файл CPP). Файл лицензии, созданного мастером элемента управления ActiveX — это текстовый файл с заявление об авторских правах. Он имеет имя, использование имени проекта с. Расширение лицензионное соглашение, например образец. ЛИЦЕНЗИОННОЕ СОГЛАШЕНИЕ. Лицензированный элемент управления должен сопровождаться файл лицензии при необходимости использования во время разработки.

##  <a name="_core_creating_a_licensed_control"></a> Создание лицензированный элемент управления

При использовании мастера элементов управления ActiveX для создания инфраструктуры управления несложно включает лицензию на поддержку. При указании, что элемент управления должен иметь лицензию во время выполнения, мастер элементов управления ActiveX добавляет код в класс элемента управления для поддержки лицензирования. Код состоит из функций, использующих файл ключа и лицензии для проверки лицензии. Эти функции также могут быть изменены для настройки лицензирования элементов управления. Дополнительные сведения о лицензии настройки, см. в разделе [Настройка Лицензирование элементов управления ActiveX](#_core_customizing_the_licensing_of_an_activex_control) далее в этой статье.

#### <a name="to-add-support-for-licensing-with-the-activex-control-wizard-when-you-create-your-control-project"></a>Чтобы добавить поддержку для лицензирования с помощью мастера элементов управления ActiveX, при создании проекта элемента управления

1. Инструкции см. в [Создание элемента управления ActiveX в MFC](../mfc/reference/creating-an-mfc-activex-control.md). **Параметры приложения** страница мастера элементов управления ActiveX содержит параметр, чтобы создать элемент управления с лицензией на время выполнения.

Мастер элементов управления ActiveX создает фреймворк элемента управления ActiveX, который включает в себя базовую поддержку лицензирования. Подробное описание лицензирования кода см. следующий раздел.

##  <a name="_core_licensing_support"></a> Поддержка лицензионных функций

При использовании мастера элементов управления ActiveX для добавления поддержка лицензионных функций в элемент управления ActiveX, мастер элементов управления ActiveX добавляет код, который объявляет и реализует возможности лицензирования добавляется к заголовку элемента управления и реализации файлы. Этот код представляет собой `VerifyUserLicense` функция-член и `GetLicenseKey` функцией-членом, которая реализации по умолчанию, в Переопределите [COleObjectFactory](../mfc/reference/coleobjectfactory-class.md) . Эти функции, извлечь и проверить лицензии элемента управления.

> [!NOTE]
>  Третья функция-член `VerifyLicenseKey` не создается с помощью мастера управления ActiveX, но можно переопределить для настройки поведения проверки ключа лицензии.

Эти функции-члены являются:

- [VerifyUserLicense](../mfc/reference/coleobjectfactory-class.md#verifyuserlicense)

   Проверяет, что элемент управления допускает использование разработки путем проверки системы на наличие файла лицензии элемента управления. Эта функция вызывается платформой при обработке `IClassFactory2::GetLicInfo` и `IClassFactory::CreateInstanceLic`.

- [GetLicenseKey](../mfc/reference/coleobjectfactory-class.md#getlicensekey)

   Запрашивает уникальный ключ из элемента управления библиотеки DLL. Этот ключ внедренных в приложение-контейнер и более поздних версиях используется в сочетании с `VerifyLicenseKey`, для создания экземпляра элемента управления. Эта функция вызывается платформой при обработке `IClassFactory2::RequestLicKey`.

- [VerifyLicenseKey](../mfc/reference/coleobjectfactory-class.md#verifylicensekey)

   Проверяет, что внедренный ключ и уникальные ключи элемента управления совпадают. Это позволяет контейнеру для создания экземпляра элемента управления для его использования. Эта функция вызывается платформой при обработке `IClassFactory2::CreateInstanceLic` и можно переопределить, указав настроенным проверочным лицензионного ключа. Реализация по умолчанию выполняет сравнение строк. Дополнительные сведения см. в разделе [Настройка Лицензирование элементов управления ActiveX](#_core_customizing_the_licensing_of_an_activex_control)далее в этой статье.

###  <a name="_core_header_file_modifications"></a> Изменения файла заголовка

Мастер элементов управления ActiveX переводит следующий код в файле заголовка элемента управления. В этом примере две функции-члены `CSampleCtrl`в объект `factory` объявлены, который проверяет наличие элемента управления. Файл LIC и еще одно, которое извлекает лицензионный ключ для использования в приложения, содержащего элемент управления:

[!code-cpp[NVC_MFC_AxUI#39](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_1.h)]

###  <a name="_core_implementation_file_modifications"></a> Изменения файла реализации

Мастер элементов управления ActiveX помещает следующие две инструкции в файле реализации элемента управления для объявления имени файла лицензии и лицензии строки:

[!code-cpp[NVC_MFC_AxUI#40](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_2.cpp)]

> [!NOTE]
>  При изменении `szLicString` любым способом, необходимо также изменить первую строку в элементе управления. Файл LIC или лицензирования будет работать неправильно.

Мастер элементов управления ActiveX помещает следующий код в файле реализации элемента управления, чтобы определить класс элемента управления `VerifyUserLicense` и `GetLicenseKey` функции:

[!code-cpp[NVC_MFC_AxUI#41](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_3.cpp)]

Наконец **мастер элементов управления ActiveX** вносит изменения в проект элемента управления. IDL-файла. **Лицензированные** компонентный класс объявление элемента управления, как показано в следующем примере добавляется ключевое слово:

[!code-cpp[NVC_MFC_AxUI#42](../mfc/codesnippet/cpp/mfc-activex-controls-licensing-an-activex-control_4.idl)]

##  <a name="_core_customizing_the_licensing_of_an_activex_control"></a> Настройка Лицензирование элементов управления ActiveX

Так как `VerifyUserLicense`, `GetLicenseKey`, и `VerifyLicenseKey` объявляются как виртуальные функции-члены класса фабрики элемента управления, можно настроить лицензирования поведение элемента управления.

Например, можно предоставить несколько уровней лицензирования для элемента управления путем переопределения `VerifyUserLicense` или `VerifyLicenseKey` функций-членов. В этой функции вы можете изменить, какие свойства или методы представляются пользователю в соответствии с уровнем лицензии, возникновения.

Можно также добавить код для `VerifyLicenseKey` функция, которая предоставляет настраиваемый метод, не сообщая пользователю, что управления созданием. Например, в вашей `VerifyLicenseKey` поле функция-член можно отобразить сообщение о том, что элемент управления не удалось инициализировать и почему.

> [!NOTE]
>  Другой способ настройки проверки лицензии для элемента управления ActiveX — проверьте регистрации базы данных для определенного раздела реестра, вместо вызова метода `AfxVerifyLicFile`. Пример реализации по умолчанию, см. в разделе [изменения файла реализации](#_core_implementation_file_modifications) этой статьи.

Подробное обсуждение проблем с лицензированием, см. в разделе проблем лицензирования в [обновление существующего элемента управления ActiveX](../mfc/upgrading-an-existing-activex-control.md).

## <a name="see-also"></a>См. также

[Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)<br/>
[Мастер элементов ActiveX MFC](../mfc/reference/mfc-activex-control-wizard.md)

