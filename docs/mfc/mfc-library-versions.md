---
title: Версии библиотек MFC
ms.date: 05/08/2019
helpviewer_keywords:
- class libraries [MFC], building versions
- version information [MFC], MFC library
- MFC class library
- MFC class library, building
- MFC libraries
- MFC, library versions
- libraries [MFC], versions
ms.openlocfilehash: b8e32366d9ff43bd6e5770f64f0ba9d8bf6e56ab
ms.sourcegitcommit: 3e8fa01f323bc5043a48a0c18b855d38af3648d4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78856804"
---
# <a name="mfc-library-versions"></a>Версии библиотек MFC

Библиотека MFC доступна в версиях, поддерживающих однобайтовые и многобайтовые кодировки (MBCS), а также версии, поддерживающие Юникод (кодировка UTF-16LE, собственная кодировка Windows). Каждая версия MFC доступна как статическая библиотека или как общая библиотека DLL. Также существует небольшая версия статической библиотеки MFC, которая оставляет элементы управления MFC для диалоговых окон, для приложений, которые очень чувствительны к размеру и не нуждаются в этих элементах управления. Библиотеки MFC доступны как в отладочной, так и в окончательной версиях для поддерживаемых архитектур, включающих процессоры x86, x64 и ARM. Можно создать оба приложения (exe-файлы) и библиотеки DLL с любой версией библиотек MFC. Существует также набор библиотек MFC, скомпилированных для взаимодействия с управляемым кодом. Общие библиотеки DLL MFC содержат номер версии, указывающий совместимость с двоичными файлами библиотеки.

## <a name="automatic-linking-of-mfc-library-versions"></a>Автоматическое связывание версий библиотеки MFC

Файлы заголовков MFC автоматически определяют правильную версию библиотеки MFC для связывания на основе значений, определенных в среде сборки. Файлы заголовков MFC добавляют директивы компилятора, указывающие компоновщику ссылаться на определенную версию библиотеки MFC.

Например, AFX. H-файл заголовка указывает компоновщику ссылаться на полную статическую, ограниченную статическую или общую версию библиотеки DLL MFC; ANSI/MBCS или версия Юникода; и отладочная или розничная версия, в зависимости от конфигурации сборки:

```cpp
#ifndef _AFXDLL
    #ifdef _AFX_NO_MFC_CONTROLS_IN_DIALOGS
        #ifdef _DEBUG
            #pragma comment(lib, "afxnmcdd.lib")
        #else
            #pragma comment(lib, "afxnmcd.lib")
        #endif
        #pragma comment(linker, "/include:__afxNoMFCControlSupportInDialogs")
        #pragma comment(linker, "/include:__afxNoMFCControlContainerInDialogs")
    #endif
    #ifndef _UNICODE
        #ifdef _DEBUG
            #pragma comment(lib, "nafxcwd.lib")
        #else
            #pragma comment(lib, "nafxcw.lib")
        #endif
    #else
        #ifdef _DEBUG
            #pragma comment(lib, "uafxcwd.lib")
        #else
            #pragma comment(lib, "uafxcw.lib")
        #endif
    #endif
#else
    #ifndef _UNICODE
        #ifdef _DEBUG
            #pragma comment(lib, "mfc" _MFC_FILENAME_VER "d.lib")
            #pragma comment(lib, "mfcs" _MFC_FILENAME_VER "d.lib")
        #else
            #pragma comment(lib, "mfc" _MFC_FILENAME_VER ".lib")
            #pragma comment(lib, "mfcs" _MFC_FILENAME_VER ".lib")
        #endif
    #else
        #ifdef _DEBUG
            #pragma comment(lib, "mfc" _MFC_FILENAME_VER "ud.lib")
            #pragma comment(lib, "mfcs" _MFC_FILENAME_VER "ud.lib")
        #else
            #pragma comment(lib, "mfc" _MFC_FILENAME_VER "u.lib")
            #pragma comment(lib, "mfcs" _MFC_FILENAME_VER "u.lib")
        #endif
    #endif
#endif
```

Файлы заголовков MFC также включают директивы для связи во всех необходимых библиотеках, включая библиотеки MFC, библиотеки Win32, библиотеки OLE, библиотеки OLE, построенные на основе примеров, библиотек ODBC и т. д.

## <a name="ansi-mbcs-and-unicode"></a>ANSI, MBCS и Юникод

Версии библиотеки MFC ANSI/MBCS поддерживают однобайтовые наборы символов, такие как ASCII, и многобайтовые кодировки, например Shift-JIS. Версии библиотеки MFC в Юникоде поддерживают Юникод в виде кодировки UTF-16LE для расширенных символов. Используйте библиотеки ANSI/MBCS версии MFC для поддержки Юникода в кодировке UTF-8.

Чтобы настроить конфигурацию проекта для использования однобайтовой, многобайтовой или расширенной символьной строки Юникода и поддержки символов в интегрированной среде разработки, используйте диалоговое окно **Свойства проекта** . На странице **Свойства конфигурации** > **Общие** задайте **для свойства кодировка значение** **не задано** значение использовать однобайтовую кодировку. Задайте для свойства значение, чтобы использовать **многобайтовую** кодировку для кодировки в кодировке Юникод, или используйте кодировку **Юникод** для кодировки UTF-16.

Проекты MFC используют символ препроцессора \_Юникод, чтобы указать поддержку Юникода в кодировке UTF-16 и \_MBCS для обозначения поддержки MBCS. Эти параметры являются взаимоисключающими в проекте.

## <a name="mfc-static-library-naming-conventions"></a>Соглашения об именовании статических библиотек MFC

Статические библиотеки для MFC используют следующие соглашения об именовании. Имена библиотек имеют форму

> <em>u</em> <em>Компакт-диск</em>AFX. LIB

буквы, показанные курсивом в нижнем регистре, являются заполнителями для описателей, значения которых перечислены в следующей таблице.

|класса хранения|Значения и смысл|
|---------------|-------------------------|
|*u*|ANSI/MBCS (N) или Unicode (U); пропустить для версии без элементов управления MFC в диалоговых окнах|
|*c*|Версия с элементами управления MFC в диалоговых окнах (во вт.) или без них (НМКД)|
|*d*|Отладка или выпуск: D = отладка; опустить спецификатор для выпуска|

Все библиотеки, перечисленные в следующей таблице, включены в каталог \атлмфк\либ для поддерживаемых архитектур сборки.

|Библиотека|Description|
|-------------|-----------------|
|NAFXCW.LIB|Библиотека статической компоновки MFC, версия выпуска|
|NAFXCWD.LIB|Библиотека статической компоновки MFC, отладочная версия|
|УАФКСКВ. LIB|Библиотека статической компоновки MFC с поддержкой Юникода, версия выпуска|
|УАФКСКВД. LIB|Библиотека статической компоновки MFC с поддержкой Юникода, отладочная версия|
|AFXNMCD.LIB|Библиотека статической компоновки MFC без элементов управления диалогового окна MFC, версия выпуска|
|АФКСНМКДД. LIB|Библиотека статической компоновки MFC без элементов управления диалогового окна MFC, отладочная версия|

Файлы отладчика, имеющие одно и то же базовое имя и расширение PDB, также доступны для каждой из статических библиотек.

## <a name="mfc-shared-dll-naming-conventions"></a>Соглашения об именовании общих библиотек DLL MFC

Общие библиотеки DLL MFC также соответствуют структурированному соглашению об именовании. Это упрощает знание библиотеки DLL или библиотеки, которые следует использовать для этой цели.

Библиотеки DLL MFC имеют номера *версий* , которые указывают на совместимость с двоичными файлами. Используйте библиотеки DLL MFC, имеющие ту же версию, что и другие библиотеки, и набор средств компилятора для обеспечения совместимости в рамках проекта.

|DLL-библиотеки|Description|
|---------|-----------------|
|*Версия*MFC. КОМПОНОВКИ|DLL MFC, версия для выпуска ANSI или MBCS|
|Библиотека MFC*версии*U. dll|Библиотека DLL MFC, версия выпуска Юникод|
|Библиотека MFC*версии*D. dll|DLL MFC, отладочная версия ANSI или MBCS|
|MFC*версии*обновления. КОМПОНОВКИ|Библиотека DLL MFC, отладочная версия Юникода|
|*Версия*мфкм. КОМПОНОВКИ|Библиотека DLL MFC с элементами управления Windows Forms, версией ANSI или MBCS|
|МФКМ*версия*U. dll|Библиотека DLL MFC с элементами управления Windows Forms, версия выпуска Юникод|
|МФКМ*версия*D. dll|Библиотека DLL MFC с элементами управления Windows Forms, отладочной версией ANSI или MBCS|
|МФКМ*версия*обновления. КОМПОНОВКИ|Библиотека DLL MFC с элементами управления Windows Forms, отладочная версия Юникода|

Библиотеки импорта, необходимые для создания приложений или библиотек расширения MFC, использующих эти общие библиотеки DLL, имеют то же базовое имя, что и библиотека DLL, но имеют расширение имени LIB-файла. При использовании общих библиотек DLL, небольшая статическая библиотека по-прежнему должна быть связана с кодом. Эта библиотека называется МФКС*версии*{U} {D}. lib.

Если вы динамически связываетесь с общей библиотекой DLL MFC, будь это из приложения или библиотеки DLL расширения MFC, необходимо включить соответствующую*версию*MFC. DLL или MFC*версии*U. dll при развертывании продукта.

Список визуальных C++ библиотек DLL, которые могут распространяться вместе с приложениями, см. в разделе [распространяемый код для Microsoft Visual Studio 2017 и Microsoft Visual Studio 2017 SDK (включая служебные программы и файлы BuildServer)](/visualstudio/productinfo/2017-redistribution-vs) или [распространяемый код для Visual Studio 2019](/visualstudio/releases/2019/redistribution).

Дополнительные сведения о поддержке многобайтовых кодировок и Юникода в MFC см. в разделе [Поддержка Юникода и многобайтовой кодировки (MBCS)](../atl-mfc-shared/unicode-and-multibyte-character-set-mbcs-support.md).

## <a name="dynamic-link-library-support"></a>Поддержка библиотек динамической компоновки

Можно использовать статические или общие динамические библиотеки MFC для создания библиотек DLL, которые могут использоваться как в MFC, так и в исполняемых файлах, отличных от MFC. Они называются "обычными библиотеками DLL" или "регулярными библиотеками MFC", чтобы отличать их от библиотек расширения MFC, которые могут использоваться только приложениями MFC и библиотеками DLL MFC. Библиотека DLL, созданная с помощью статических библиотек MFC, иногда называется УСРДЛЛ в старых ссылках, так как проекты DLL MFC определяют символ препроцессора **\_усрдлл**. Библиотека DLL, использующая общие библиотеки DLL MFC, иногда называется AFXDLL в старых ссылках, так как она определяет символ препроцессора **\_AFXDLL**.

При создании проекта библиотеки DLL путем связывания с статическими библиотеками MFC библиотека DLL может быть развернута без общих библиотек DLL MFC. Если проект библиотеки DLL ссылается на*версию*MFC библиотек импорта. LIB или MFC*версии*U. lib необходимо развернуть СООТВЕТСТВУЮЩУЮ*версию*MFC Shared DLL для MFC. DLL или MFC*версии*U. dll вместе с библиотекой DLL. Дополнительные сведения см. в разделе [DLL](../build/dlls-in-visual-cpp.md).

## <a name="see-also"></a>См. также раздел

[Общие разделы по MFC](../mfc/general-mfc-topics.md)
