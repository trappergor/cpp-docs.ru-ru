---
title: Класс Цинтернетсессион
ms.date: 06/20/2018
f1_keywords:
- CInternetSession
- AFXINET/CInternetSession
- AFXINET/CInternetSession::CInternetSession
- AFXINET/CInternetSession::Close
- AFXINET/CInternetSession::EnableStatusCallback
- AFXINET/CInternetSession::GetContext
- AFXINET/CInternetSession::GetCookie
- AFXINET/CInternetSession::GetCookieLength
- AFXINET/CInternetSession::GetFtpConnection
- AFXINET/CInternetSession::GetGopherConnection
- AFXINET/CInternetSession::GetHttpConnection
- AFXINET/CInternetSession::OnStatusCallback
- AFXINET/CInternetSession::OpenURL
- AFXINET/CInternetSession::SetCookie
- AFXINET/CInternetSession::SetOption
helpviewer_keywords:
- CInternetSession [MFC], CInternetSession
- CInternetSession [MFC], Close
- CInternetSession [MFC], EnableStatusCallback
- CInternetSession [MFC], GetContext
- CInternetSession [MFC], GetCookie
- CInternetSession [MFC], GetCookieLength
- CInternetSession [MFC], GetFtpConnection
- CInternetSession [MFC], GetGopherConnection
- CInternetSession [MFC], GetHttpConnection
- CInternetSession [MFC], OnStatusCallback
- CInternetSession [MFC], OpenURL
- CInternetSession [MFC], SetCookie
- CInternetSession [MFC], SetOption
ms.assetid: ef54feb4-9d0f-4e65-a45d-7a4cf6c40e51
ms.openlocfilehash: c9b8eaf51820dfcd08c1390c8645978fa403931d
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69505845"
---
# <a name="cinternetsession-class"></a>Класс Цинтернетсессион

Создает и инициализирует один или несколько параллельных сеансов Интернета и, при необходимости, описывает подключение к прокси-серверу.

## <a name="syntax"></a>Синтаксис

```cpp
class CInternetSession : public CObject
```

## <a name="members"></a>Участники

### <a name="public-constructors"></a>Открытые конструкторы

|name|Описание|
|----------|-----------------|
|[Цинтернетсессион:: Цинтернетсессион](#cinternetsession)|Создает объект `CInternetSession`.|

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[Цинтернетсессион:: Close](#close)|Закрывает подключение к Интернету по завершении сеанса Интернета.|
|[Цинтернетсессион:: Енаблестатускаллбакк](#enablestatuscallback)|Устанавливает подпрограммы обратного вызова состояния.|
|[Цинтернетсессион:: SPContext](#getcontext)|Закрывает подключение к Интернету по завершении сеанса Интернета.|
|[Цинтернетсессион:: Кука](#getcookie)|Возвращает файлы cookie для указанного URL-адреса и всех его родительских URL-адресов.|
|[Цинтернетсессион:: Жеткукиеленгс](#getcookielength)|Извлекает переменную, указывающую длину файла cookie, хранящегося в буфере.|
|[Цинтернетсессион:: Жетфтпконнектион](#getftpconnection)|Открывает сеанс FTP с сервером. Журналы для пользователя.|
|[Цинтернетсессион:: Жетгоферконнектион](#getgopherconnection)|Открывает сервер gopher для приложения, которое пытается открыть подключение.|
|[Цинтернетсессион:: Жесттпконнектион](#gethttpconnection)|Открывает HTTP-сервер для приложения, которое пытается открыть соединение.|
|[Цинтернетсессион:: Онстатускаллбакк](#onstatuscallback)|Обновляет состояние операции, если включен обратный вызов состояния.|
|[Цинтернетсессион:: OpenURL](#openurl)|Выполняет синтаксический анализ и открывает URL-адрес.|
|[Цинтернетсессион:: SetCookie](#setcookie)|Задает файл cookie для указанного URL-адреса.|
|[Цинтернетсессион:: SetOption](#setoption)|Задает параметры для сеанса Интернета.|

### <a name="public-operators"></a>Открытые операторы

|name|Описание|
|----------|-----------------|
|[Цинтернетсессион:: operator ХИНТЕРНЕТ](#operator_hinternet)|Маркер текущего сеанса Интернета.|

## <a name="remarks"></a>Примечания

Если подключение к Интернету должно поддерживаться в течение всего приложения, можно создать `CInternetSession` член класса [CWinApp](../../mfc/reference/cwinapp-class.md).

После установки сеанса Интернета можно вызвать [OpenURL](#openurl). `CInternetSession`затем анализирует URL-адрес, вызывая глобальную функцию [афкспарсеурл](internet-url-parsing-globals.md#afxparseurl). Независимо от типа протокола, `CInternetSession` интерпретирует URL-адрес и управляет им. Он может выполнять запросы для локальных файлов, указанных с помощью URL-адреса "file://". `OpenURL`Возвращает указатель на объект [кстдиофиле](../../mfc/reference/cstdiofile-class.md) , если передаваемое ему имя является локальным файлом.

Если открыть URL-адрес на сервере в Интернете с `OpenURL`помощью, можно прочитать сведения с сайта. Если требуется выполнить действия, зависящие от службы (например, HTTP, FTP или gopher), для файлов, расположенных на сервере, необходимо установить соответствующее подключение к этому серверу. Чтобы открыть определенный тип подключения непосредственно к определенной службе, используйте одну из следующих функций-членов:

- [Жетгоферконнектион](#getgopherconnection) , чтобы открыть подключение к службе Gopher.

- [Жесттпконнектион](#gethttpconnection) , чтобы открыть подключение к службе HTTP.

- [Жетфтпконнектион](#getftpconnection) для открытия подключения к службе FTP.

[SetOption](#setoption) позволяет задать параметры запроса сеанса, например значения времени ожидания, число повторных попыток и т. д.

`CInternetSession`функции-члены [SetCookie](#setcookie), [Кука](#getcookie)и [жеткукиеленгс](#getcookielength) предоставляют средства для управления базой данных файлов cookie Win32, с помощью которых серверы и сценарии сохраняют сведения о состоянии клиентской рабочей станции.

Дополнительные сведения о базовых задачах программирования через Интернет см. в [статье первые шаги в Интернете: WinInet](../../mfc/wininet-basics.md). Общие сведения об использовании классов MFC WinInet см. в статье Интернет – [программирование с помощью WinInet](../../mfc/win32-internet-extensions-wininet.md).

> [!NOTE]
> `CInternetSession`выдаст исключение [афкссровнотсуппортедексцептион](exception-processing.md#afxthrownotsupportedexception) для неподдерживаемых типов служб. В настоящее время поддерживаются только следующие типы служб: FTP, HTTP, Gopher и File.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;`CInternetSession`

## <a name="requirements"></a>Требования

**Заголовок:** афксинет. h

## <a name="cinternetsession"></a>Цинтернетсессион:: Цинтернетсессион

Эта функция-член вызывается при `CInternetSession` создании объекта.

```cpp
CInternetSession(
    LPCTSTR pstrAgent = NULL,
    DWORD_PTR dwContext = 1,
    DWORD dwAccessType = PRE_CONFIG_INTERNET_ACCESS,
    LPCTSTR pstrProxyName = NULL,
    LPCTSTR pstrProxyBypass = NULL,
    DWORD dwFlags = 0);
```

### <a name="parameters"></a>Параметры

*пстражент*<br/>
Указатель на строку, определяющую имя приложения или сущности, вызывающей функции Интернета (например, "Microsoft Internet Browser"). Если *пстражент* имеет значение null (значение по умолчанию), платформа вызывает глобальную функцию [афксжетаппнаме](application-information-and-management.md#afxgetappname), которая возвращает строку, завершающуюся нулем, содержащую имя приложения. Некоторые протоколы используют эту строку для обнаружения приложения на сервере.

*двконтекст*<br/>
Идентификатор контекста для операции. *двконтекст* определяет сведения о состоянии операции, возвращаемые [Цинтернетсессион:: онстатускаллбакк](#onstatuscallback). Значение по умолчанию — 1; Однако для операции можно явно назначить конкретный идентификатор контекста. Объект и все его работа будут связаны с ИДЕНТИФИКАТОРом контекста.

*двакцесстипе*<br/>
Необходимый тип доступа. Ниже приведены допустимые значения, в точности одно из которых может быть указано:

- INTERNET_OPEN_TYPE_PRECONFIG подключение с помощью предварительно настроенных параметров в реестре. Этот тип доступа задан в качестве значения по умолчанию. Чтобы подключиться через прокси-сервер TIS, задайте для *двакцесстипе* это значение. Затем необходимо настроить реестр соответствующим образом.

- INTERNET_OPEN_TYPE_DIRECT подключение напрямую к Интернету.

- INTERNET_OPEN_TYPE_PROXY подключается через прокси-сервер CERN.

Сведения о подключении с использованием разных типов прокси-серверов см. [в разделе действия в типичном клиентском приложении FTP](../../mfc/steps-in-a-typical-ftp-client-application.md).

*пстрпроксинаме*<br/>
Имя предпочтительного прокси-сервера CERN, если для *двакцесстипе* задано значение INTERNET_OPEN_TYPE_PROXY. Значение по умолчанию — NULL.

*пстрпроксибипасс*<br/>
Указатель на строку, содержащую необязательный список адресов серверов. Эти адреса можно обходить при использовании прокси-доступа. Если указано значение NULL, список обхода будет считан из реестра. Этот параметр имеет смысл только в том случае, если для *двакцесстипе* задано значение INTERNET_OPEN_TYPE_PROXY.

*dwFlags*<br/>
Указывает различные параметры кэширования. Значение по умолчанию — 0. Возможные значения:

- INTERNET_FLAG_DONT_CACHE не кэшируют данные локально или на всех серверах шлюзов.

- Операции скачивания INTERNET_FLAG_OFFLINE выполняются только через постоянный кэш. Если элемент не существует в кэше, возвращается соответствующий код ошибки. Этот флаг можно сочетать с оператором побитового **&#124;** **или** ().

### <a name="remarks"></a>Примечания

`CInternetSession`— Это первая Интернет-функция, вызываемая приложением. Он инициализирует внутренние структуры данных и готовится к последующим вызовам из приложения.

Если не удается открыть подключение к Интернету, `CInternetSession` вызывает исключение [афкссровинтернетексцептион](internet-url-parsing-globals.md#afxthrowinternetexception).

### <a name="example"></a>Пример

См. пример для [кфтпфилефинд](../../mfc/reference/cftpfilefind-class.md).

## <a name="close"></a>Цинтернетсессион:: Close

Вызовите эту функцию члена, `CInternetSession` когда приложение завершит использование объекта.

```cpp
virtual void Close();
```

### <a name="example"></a>Пример

См. пример для [кфтпфилефинд](../../mfc/reference/cftpfilefind-class.md).

## <a name="enablestatuscallback"></a>Цинтернетсессион:: Енаблестатускаллбакк

Вызовите эту функцию члена, чтобы включить обратный вызов состояния.

```cpp
BOOL EnableStatusCallback(BOOL bEnable = TRUE);
```

### <a name="parameters"></a>Параметры

*bEnable*<br/>
Указывает, включен или отключен обратный вызов. Значение по умолчанию — TRUE.

### <a name="return-value"></a>Возвращаемое значение

Имеет ненулевое значение в случае успешного выполнения, иначе — 0. Если вызов завершается неудачно, определите причину сбоя, изучив сгенерированный объект [Цинтернетексцептион](../../mfc/reference/cinternetexception-class.md) .

### <a name="remarks"></a>Примечания

При обработке обратного вызова состояния можно указать состояние выполнения операции (например, разрешение имени, подключение к серверу и т. д.) в строке состояния приложения. Отображение состояния операции особенно желательно во время долгосрочной работы.

Поскольку обратные вызовы происходят во время обработки запроса, приложение должно в обратном вызове тратить как можно меньше времени, чтобы предотвратить снижение пропускной способности данных в сети. Например, Размещение диалогового окна в обратном вызове может быть такой длительной операцией, что сервер прерывает запрос.

Обратный вызов состояния не может быть удален, пока ожидаются все обратные вызовы.

Для асинхронной обработки любых операций необходимо либо создать собственный поток, либо использовать функции WinInet без MFC.

## <a name="getcontext"></a>Цинтернетсессион:: SPContext

Вызовите эту функцию-член, чтобы получить значение контекста для конкретного сеанса приложения.

```cpp
DWORD_PTR GetContext() const;
```

### <a name="return-value"></a>Возвращаемое значение

Идентификатор контекста, определяемый приложением.

### <a name="remarks"></a>Примечания

[Онстатускаллбакк](#onstatuscallback) использует идентификатор контекста, возвращенный `GetContext` , для сообщения о состоянии конкретного приложения. Например, когда пользователь активирует Интернет-запрос, включающий в себя возвращаемые сведения о состоянии, обратный вызов состояния использует идентификатор контекста для сообщения о состоянии конкретного запроса. Если пользователь активирует два отдельных запроса в Интернете, которые в обоих случаях возвращают сведения `OnStatusCallback` о состоянии, использует идентификаторы контекста для возврата состояния соответствующих запросов. Следовательно, идентификатор контекста используется для всех операций обратного вызова состояния и связан с сеансом до завершения сеанса.

Дополнительные сведения об асинхронных операциях см. в [статье первые шаги в Интернете: WinInet](../../mfc/wininet-basics.md).

## <a name="getcookie"></a>Цинтернетсессион:: Кука

Эта функция члена реализует поведение функции Win32 [интернетжеткукие](/windows/win32/api/wininet/nf-wininet-internetgetcookiew), как описано в Windows SDK.

```cpp
static BOOL GetCookie(
    LPCTSTR pstrUrl,
    LPCTSTR pstrCookieName,
    LPTSTR pstrCookieData,
    DWORD dwBufLen);

static BOOL GetCookie(
    LPCTSTR pstrUrl,
    LPCTSTR pstrCookieName,
    CString& strCookieData);
```

### <a name="parameters"></a>Параметры

*пструрл*<br/>
Указатель на строку, содержащую URL-адрес.

*пстркукиенаме*<br/>
Указатель на строку, содержащую имя файла cookie для получения по указанному URL-адресу.

*пстркукиедата*<br/>
В первой перегрузке указатель на строку, содержащую адрес буфера, который получает данные файла cookie. Это значение может быть равно NULL. Во второй перегрузке ссылка на объект [CString](../../atl-mfc-shared/reference/cstringt-class.md) для получения данных файла cookie.

*двбуфлен*<br/>
Переменная, указывающая размер буфера *пстркукиедата* . Если функция выполнена, буфер получает объем данных, скопированных в буфер *пстркукиедата* . Если *пстркукиедата* имеет значение null, этот параметр получает значение, указывающее размер буфера, необходимого для копирования всех данных файла cookie.

### <a name="return-value"></a>Возвращаемое значение

Возвращает значение TRUE, если успешно, или FALSE в противном случае. Если вызов завершается неудачно, вызовите функцию Win32 [GetLastError](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) , чтобы определить причину ошибки. Применяются следующие значения ошибок.

- ERROR_NO_MORE_ITEMS для указанного URL-адреса и всех его родителей отсутствует файл cookie.

- ERROR_INSUFFICIENT_BUFFER. значение, переданное в *двбуфлен* , недостаточно для копирования всех данных файла cookie. Значение, возвращаемое в *двбуфлен* , — это размер буфера, необходимого для получения всех данных.

### <a name="remarks"></a>Примечания

Во второй перегрузке MFC получает данные файла cookie в указанный `CString` объект.

## <a name="getcookielength"></a>Цинтернетсессион:: Жеткукиеленгс

Вызовите эту функцию-член, чтобы получить длину файла cookie, хранящегося в буфере.

```cpp
static DWORD GetCookieLength(
    LPCTSTR pstrUrl,
    LPCTSTR pstrCookieName);
```

### <a name="parameters"></a>Параметры

*пструрл*<br/>
Указатель на строку, содержащую URL-адрес

*пстркукиенаме*<br/>
Указатель на строку, содержащую имя файла cookie.

### <a name="return-value"></a>Возвращаемое значение

Значение типа DWORD, указывающее длину файла cookie, хранящегося в буфере. Нуль, если отсутствует файл cookie с именем, указанным параметром *пстркукиенаме* .

### <a name="remarks"></a>Примечания

Это значение используется в параметре [Кука](#getcookie).

## <a name="getftpconnection"></a>Цинтернетсессион:: Жетфтпконнектион

Вызовите эту функцию-член, чтобы установить соединение по FTP и получить указатель `CFtpConnection` на объект.

```cpp
CFtpConnection* GetFtpConnection(
    LPCTSTR pstrServer,
    LPCTSTR pstrUserName = NULL,
    LPCTSTR pstrPassword = NULL,
    INTERNET_PORT nPort = INTERNET_INVALID_PORT_NUMBER,
    BOOL bPassive = FALSE);
```

### <a name="parameters"></a>Параметры

*пстрсервер*<br/>
Указатель на строку, содержащую имя FTP-сервера.

*пструсернаме*<br/>
Указатель на строку, завершающуюся нулем, которая указывает имя пользователя для входа. Если значение равно NULL, значение по умолчанию — Anonymous.

*пстрпассворд*<br/>
Указатель на строку, завершающуюся нулем, которая указывает пароль, используемый для входа в систему. Если оба *пстрпассворд* и *пструсернаме* имеют значение null, анонимный пароль по умолчанию — это имя электронной почты пользователя. Если *пстрпассворд* имеет значение null (или пустая строка), но *пструсернаме* не имеет значение null, используется пустой пароль. В следующей таблице описывается поведение четырех возможных параметров *пструсернаме* и *пстрпассворд*.

| *пструсернаме*  | *пстрпассворд*  | Имя пользователя, отправленное на FTP-сервер | Пароль, отправленный на FTP-сервер |
|-----------------|-----------------|-----------------------------|-----------------------------|
|   NULL или ""   |   NULL или ""   |         подключившихся         |      Имя электронной почты пользователя      |
| Строка, не РАВНая NULL |   NULL или ""   |       *пструсернаме*        |             " "             |
|      NULL       | Строка, не РАВНая NULL |            ОШИБКА            |            ОШИБКА            |
| Строка, не РАВНая NULL | Строка, не РАВНая NULL |       *пструсернаме*        |       *пстрпассворд*        |

*Nпорт*<br/>
Число, идентифицирующее порт TCP/IP, используемый на сервере.

*бпассиве*<br/>
Указывает пассивный или активный режим для этого FTP-сеанса. Если задано значение true, то для Win32 API `dwFlag` устанавливается значение INTERNET_FLAG_PASSIVE.

### <a name="return-value"></a>Возвращаемое значение

Указатель на объект [кфтпконнектион](../../mfc/reference/cftpconnection-class.md) . Если вызов завершается неудачно, определите причину сбоя, изучив сгенерированный объект [Цинтернетексцептион](../../mfc/reference/cinternetexception-class.md) .

### <a name="remarks"></a>Примечания

`GetFtpConnection`подключается к FTP-серверу и создает и возвращает указатель на `CFTPConnection` объект. Она не выполняет никаких конкретных операций на сервере. Например, если предполагается чтение или запись в файлы, то эти операции необходимо выполнять как отдельные шаги. Сведения о поиске файлов, открытии файлов, чтении или записи в файлы см. в разделе Классы [кфтпконнектион](../../mfc/reference/cftpconnection-class.md) и [кфтпфилефинд](../../mfc/reference/cftpfilefind-class.md) . Инструкции по выполнению общих задач FTP-соединений см. в статье [Интернет с помощью WinInet](../../mfc/win32-internet-extensions-wininet.md) .

### <a name="example"></a>Пример

См. пример для [кфтпфилефинд](../../mfc/reference/cftpfilefind-class.md).

## <a name="getgopherconnection"></a>Цинтернетсессион:: Жетгоферконнектион

Вызовите эту функцию-член, чтобы установить новое подключение Gopher и получить указатель на `CGopherConnection` объект.

```cpp
CGopherConnection* GetGopherConnection(
    LPCTSTR pstrServer,
    LPCTSTR pstrUserName = NULL,
    LPCTSTR pstrPassword = NULL,
    INTERNET_PORT nPort = INTERNET_INVALID_PORT_NUMBER);
```

### <a name="parameters"></a>Параметры

*пстрсервер*<br/>
Указатель на строку, содержащую имя сервера gopher.

*пструсернаме*<br/>
Указатель на строку, содержащую имя пользователя.

*пстрпассворд*<br/>
Указатель на строку, содержащую пароль доступа.

*Nпорт*<br/>
Число, идентифицирующее порт TCP/IP, используемый на сервере.

### <a name="return-value"></a>Возвращаемое значение

Указатель на объект [кгоферконнектион](../../mfc/reference/cgopherconnection-class.md) . Если вызов завершается неудачно, определите причину сбоя, изучив сгенерированный объект [Цинтернетексцептион](../../mfc/reference/cinternetexception-class.md) .

### <a name="remarks"></a>Примечания

`GetGopherConnection`подключается к серверу Gopher и создает и возвращает указатель на `CGopherConnection` объект. Она не выполняет никаких конкретных операций на сервере. Например, если предполагается чтение или запись данных, то эти операции необходимо выполнять как отдельные шаги. Сведения о поиске файлов, открытии файлов, чтении или записи в файлы см. в разделе Классы [кгоферконнектион](../../mfc/reference/cgopherconnection-class.md), [CGopherFile](../../mfc/reference/cgopherfile-class.md)и [кгоферфилефинд](../../mfc/reference/cgopherfilefind-class.md) . Сведения о просмотре FTP-сайта см. в описании функции-члена [OpenURL](#openurl). Инструкции по выполнению общих задач подключения по протоколу Gopher см. в статье [Интернет с помощью WinInet](../../mfc/win32-internet-extensions-wininet.md) .

## <a name="gethttpconnection"></a>Цинтернетсессион:: Жесттпконнектион

Вызовите эту функцию-член, чтобы установить соединение HTTP и получить указатель на `CHttpConnection` объект.

```cpp
CHttpConnection* GetHttpConnection(
    LPCTSTR pstrServer,
    INTERNET_PORT nPort = INTERNET_INVALID_PORT_NUMBER,
    LPCTSTR pstrUserName = NULL,
    LPCTSTR pstrPassword = NULL);

CHttpConnection* GetHttpConnection(
    LPCTSTR pstrServer,
    DWORD dwFlags,
    INTERNET_PORT nPort = INTERNET_INVALID_PORT_NUMBER,
    LPCTSTR pstrUserName = NULL,
    LPCTSTR pstrPassword = NULL);
```

### <a name="parameters"></a>Параметры

*пстрсервер*<br/>
Указатель на строку, содержащую имя HTTP-сервера.

*Nпорт*<br/>
Число, идентифицирующее порт TCP/IP, используемый на сервере.

*пструсернаме*<br/>
Указатель на строку, содержащую имя пользователя.

*пстрпассворд*<br/>
Указатель на строку, содержащую пароль доступа.

*dwFlags*<br/>
Любое сочетание `INTERNET_FLAG_*` флагов. Описание значений *dwFlags* см. в таблице в разделе **"Примечания"** раздела [чттпконнектион:: опенрекуест](../../mfc/reference/chttpconnection-class.md#openrequest) .

### <a name="return-value"></a>Возвращаемое значение

Указатель на объект [чттпконнектион](../../mfc/reference/chttpconnection-class.md) . Если вызов завершается неудачно, определите причину сбоя, изучив сгенерированный объект [Цинтернетексцептион](../../mfc/reference/cinternetexception-class.md) .

### <a name="remarks"></a>Примечания

`GetHttpConnection`подключается к HTTP-серверу и создает и возвращает указатель на `CHttpConnection` объект. Она не выполняет никаких конкретных операций на сервере. Например, если вы планируете запрашивать заголовок HTTP, то необходимо выполнить эту операцию как отдельный шаг. Сведения об операциях, которые можно выполнять с помощью соединения с HTTP-сервером, см. в разделе Классы [чттпконнектион](../../mfc/reference/chttpconnection-class.md) и [чттпфиле](../../mfc/reference/chttpfile-class.md) . Сведения о просмотре сайта HTTP см. в описании функции-члена [OpenURL](#openurl). Инструкции по выполнению общих задач подключения HTTP см. в статье [Интернет-программирование с помощью WinInet](../../mfc/win32-internet-extensions-wininet.md) .

## <a name="onstatuscallback"></a>Цинтернетсессион:: Онстатускаллбакк

Эта функция-член вызывается платформой для обновления состояния, когда включен обратный вызов состояния и ожидается операция.

```cpp
virtual void OnStatusCallback(
    DWORD_PTR dwContext,
    DWORD dwInternetStatus,
    LPVOID lpvStatusInformation,
    DWORD dwStatusInformationLength);
```

### <a name="parameters"></a>Параметры

*двконтекст*<br/>
Значение контекста, предоставленное приложением.

*двинтернетстатус*<br/>
Код состояния, который указывает, почему выполняется обратный вызов. См. раздел **Примечания** для таблицы возможных значений.

*лпвстатусинформатион*<br/>
Указатель на буфер, содержащий сведения, относящиеся к этому обратному вызову.

*двстатусинформатионленгс*<br/>
Размер *лпвстатусинформатион*.

### <a name="remarks"></a>Примечания

Сначала необходимо вызвать [енаблестатускаллбакк](#enablestatuscallback) , чтобы воспользоваться обратным вызовом состояния.

Параметр *двинтернетстатус* указывает выполняемую операцию и определяет, что будет содержать содержимое *лпвстатусинформатион* . *двстатусинформатионленгс* указывает длину данных, содержащихся в *лпвстатусинформатион*. Следующие значения состояния для *двинтернетстатус* определяются следующим образом.

|Значение|Значение|
|-----------|-------------|
|INTERNET_STATUS_RESOLVING_NAME|Поиск IP-адреса имени, содержащегося в *лпвстатусинформатион*.|
|INTERNET_STATUS_NAME_RESOLVED|IP-адрес имени, содержащегося в *лпвстатусинформатион*, успешно найден.|
|INTERNET_STATUS_CONNECTING_TO_SERVER|Подключение к адресу сокета ([SOCKADDR](/windows/win32/winsock/sockaddr-2)), на который указывает *лпвстатусинформатион*.|
|INTERNET_STATUS_CONNECTED_TO_SERVER|Подключение к адресу сокета (SOCKADDR), на которое указывает *лпвстатусинформатион*, успешно установлено.|
|INTERNET_STATUS_SENDING_REQUEST|Отправка информационного запроса на сервер. Параметр *лпвстатусинформатион* имеет значение null.|
|INTERNET_STATUS_ REQUEST_SENT|Запрос на сведения успешно отправлен на сервер. Параметр *лпвстатусинформатион* имеет значение null.|
|INTERNET_STATUS_RECEIVING_RESPONSE|Ожидание ответа сервера на запрос. Параметр *лпвстатусинформатион* имеет значение null.|
|INTERNET_STATUS_RESPONSE_RECEIVED|Ответ от сервера успешно получен. Параметр *лпвстатусинформатион* имеет значение null.|
|INTERNET_STATUS_CLOSING_CONNECTION|Закрытие соединения с сервером. Параметр *лпвстатусинформатион* имеет значение null.|
|INTERNET_STATUS_CONNECTION_CLOSED|Подключение к серверу успешно закрыто. Параметр *лпвстатусинформатион* имеет значение null.|
|INTERNET_STATUS_HANDLE_CREATED|Используется функцией Win32 API [интернетконнект](/windows/win32/api/wininet/nf-wininet-internetconnectw) для указания на то, что он создал новый маркер. Это позволяет приложению вызвать функцию Win32 [интернетклосехандле](/windows/win32/api/wininet/nf-wininet-internetclosehandle) из другого потока, если соединение занимает слишком много времени. Дополнительные сведения об этих функциях см. в разделе Windows Сдкфор.|
|INTERNET_STATUS_HANDLE_CLOSING|Значение этого обработчика успешно завершено.|

Переопределите эту функцию-член, чтобы требовать некоторых действий перед выполнением подпрограммы обратного вызова состояния.

> [!NOTE]
> Обратные вызовы состояния требуют защиты состояния потока. Если вы используете MFC в общей библиотеке, добавьте следующую строку в начало переопределения:

[!code-cpp[NVC_MFCHtmlHttp#8](../../mfc/reference/codesnippet/cpp/cinternetsession-class_1.cpp)]

Дополнительные сведения об асинхронных операциях см. в [статье первые шаги в Интернете: WinInet](../../mfc/wininet-basics.md).

## <a name="openurl"></a>Цинтернетсессион:: OpenURL

Вызовите эту функцию-член, чтобы отправить указанный запрос на сервер HTTP и разрешить клиенту указывать дополнительные заголовки RFC822, MIME или HTTP для отправки вместе с запросом.

```cpp
CStdioFile* OpenURL(
    LPCTSTR pstrURL,
    DWORD_PTR dwContext = 1,
    DWORD dwFlags = INTERNET_FLAG_TRANSFER_ASCII,
    LPCTSTR pstrHeaders = NULL,
    DWORD dwHeadersLength = 0);
```

### <a name="parameters"></a>Параметры

*пструрл*<br/>
Указатель на имя URL-адреса, с которого начинается чтение. Поддерживаются только URL-адреса, начинающиеся с file:, FTP:, Gopher: или http:. Утверждает, если *пструрл* имеет значение null.

*двконтекст*<br/>
Определяемое приложением значение, передаваемое вместе с возвращаемым маркером в ответном вызове.

*dwFlags*<br/>
Флаги, описывающие способ решения этого соединения. Дополнительные сведения о допустимых флагах см. в разделе **Примечания** . Допустимые флаги:

- INTERNET_FLAG_TRANSFER_ASCII значение по умолчанию. Перенесите файл как текст ASCII.

- INTERNET_FLAG_TRANSFER_BINARY перенесите файл как двоичный файл.

- INTERNET_FLAG_RELOAD получать данные из сети, даже если они локально кэшированы.

- INTERNET_FLAG_DONT_CACHE не кэшируют данные локально или в любых шлюзах.

- INTERNET_FLAG_SECURE этот флаг применим только к HTTP-запросам. Он запрашивает защищенные транзакции в сети с помощью SSL или PCT.

- INTERNET_OPEN_FLAG_USE_EXISTING_CONNECT. Если возможно, повторно используйте существующие соединения с сервером для новых запросов, созданных `OpenUrl` , вместо создания нового сеанса для каждого запроса на подключение.

- INTERNET_FLAG_PASSIVE, используемый для FTP-сайта. Использует пассивную семантику FTP. Используется с [Цинтернетконнектион](../../mfc/reference/cinternetconnection-class.md) из `OpenURL`.

*пстрхеадерс*<br/>
Указатель на строку, содержащую заголовки, отправляемые на HTTP-сервер.

*двхеадерсленгс*<br/>
Длина дополнительных заголовков в символах. Если значение равно-1L и *пстрхеадерс* не равно null, то *пстрхеадерс* считается нулем, а длина вычисляется.

### <a name="return-value"></a>Возвращаемое значение

Возвращает файловый маркер для FTP, GOPHER, HTTP и типа файла только для служб Интернета. Возвращает значение NULL, если синтаксический анализ завершился неудачно.

`OpenURL` Возвращаемый указатель зависит от типа службы *пструрл*. В следующей таблице показаны возможные указатели `OpenURL` , которые могут возвращать.

|Тип URL-адреса|Returns|
|--------------|-------------|
|file://|`CStdioFile*`|
|http://|`CHttpFile*`|
|gopher://|`CGopherFile*`|
|ftp://|`CInternetFile*`|

### <a name="remarks"></a>Примечания

Параметр *dwFlags* должен содержать либо INTERNET_FLAG_TRANSFER_ASCII, либо INTERNET_FLAG_TRANSFER_BINARY, но не оба. Остальные флаги можно сочетать с оператором побитового **или** ( **&#124;** ).

`OpenURL`, который создает оболочку для функции `InternetOpenURL`Win32, позволяет скачивать, извлекать и считывать данные с Интернет сервера. `OpenURL`не допускает обработки файлов в удаленном расположении, поэтому для него не требуется объект [Цинтернетконнектион](../../mfc/reference/cinternetconnection-class.md) .

Чтобы использовать специфические для подключения (то есть зависящие от протокола) функции, например запись в файл, необходимо открыть сеанс, а затем открыть определенный тип соединения, а затем использовать это соединение для открытия файла в нужном режиме. Дополнительные `CInternetConnection` сведения о функциях, связанных с подключением, см. в разделе.

## <a name="operator_hinternet"></a>Цинтернетсессион:: operator ХИНТЕРНЕТ

Этот оператор используется для получения маркера Windows для текущего сеанса Интернета.

```cpp
operator HINTERNET() const;
```

## <a name="setcookie"></a>Цинтернетсессион:: SetCookie

Задает файл cookie для указанного URL-адреса.

```cpp
static BOOL SetCookie(
    LPCTSTR pstrUrl,
    LPCTSTR pstrCookieName,
    LPCTSTR pstrCookieData);
```

### <a name="parameters"></a>Параметры

*пструрл*<br/>
Указатель на строку, завершающуюся нулем, которая указывает URL-адрес, для которого должен быть задан файл cookie.

*пстркукиенаме*<br/>
Указатель на строку, содержащую имя файла cookie.

*пстркукиедата*<br/>
Указатель на строку, содержащую фактические строковые данные, связываемые с URL-адресом.

### <a name="return-value"></a>Возвращаемое значение

Возвращает значение TRUE, если успешно, или FALSE в противном случае. Чтобы получить конкретный код ошибки, вызовите метод`GetLastError.`

### <a name="remarks"></a>Примечания

Эта функция члена реализует поведение сообщения Win32 [интернетсеткукие](/windows/win32/api/wininet/nf-wininet-internetsetcookiew), как описано в Windows SDK.

## <a name="setoption"></a>Цинтернетсессион:: SetOption

Вызовите эту функцию члена, чтобы задать параметры для сеанса Интернета.

```cpp
BOOL SetOption(
    DWORD dwOption,
    LPVOID lpBuffer,
    DWORD dwBufferLength,
    DWORD dwFlags = 0);

BOOL SetOption(
    DWORD dwOption,
    DWORD dwValue,
    DWORD dwFlags = 0);
```

### <a name="parameters"></a>Параметры

*Элемент dwoption*<br/>
Параметр Интернета для установки. Список возможных параметров см. в разделе [флаги параметров](/windows/win32/WinInet/option-flags) в Windows сдкфор.

*лпбуффер*<br/>
Буфер, содержащий параметр.

*двбуфферленгс*<br/>
Длина *лпбуффер* или размер *дввалуе*.

*дввалуе*<br/>
Значение типа DWORD, содержащее параметр.

*dwFlags*<br/>
Указывает различные параметры кэширования. Значение по умолчанию — 0. Возможные значения:

- INTERNET_FLAG_DONT_CACHE не кэшируют данные локально или на всех серверах шлюзов.

- Операции скачивания INTERNET_FLAG_OFFLINE выполняются только через постоянный кэш. Если элемент не существует в кэше, возвращается соответствующий код ошибки. Этот флаг можно сочетать с оператором побитового **&#124;** **или** ().

### <a name="return-value"></a>Возвращаемое значение

Если операция выполнена успешно, возвращается значение TRUE. Если произошла ошибка, возвращается значение FALSE. Если вызов завершается неудачно, можно вызвать функцию Win32 [GetLastError](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) , чтобы определить причину ошибки.

## <a name="see-also"></a>См. также

[Класс CObject](../../mfc/reference/cobject-class.md)<br/>
[Диаграмма иерархии](../../mfc/hierarchy-chart.md)<br/>
[Класс CInternetConnection](../../mfc/reference/cinternetconnection-class.md)<br/>
[Класс CHttpConnection](../../mfc/reference/chttpconnection-class.md)<br/>
[Класс CFtpConnection](../../mfc/reference/cftpconnection-class.md)<br/>
[Класс CGopherConnection](../../mfc/reference/cgopherconnection-class.md)
