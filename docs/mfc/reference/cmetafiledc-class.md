---
title: Класс CMetaFileDC
ms.date: 11/04/2016
f1_keywords:
- CMetaFileDC
- AFXEXT/CMetaFileDC
- AFXEXT/CMetaFileDC::CMetaFileDC
- AFXEXT/CMetaFileDC::Close
- AFXEXT/CMetaFileDC::CloseEnhanced
- AFXEXT/CMetaFileDC::Create
- AFXEXT/CMetaFileDC::CreateEnhanced
helpviewer_keywords:
- CMetaFileDC [MFC], CMetaFileDC
- CMetaFileDC [MFC], Close
- CMetaFileDC [MFC], CloseEnhanced
- CMetaFileDC [MFC], Create
- CMetaFileDC [MFC], CreateEnhanced
ms.assetid: ffce60fa-4181-4d46-9832-25e46fad4db4
ms.openlocfilehash: 0919dacfd758df39064c5381690e9e23a029fcd1
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81369947"
---
# <a name="cmetafiledc-class"></a>Класс CMetaFileDC

Реализует метафайл Windows, который содержит последовательность команд интерфейса графических устройств (GDI), которые можно воспроизвести для создания нужного изображения или текста.

## <a name="syntax"></a>Синтаксис

```
class CMetaFileDC : public CDC
```

## <a name="members"></a>Участники

### <a name="public-constructors"></a>Открытые конструкторы

|Имя|Описание|
|----------|-----------------|
|[CMetaFileDC::CMetaFileDC](#cmetafiledc)|Формирует объект `CMetaFileDC`.|

### <a name="public-methods"></a>Открытые методы

|Имя|Описание|
|----------|-----------------|
|[CMetaFileDC:Закрыть](#close)|Закрывает контекст устройства и создает ручку метафайла.|
|[CMetaFileDC:Закрытие](#closeenhanced)|Закрывает расширенный контекст устройства-метафила и создает улучшенную ручку метафила.|
|[CMetaFileDC::Создание](#create)|Создает контекст метафайла Windows и прикрепляет его к объекту. `CMetaFileDC`|
|[CMetaFileDC::СозданиеУвеличено](#createenhanced)|Создает контекст метафайлного устройства для метафайла с расширенным форматом.|

## <a name="remarks"></a>Remarks

Для реализации метафайла Windows `CMetaFileDC` сначала создайте объект. Вызовите `CMetaFileDC` конструктора, а затем позвоните в функцию [члена Create,](#create) которая создает `CMetaFileDC` контекст метафайла Windows и прикрепляет его к объекту.

Затем отправьте `CMetaFileDC` объекту последовательность команд CDC GDI, которые вы намереваетесь воспроизвести. Только те GDI команды, которые `MoveTo` создают `LineTo`выход, такие как и могут быть использованы.

После отправки нужных команд в метафайл позвоните функции `Close` участника, которая закрывает контексты метафайлного устройства и возвращает ручку метафайла. Затем утилизировать `CMetaFileDC` объект.

[CDC: :PlayMetaFile](../../mfc/reference/cdc-class.md#playmetafile) может использовать метафилет ручку играть метафайл неоднократно. Метафайл также может манипулировать функциями Windows, такими как [CopyMetaFile](/windows/win32/api/wingdi/nf-wingdi-copymetafilew), который копирует метафайл на диск.

Когда метафайл больше не нужен, удалите его из памяти с функцией [DeleteMetaFile](/windows/win32/api/wingdi/nf-wingdi-deletemetafile) Windows.

Можно также реализовать `CMetaFileDC` объект так, чтобы он мог обрабатывать как `GetTextExtent`выходные вызовы, так и атрибут GDI-вызовы, такие как. Такой метафайл является более гибким и может более легко использовать общий Код GDI, который часто состоит из сочетания вызовов вывода и атрибутов. Класс `CMetaFileDC` наследует два контекста `m_hDC` `m_hAttribDC`устройства, и , от CDC. Контекст `m_hDC` устройства обрабатывает [CDC](../../mfc/reference/cdc-class.md) все выводные вызовы `m_hAttribDC` CDC GDI, а контекст устройства обрабатывает все вызовы атрибутов CDC GDI. Обычно эти два контекста устройства относятся к одному и тому же устройству. В `CMetaFileDC`случае, атрибут DC установлен на NULL по умолчанию.

Создайте второй контекст устройства, который указывает на экран, принтер или устройство, `SetAttribDC` кроме метафайла, а `m_hAttribDC`затем позвоните функции участника, чтобы связать новый контекст устройства с . GDI звонки для информации теперь `m_hAttribDC`будут направлены на новые . Выход GDI звонки `m_hDC`будут идти, который представляет метафайл.

Для получения `CMetaFileDC`дополнительной [информации](../../mfc/device-contexts.md)о, см.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CDC](../../mfc/reference/cdc-class.md)

`CMetaFileDC`

## <a name="requirements"></a>Требования

**Заголовок:** afxext.h

## <a name="cmetafiledcclose"></a><a name="close"></a>CMetaFileDC:Закрыть

Закрывает контекст метафайла и создает ручку метафайла Windows, которая может быть использована для воспроизведения метафайла с помощью функции члена [CDC::PlayMetaFile.](../../mfc/reference/cdc-class.md#playmetafile)

```
HMETAFILE Close();
```

### <a name="return-value"></a>Возвращаемое значение

Действительный HMETAFILE, если функция успешна; в противном случае NULL.

### <a name="remarks"></a>Remarks

Ручка метафайла Windows также может использоваться для управления метафайлом с помощью функций Windows, таких как [CopyMetaFile.](/windows/win32/api/wingdi/nf-wingdi-copymetafilew)

Удалите метафайл после использования, позвонив в функцию Windows [DeleteMetaFile.](/windows/win32/api/wingdi/nf-wingdi-deletemetafile)

## <a name="cmetafiledccloseenhanced"></a><a name="closeenhanced"></a>CMetaFileDC:Закрытие

Закрывает контекст устройства с расширенным метафайлом и возвращает ручку, которая идентифицирует метафилс расширенного формата.

```
HENHMETAFILE CloseEnhanced();
```

### <a name="return-value"></a>Возвращаемое значение

Ручка расширенного метафайла, в случае успеха; в противном случае NULL.

### <a name="remarks"></a>Remarks

Приложение может использовать улучшенную ручку метафайла, возвращенную этой функцией, для выполнения следующих задач:

- Отобразить изображение, хранящееся в расширенном метафайле

- Создание копий расширенного метафайла

- Перечислить, отодвигать или копировать отдельные записи в расширенном метафайле

- Получить дополнительное описание содержимого метафайла из расширенного метафайла заголовок

- Извлеките копию расширенного метафайла заголовок

- Извлеките двоичную копию расширенного метафайла

- Перечислите цвета в факультативной палитре

- Преобразование метафайла расширенного формата в метафайл формата Windows

Когда приложение больше не нуждается в улучшенной рукоятке метафайла, оно должно выпустить ручку, позвонив в функцию Win32. `DeleteEnhMetaFile`

## <a name="cmetafiledccmetafiledc"></a><a name="cmetafiledc"></a>CMetaFileDC::CMetaFileDC

Постройте `CMetaFileDC` объект в два этапа.

```
CMetaFileDC();
```

### <a name="remarks"></a>Remarks

Во-первых, вызов, `CMetaFileDC`затем вызов `Create`, который создает контекст метафайлустройства Windows и прикрепляет его к объекту. `CMetaFileDC`

## <a name="cmetafiledccreate"></a><a name="create"></a>CMetaFileDC::Создание

Постройте `CMetaFileDC` объект в два этапа.

```
BOOL Create(LPCTSTR lpszFilename = NULL);
```

### <a name="parameters"></a>Параметры

*lpszFilename*<br/>
Указывает на строку символов с нулевым завершением. Упогоняет имя файла метафайла для создания. Если *lpszFilename* является NULL, создается новый метафайл памяти.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если функция выполнена успешно; в противном случае — 0.

### <a name="remarks"></a>Remarks

Сначала позвоните в `CMetaFileDC`конструктор, `Create`затем вызов , который создает контекст метафайлустройства `CMetaFileDC` Windows и прикрепляет его к объекту.

## <a name="cmetafiledccreateenhanced"></a><a name="createenhanced"></a>CMetaFileDC::СозданиеУвеличено

Создает контекст устройства для метафайла расширенного формата.

```
BOOL CreateEnhanced(
    CDC* pDCRef,
    LPCTSTR lpszFileName,
    LPCRECT lpBounds,
    LPCTSTR lpszDescription);
```

### <a name="parameters"></a>Параметры

*pDCRef*<br/>
Идентифицирует эталонное устройство для расширенного метафайла.

*lpszFileName*<br/>
Указывает на строку символов с нулевым завершением. Опознавай имя файла для создания расширенного метафайла. Если этот параметр NULL, расширенный метафайл основан на памяти и его содержимое `DeleteEnhMetaFile` теряется при уничтожении объекта или при вызове функции Win32.

*lpBounds*<br/>
Указывает на структуру данных [RECT](/windows/win32/api/windef/ns-windef-rect) или объект [CRect,](../../atl-mfc-shared/reference/crect-class.md) который определяет размеры в единицах HIMETRIC (в 0,01 миллиметра) изображения, которые будут храниться в расширенном метафайле.

*lpszОписание*<br/>
Указывает на строку с нулевым завершением, которая определяет название приложения, создавевого изображения, а также название изображения.

### <a name="return-value"></a>Возвращаемое значение

Ручка контекста устройства для расширенного метафайла, если она будет успешной; в противном случае NULL.

### <a name="remarks"></a>Remarks

Этот DC можно использовать для хранения независимой от устройства изображения.

Windows использует эталонное устройство, идентифицированное по параметру *pDCRef,* для записи разрешения и единиц устройства, на котором изначально появилось изображение. Если параметр *pDCRef* NULL, он использует текущее устройство отображения для справки.

Левые и верхние `RECT` члены структуры данных, на которые указывает параметр *lpBounds,* должны быть меньше, чем правые и нижние, соответственно. Точки по краям прямоугольника включены в изображение. Если *lpBounds* является NULL, интерфейс графического устройства (GDI) вычисляет размеры самого маленького прямоугольника, который может приложить изображение, нарисованное приложением. Параметр *lpBounds* должен поставляться там, где это возможно.

Строка, на которую указывает параметр *lpszDescription,* должна содержать нулевой символ между именем приложения и именем изображения и должна заканчиваться с двумя нулевыми символами , например, "XY' Graphics Editor'0Bald Eagle", где символ q0 представляет нулевой символ. Если *lpszDescription* является NULL, в заголовке расширенного метафайла нет соответствующей записи.

Приложения используют DC, созданный этой функцией, для хранения графической картинки в расширенном метафайле. Ручка, идентифицирующая этот DC, может быть передана любой функции GDI.

После того, как приложение хранит изображение в расширенном метафайле, оно `CDC::PlayMetaFile` может отображать изображение на любом устройстве вывода, вызывая функцию. При отображении изображения Windows использует прямоугольник, на который указывает параметр *lpBounds,* и данные разрешения с справочного устройства для расположения и масштабирования изображения. Контекст устройства, возвращенный этой функцией, содержит те же атрибуты по умолчанию, связанные с любым новым DC.

Приложения должны использовать функцию Win32 `GetWinMetaFileBits` для преобразования расширенного метафайла в старый формат метафайла Windows.

Имя файла для расширенного метафайла должно использовать . Расширение EMF.

## <a name="see-also"></a>См. также раздел

[Класс CDC](../../mfc/reference/cdc-class.md)<br/>
[Диаграмма иерархии](../../mfc/hierarchy-chart.md)
