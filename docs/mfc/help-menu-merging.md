---
title: Слияние меню "Справка"
ms.date: 11/04/2016
helpviewer_keywords:
- menus [MFC], merging
- merging Help menus [MFC]
- Help [MFC], for active document containers
ms.assetid: 9d615999-79ba-471a-9288-718f0c903d49
ms.openlocfilehash: 1bd70af6f24ee6f9873b89b2060f4b2d90149c90
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84620134"
---
# <a name="help-menu-merging"></a>Слияние меню "Справка"

Если объект активен в контейнере, протокол слияния меню «документы OLE» дает объекту полный контроль над меню « **Справка** ». В результате разделы справки контейнера становятся недоступными, пока пользователь не деактивирует объект. Архитектура включения активного документа расширяет правила слияния меню на месте, чтобы разрешить доступ к меню и контейнеру, и активному документу, который является активным. Новые правила — это просто дополнительные соглашения о том, какой компонент владеет частью меню и как создается общее меню.

Новое соглашение является простым. В окне "активные документы" меню " **Справка** " имеет два элемента меню верхнего уровня, организованные следующим образом:

`Help`

`Container Help >`

`Object Help    >`

Например, если раздел Word активен в связывателе Office, меню **Справка** будет выглядеть следующим образом:

`Help`

`Binder Help >`

`Word Help   >`

Оба пункта меню — это каскадные меню, в которых имеются дополнительные элементы меню, относящиеся к контейнеру, и объект, предоставленный пользователю. Отображаемые здесь элементы будут отличаться в зависимости от контейнера и объектов.

Для создания этого объединенного меню **справки** архитектура включения активного документа изменяет обычную процедуру обработки документов OLE. В соответствии с документами OLE Объединенная строка меню может содержать шесть групп меню, **файл**, **Правка**, **контейнер**, **объект**, **окно**, **Справка**в указанном порядке. В каждой группе может быть несколько меню. **Файл**групп, **контейнер**и **окно** принадлежат к контейнеру, а группы **редактируют**, **объект** и **справку** принадлежат объекту. Когда объект хочет выполнить слияние меню, он создает пустую строку меню и передает ее в контейнер. Затем контейнер вставляет свои меню, вызывая `IOleInPlaceFrame::InsertMenus` . Объект также передает структуру, которая является массивом из шести ДЛИННых значений (**олеменуграупвидсс**). После вставки меню контейнер помечает количество меню, добавленных в каждую из его групп, а затем возвращает. Затем объект вставляет свои меню, обращая внимание на количество меню в каждой группе контейнеров. Наконец, объект передает объединенную строку меню и массив (который содержит количество меню в каждой группе) в OLE, что возвращает непрозрачный дескриптор "дескриптора меню". Позже объект передает этот обработчик и объединенную строку меню в контейнер через `IOleInPlaceFrame::SetMenu` . В этот момент контейнер отображает объединенную строку меню, а также передает ее в OLE, чтобы OLE могла правильно отправлять сообщения меню.

В измененной процедуре активного документа объект должен сначала инициализировать элементы **олеменуграупвидсс** до нуля перед передачей его в контейнер. Затем контейнер выполняет обычную вставку меню с одним исключением: контейнер вставляет меню " **Справка** " в качестве последнего элемента и сохраняет значение 1 в последней (шестой) записи массива **олеменуграупвидсс** (то есть ширину [5], которая принадлежит группе справки объекта). В меню " **Справка** " будет находиться только один элемент, являющийся подменю, ">" в каскадном меню "**Справка контейнера** ", как описано выше.

Затем объект выполняет стандартный код вставки меню, за исключением того, что перед вставкой его меню " **Справка** " проверяет шестой элемент массива **олеменуграупвидсс** . Если значение равно 1, а имя последнего меню — **Справка** (или соответствующая локализованная строка), то объект вставляет меню « **Справка** » в меню « **Справка** » контейнера.

Затем объект устанавливает шестой элемент **олеменуграупвидсс** в ноль и увеличивает пятый элемент на единицу. Это позволяет OLE понять, что меню **Справка** принадлежит контейнеру, а сообщения меню, соответствующие этому меню (и его подменю), должны направляться в контейнер. Затем он отвечает за пересылку **WM_INITMENUPOPUP**, **WM_SELECT**, **WM_COMMAND**и других связанных с меню сообщений, относящихся к части меню « **Справка** » объекта. Это достигается с помощью **WM_INITMENU** для снятия флага, который указывает контейнеру, что пользователь перешел в меню " **Справка** " объекта. Затем контейнер отслеживает **WM_MENUSELECT** для входа или выхода из любого элемента в меню " **Справка** ", который не был добавлен контейнером. При вводе это означает, что пользователь перешел в меню Объект, поэтому контейнер устанавливает флаг "в меню" Справка по объектам "и использует состояние этого флага для пересылки любых **WM_MENUSELECT**, **WM_INITMENUPOPUP**и **WM_COMMAND** сообщений как минимум в окно объектов. (При выходе контейнер очищает флаг, а затем обрабатывает те же сообщения.) Контейнер должен использовать окно, возвращенное из функции объекта в `IOleInPlaceActiveObejct::GetWindow` качестве места назначения для этих сообщений.

Если объект обнаруживает ноль в шестом элементе **олеменуграупвидсс**, он переходит в соответствии с обычными правилами документов OLE. Эта процедура охватывает контейнеры, которые участвуют в объединении меню « **Справка** », а также те, которые не имеют.

Когда объект вызывает `IOleInPlaceFrame::SetMenu` , перед отображением объединенной строки меню контейнер проверяет, имеет ли меню « **Справка** » дополнительное подменю, в дополнение к добавлению контейнера. Если это так, контейнер оставляет меню " **Справка** " в Объединенной строке меню. Если в меню " **Справка** " нет дополнительного подменю, то контейнер удалит меню " **Справка** " из объединенной строки меню. Эта процедура охватывает объекты, участвующие в слиянии меню « **Справка** », а также те, которые не имеют.

Наконец, когда пора разомонтировать меню, объект удаляет вставленное меню **справки** в дополнение к удалению других вставленных меню. Когда контейнер удаляет свои меню, его меню « **Справка** » также удаляется и в другие вставленные меню.

## <a name="see-also"></a>См. также раздел

[Контейнеры активных документов](active-document-containers.md)
