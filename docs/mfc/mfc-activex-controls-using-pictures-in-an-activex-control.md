---
title: 'Элементы управления ActiveX MFC: Использование изображений в элементе управления ActiveX | Документы Microsoft'
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-mfc
ms.topic: conceptual
f1_keywords:
- LPPICTUREDISP
dev_langs:
- C++
helpviewer_keywords:
- OnDraw method, MFC ActiveX controls
- MFC ActiveX controls [MFC], pictures
- OnDraw method [MFC]
- OnResetState method [MFC]
- CLSID_CPicturePropPage [MFC]
ms.assetid: 2e49735c-21b9-4442-bb3d-c82ef258eec9
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 313cbe53189a4a6e9b87b1723a166de83f56df05
ms.sourcegitcommit: 76b7653ae443a2b8eb1186b789f8503609d6453e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33354921"
---
# <a name="mfc-activex-controls-using-pictures-in-an-activex-control"></a>Элементы управления ActiveX в MFC. Использование изображений в элементе управления ActiveX
В этой статье описан общий тип Picture и способ его реализации в пользовательском элементе управления ActiveX. Ниже приведен список разделов.  
  
-   [Общие сведения о настраиваемых свойствах изображения](#_core_overview_of_custom_picture_properties)  
  
-   [Реализация настраиваемого свойства изображения в элементе управления ActiveX](#_core_implementing_a_custom_picture_property_in_your_activex_control)  
  
-   [Дополнения к проекту элемента управления](#_core_additions_to_your_control_project)  
  
##  <a name="_core_overview_of_custom_picture_properties"></a> Общие сведения о настраиваемых свойствах изображения  
 Тип Picture — это один из группы общих типов для некоторых элементов управления ActiveX. Тип Picture предназначен для работы с метафайлами, растровыми изображениями или значками и позволяет пользователю выбрать изображение для показа в элементе управления ActiveX. Настраиваемые свойства изображения реализуются с использованием объекта изображения и функций Get и Set, обеспечивающих доступ пользователя к свойству изображения. Управление доступом пользователей к свойству изображения осуществляется с помощью стандартной страницы свойств изображений.  
  
 Кроме стандартного типа Picture также доступны типы Font и Color. Дополнительные сведения об использовании стандартного типа Font в элементе управления ActiveX см. в статье [Элементы управления MFC ActiveX: использование шрифтов](../mfc/mfc-activex-controls-using-fonts.md).  
  
 Классы элементов управления ActiveX предоставляют несколько компонентов, которые можно использовать для реализации свойства изображения в элементе управления. Сюда входят следующие компоненты.  
  
-   Класс [CPictureHolder](../mfc/reference/cpictureholder-class.md) .  
  
     Этот класс предоставляет простой доступ к объекту изображения и функциям для элемента, отображаемого настраиваемым свойством изображения.  
  
-   Поддержка свойств типа **LPPICTUREDISP**, реализованных с помощью функций Get и Set.  
  
     С помощью представления класса вы можете быстро добавить поддерживающее тип Picture настраиваемое свойство или несколько. Дополнительные сведения о добавлении свойств элемента управления ActiveX в представлении класса см. в статье [Элементы управления MFC ActiveX: свойства](../mfc/mfc-activex-controls-properties.md).  
  
-   Страница свойств, которая управляет свойством или свойствами изображения элемента управления.  
  
     Эта страница свойств является частью группы запасных страниц свойств, доступных для элементов управления ActiveX. Дополнительные сведения о страницах свойств элементов управления ActiveX см. в статье [Элементы управления MFC ActiveX: использование запасных страниц свойств](../mfc/mfc-activex-controls-using-stock-property-pages.md)  
  
##  <a name="_core_implementing_a_custom_picture_property_in_your_activex_control"></a> Реализация настраиваемого свойства изображения в элементе управления ActiveX  
 После завершения шагов, перечисленных в этом разделе, элемент управления может отображать изображения, выбранные пользователем. Пользователь может изменить отображающееся изображение на странице свойств с текущим изображением и кнопкой "Обзор", которая позволяет пользователю выбирать другие изображения.  
  
 Настраиваемое свойство изображения реализуется с использованием процесса, аналогичного тому, который использовался для реализации других свойств. Основное отличие состоит в том, что настраиваемое свойство должно поддерживать тип Picture. Так как элемент свойства изображения должен отрисовываться элементом управления ActiveX, перед его полной реализацией необходимо внести в свойство ряд дополнений и изменений.  
  
 Для реализации настраиваемого свойства изображения необходимо сделать следующее.  
  
-   [Добавление кода в проект элемента управления](#_core_additions_to_your_control_project).  
  
     Необходимо добавить стандартный идентификатор страницы свойств изображения, член данных типа `CPictureHolder`и настраиваемое свойство типа **LPPICTUREDISP** с реализацией функций Get и Set.  
  
-   [Изменение нескольких функций в классе элемента управления](#_core_modifications_to_your_control_project).  
  
     Эти изменения будут внесены в нескольких функциях, ответственных за отрисовку элемента управления ActiveX .  
  
##  <a name="_core_additions_to_your_control_project"></a> Дополнения к проекту элемента управления  
 Чтобы добавить идентификатор страницы свойств на стандартную страницу свойств изображения, вставьте следующую строку после макроса `BEGIN_PROPPAGEIDS` в CPP-файле, реализующем элемент управления:  
  
 [!code-cpp[NVC_MFC_AxPic#1](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_1.cpp)]  
  
 Вы также должны увеличить параметр счетчика макроса `BEGIN_PROPPAGEIDS` на один. Это показано в следующей строке:  
  
 [!code-cpp[NVC_MFC_AxPic#2](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_2.cpp)]  
  
 Чтобы добавить член данных `CPictureHolder` в класс элемента управления, вставьте следующую строку в защищенный раздел объявления класса элемента управления в файле заголовка (.H) элемента управления:  
  
 [!code-cpp[NVC_MFC_AxPic#3](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_3.h)]  
  
 Необязательно называть член данных `m_pic`; подойдет любое имя.  
  
 Далее добавьте настраиваемое свойство, которое поддерживает тип Picture.  
  
#### <a name="to-add-a-custom-picture-property-using-the-add-property-wizard"></a>Добавление настраиваемого свойства изображения с помощью мастера добавления свойств  
  
1.  Загрузите проект элемента управления.  
  
2.  В представлении класса разверните узел библиотеки элемента управления.  
  
3.  Щелкните правой кнопкой мыши узел интерфейса для элемента управления (второй узел узла библиотеки), чтобы открыть контекстное меню.  
  
4.  В контекстном меню выберите команду **Добавить** , а затем — **Добавить свойство**.  
  
5.  В поле **Имя свойства** введите имя свойства. В качестве примера в этой процедуре используется `ControlPicture` .  
  
6.  В **тип свойства** выберите **IPictureDisp\***  для типа свойства.  
  
7.  В поле **Тип реализации**выберите **Методы Get/Set**.  
  
8.  Введите уникальные имена для функций Get и Set или примите имена по умолчанию. (В этом примере используются имена по умолчанию: `GetControlPicture` и `SetControlPicture` .)  
  
9. Нажмите кнопку **Готово**.  
  
 Мастер добавления свойств добавляет следующий код между комментариями диспетчерской карты в файле заголовка (.H) элемента управления:  
  
 [!code-cpp[NVC_MFC_AxPic#4](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_4.h)]  
  
 Кроме того, в диспетчерскую карту CPP-файла реализации (.CPP) элемента управления был вставлен следующий код:  
  
 [!code-cpp[NVC_MFC_AxPic#5](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_5.cpp)]  
  
 Мастер добавления свойств также добавляет следующие две функции-заглушки в файл реализации элемента управления:  
  
 [!code-cpp[NVC_MFC_AxPic#6](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_6.cpp)]  
  
> [!NOTE]
>  Имена класса и функций вашего элемента управления могут отличаться от примера выше.  
  
###  <a name="_core_modifications_to_your_control_project"></a> Модификации проекта элемента управления  
 После внесения необходимых дополнений в проект элемента управления необходимо изменить несколько функций, которые влияют на отрисовку элемента управления ActiveX. Эти функции, `OnResetState`и `OnDraw`, а также функции Get и Set настраиваемого свойства изображения расположены в файле реализации элемента управления. (Обратите внимание, что в этом примере класс элемента управления называется `CSampleCtrl`, член данных `CPictureHolder` называется `m_pic`, а имя настраиваемого свойства изображения — `ControlPicture`.)  
  
 В функцию `OnResetState` элемента управления добавьте следующую необязательную строку после вызова `COleControl::OnResetState`:  
  
 [!code-cpp[NVC_MFC_AxPic#7](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_7.cpp)]  
  
 Это приведет к тому, что будет задано пустое изображение элемента управления.  
  
 Чтобы правильно нарисовать изображение, вызовите метод [CPictureHolder::Render](../mfc/reference/cpictureholder-class.md#render) в функции `OnDraw` элемента управления. Измените функцию в соответствии со следующим примером:  
  
 [!code-cpp[NVC_MFC_AxPic#8](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_8.cpp)]  
  
 В функцию Get настраиваемого свойства изображения элемента управления добавьте следующую строку:  
  
 [!code-cpp[NVC_MFC_AxPic#9](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_9.cpp)]  
  
 В функцию Set настраиваемого свойства изображения элемента управления добавьте следующие строки:  
  
 [!code-cpp[NVC_MFC_AxPic#10](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_10.cpp)]  
  
 Свойство изображения должно быть сохраняемым, чтобы добавляемые во время разработки сведения отображались во время выполнения. Добавьте следующую строку в функцию `COleControl`класса, производного от `DoPropExchange` :  
  
 [!code-cpp[NVC_MFC_AxPic#11](../mfc/codesnippet/cpp/mfc-activex-controls-using-pictures-in-an-activex-control_11.cpp)]  
  
> [!NOTE]
>  Имена ваших класса и функции могут отличаться от примера выше.  
  
 После внесения изменений выполните повторную сборку проекта, чтобы внедрить новые функции настраиваемого свойства изображения и использовать Контейнер для тестирования нового свойства. Сведения о том, как получить доступ к Контейнеру для тестирования, см. в разделе [Тестирование свойств и событий в Контейнере для тестирования](../mfc/testing-properties-and-events-with-test-container.md) .  
  
## <a name="see-also"></a>См. также  
 [Элементы управления ActiveX MFC](../mfc/mfc-activex-controls.md)   
 [Элементы управления MFC ActiveX: Использование шрифтов](../mfc/mfc-activex-controls-using-fonts.md)   
 [Элементы ActiveX в MFC. Страницы свойств](../mfc/mfc-activex-controls-property-pages.md)

