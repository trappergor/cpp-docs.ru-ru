---
title: 'Пошаговое руководство: Обновление приложения MFC Scribble (часть 1) | Документация Майкрософт'
ms.custom: ''
ms.date: 09/20/2018
ms.technology:
- cpp-mfc
ms.topic: conceptual
dev_langs:
- C++
helpviewer_keywords:
- examples [MFC], update existing application
- ribbon UI, porting to
- Office Fluent UI, porting to
- samples [MFC], update existing application
- MFC Feature Pack, update existing application
- walkthroughs [MFC], update existing application
ms.assetid: aa6330d3-6cfc-4c79-8fcb-0282263025f7
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 9d028d1cb3a42a68aab67d2b6fa90165a7d6264b
ms.sourcegitcommit: edb46b0239a0e616af4ec58906e12338c3e8d2c6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2018
ms.locfileid: "47169779"
---
# <a name="walkthrough-updating-the-mfc-scribble-application-part-1"></a>Пошаговое руководство: Обновление приложения MFC Scribble (часть 1)

В этом пошаговом руководстве показано, как изменить существующее приложение MFC использовать пользовательский интерфейс ленты. Visual Studio поддерживает ленты Office 2007 и ленты Scenic Windows 7. Дополнительные сведения о пользовательском интерфейсе Ribbon, см. в разделе [лент](/windows/desktop/uxguide/cmd-ribbons).

В этом пошаговом руководстве изменяет классический пример Scribble 1.0 MFC, который позволяет создавать рисунки строки с помощью мыши. Этой части пошагового руководства показано, как изменить примера Scribble на базе, чтобы он отображал панели ленты. [Часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md) добавляет дополнительные кнопки на ленте.

## <a name="prerequisites"></a>Предварительные требования 

[Образца Scribble 1.0 MFC](http://download.microsoft.com/download/4/0/9/40946FEC-EE5C-48C2-8750-B0F8DA1C99A8/MFC/general/Scribble.zip.exe). Справочные сведения о преобразовании в Visual Studio 2017, см. в разделе [: руководство по переносу: MFC Scribble](../porting/porting-guide-mfc-scribble.md).

##  <a name="top"></a> Разделы

Этой части пошагового руководства состоит из следующих разделов:

- [Замена базовые классы](#replaceclass)

- [Добавление растровых изображений в проект](#addbitmap)

- [Добавление в ресурс ленты в проект](#addribbon)

- [Создание экземпляра ленты](#createinstance)

- [Добавление категории ленты](#addcategory)

- [Настройка внешнего вида приложения](#setlook)

##  <a name="replaceclass"></a> Замена базовые классы

Чтобы преобразовать приложение, поддерживающее меню, чтобы приложение, поддерживающее ленты, должны происходить приложения, фрейм окна и панели инструментов классы от обновленные базовые классы. (Мы рекомендуем пройти не изменить исходный пример Scribble; вместо этого очистите проект Scribble, скопируйте его в другой каталог и затем изменить копию).

### <a name="to-replace-the-base-classes-in-the-scribble-application"></a>Для замены базовых классов в приложении Scribble

1. Убедитесь, что в scribble.cpp, `CScribbleApp::InitInstance` включает вызов [AfxOleInit](../mfc/reference/ole-initialization.md#afxoleinit).

1. Добавьте следующий код в файл stdafx.h.

    ```cpp
    #include <afxcontrolbars.h>
    ```

1. В scribble.h, измените определение `CScribbleApp` таким образом, чтобы он является производным от [класс CWinAppEx](../mfc/reference/cwinappex-class.md).

    ```cpp
    class CScribbleApp: public CWinAppEx
    ```

1. Scribble 1.0 был записан при приложений Windows файла инициализации (ini) для сохранения данных предпочтений пользователя. Вместо файла инициализации измените Scribble для хранения пользовательских параметров в реестре. Чтобы задать раздел реестра и базы, введите следующий код в `CScribbleApp::InitInstance` после `LoadStdProfileSettings()` инструкции.

    ```cpp
    SetRegistryKey(_T("MFCNext\\Samples\\Scribble2"));
    SetRegistryBase(_T("Settings"));
    ```

1. Главного фрейма для нескольких приложений интерфейса (MDI) документа больше не является производным от `CMDIFrameWnd` класса. Вместо этого он является производным от [CMDIFrameWndEx](../mfc/reference/cmdiframewndex-class.md) класса.

    В файлах mainfrm.h и mainfrm.cpp, замените все вхождения `CMDIFrameWnd` с `CMDIFrameWndEx`.

1. В файлах childfrm.h и childfrm.cpp, замените `CMDIChildWnd` с `CMDIChildWndEx`.

    В childfrm. h файл, замените `CSplitterWnd` с `CSplitterWndEx`.

1. Изменение панелей инструментов и строки состояния, чтобы использовать новые классы MFC.

    В файле mainfrm.h:

    1. Замените `CToolBar` объектом `CMFCToolBar`.

    1. Замените `CStatusBar` объектом `CMFCStatusBar`.

1. В файле mainfrm.cpp:

    1. Замените `m_wndToolBar.SetBarStyle` с `m_wndToolBar.SetPaneStyle`

    1. Замените `m_wndToolBar.GetBarStyle` с `m_wndToolBar.GetPaneStyle`

    1. Замените `DockControlBar(&m_wndToolBar)` с `DockPane(&m_wndToolBar)`

1. В файле ipframe.cpp закомментируйте следующие три строки кода.

    ```cpp
    m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);
    pWndFrame->EnableDocking(CBRS_ALIGN_ANY);
    pWndFrame->DockPane(&m_wndToolBar);
    ```

1. Сохраните изменения и затем постройте и запустите приложение.

##  <a name="addbitmap"></a> Добавление растровых изображений в проект

Следующих четырех шагах данного пошагового руководства требуются ресурсы растрового изображения. Вы можете получить соответствующие растровые изображения по-разному:

- Используйте [редакторы ресурсов](../windows/resource-editors.md) изобретать свои собственные точечные рисунки. Или с помощью редакторов ресурсов можно собрать точечных рисунков из образов PNG-файлы, которые входят в состав Visual Studio и может быть загружена из [библиотека изображений Visual Studio](https://docs.microsoft.com/visualstudio/designers/the-visual-studio-image-library).

    Тем не менее **ленты** пользовательский интерфейс требует, что определенные растровые изображения поддерживает прозрачные изображения. Прозрачными точечными рисунками использовать 32-разрядных пикселей, где 24 бита выбора красного, зеленого и синего компонентов цвета, и определите 8 бит *альфа-канал* , указывающий прозрачности цвета. Текущий редакторы ресурсов можно просматривать, но не изменять точечные рисунки с 32-разрядных пикселей. Следовательно используйте внешнего редактора изображений вместо редакторы ресурсов для управления прозрачными точечными рисунками.

- Скопируйте файл соответствующего ресурса из другого приложения в проект, а затем импортировать точечных рисунков из этого файла.

В этом пошаговом руководстве копирует файлы ресурсов из примера, созданные в [Пошаговое руководство: создание ленты приложения с помощью MFC](../mfc/walkthrough-creating-a-ribbon-application-by-using-mfc.md).

### <a name="to-add-bitmaps-to-the-project"></a>Добавление растровых изображений в проект

1. Скопируйте следующие файлы .bmp из каталога ресурсов с помощью проводника (`res`) примера ленты в каталог ресурсов (`res`) проекта Scribble:

   1. Скопируйте main.bmp проекта Scribble.

   1. Скопировать в проект Scribble filesmall.bmp и filelarge.bmp.

   1. Создавать новые копии файлов filelarge.bmp и filesmall.bmp, но сохранять копии в примере ленты. Переименуйте homesmall.bmp копий и homelarge.bmp и переместите их в проект Scribble.

   1. Создайте копию файла файлу toolbar.bmp, но сохранить копию в примере ленты. Переименуйте panelicons.bmp копирования, а затем переместите ее в проект Scribble.

1. Импортируйте растровое изображение для приложения MFC. В **представление ресурсов**, дважды щелкните **scribble.rc** узла, дважды щелкните **точечного рисунка** узел, а затем щелкните **добавьте ресурс**. В появившемся диалоговом окне, щелкните **импорта**. Перейдите к `res` каталог, выберите файл main.bmp и нажмите кнопку **откройте**.

   Битовая карта main.bmp содержит образ 26 x 26. Изменить идентификатор растрового изображения для `IDB_RIBBON_MAIN`.

1. Импорт растровые изображения для меню "файл", подключенный к **приложения** кнопки.

   1. Импортировать файл filesmall.bmp, который содержит одиннадцать 16 x 16 (16 x 176) изображения. Изменить идентификатор растрового изображения для `IDB_RIBBON_FILESMALL`.

   > [!NOTE]
   > Поскольку мы только образы первых восьми 16 x 16 (16 x 128), могут при необходимости обрезать справа ширину точечного рисунка из 176 128. 

   1. Импорт filelarge.bmp, который содержит девять 32 x 32 (32 x 288) изображения. Изменить идентификатор растрового изображения для `IDB_RIBBON_FILELARGE`.

1. Импортируйте растровые изображения для категорий ленты и панели. Каждая вкладка на ленте, категория и состоит из текстовой меткой и необязательное изображение.

   1. Импортируйте homesmall.bmp точечного рисунка, который содержит одиннадцать 16 x 16 образы для растровых изображений маленькую кнопку. Изменить идентификатор растрового изображения для `IDB_RIBBON_HOMESMALL`.

   1. Импортируйте homelarge.bmp точечного рисунка, который содержит девять 32 x 32 образы для растровых изображений большая кнопка. Изменить идентификатор растрового изображения для `IDB_RIBBON_HOMELARGE`.

1. Импорт точечных рисунков для панели ленты с измененным размером. Эти точечные рисунки, значки панели используются или после операции изменения размера Если ленты слишком мал для отображения всей панели.

   1. Импортируйте panelicons.bmp точечного рисунка, который содержит восемь 16 x 16 изображений. В **свойства** окно **редактора точечных рисунков**, Ширина растрового изображения до 64 (16 x 64). Изменить идентификатор растрового изображения для `IDB_PANEL_ICONS`.

   > [!NOTE]
   > Поскольку мы только образы первые четыре 16 x 16 (16 x 64), могут при необходимости обрезать справа ширину точечного рисунка от 128 до 64. 

##  <a name="addribbon"></a> Добавление в ресурс ленты в проект

При преобразовании приложения, использующего меню для приложения, использующего ленты, у вас нет для удаления или отключения существующих меню. Вместо этого вы создайте ресурс ленты, добавление кнопок ленты и затем связать новые кнопки с существующих элементов меню. Несмотря на то, что меню, не отображаются, сообщения на ленте направляются через меню. Кроме того меню быстрого вызова продолжают работать.

Лента состоит из **приложения** кнопки, равное большая кнопка в верхней левой ленте и один или несколько вкладок категории. Каждая категория вкладка содержит одну или несколько панелей, которые являются контейнерами для кнопок ленты и элементов управления. Ниже показано, как создать ресурс ленты, а затем настройте **приложения** кнопки.

### <a name="to-add-a-ribbon-resource-to-the-project"></a>Чтобы добавить ресурс ленты в проект

1. Выберите проект Scribble в **обозревателе решений**в **проекта** меню, щелкните **добавить ресурс**.

1. В **добавить ресурс** выберите **ленты** и нажмите кнопку **New**.

   Visual Studio создает ресурс ленты и открывает его в режиме конструктора. Идентификатор ресурса ленты — `IDR_RIBBON1`, которое отображается в **представление ресурсов**. Ленты содержит одну категорию и одной панели.

1. Вы можете настроить **приложения** кнопки, изменив его свойства. Идентификаторы сообщений, которые используются в этом коде уже определены в меню Scribble 1.0.

1. В режиме конструктора щелкните **приложения** кнопку, чтобы отобразить ее свойства. Измените значения свойств следующим образом: **изображение** для `IDB_RIBBON_MAIN`, **Prompt** для `File`, **ключи** для `f`, **больших изображений** для `IDB_RIBBON_FILELARGE`, и **маленькие изображения** для `IDB_RIBBON_FILESMALL`.

1. Следующие изменения создать меню, которое появляется, когда пользователь нажимает кнопку **приложения** кнопки. Нажмите кнопку с многоточием (**...** ) рядом с полем **элементы Main** открыть **редактор элементов**.

   1. С помощью **элемент** тип **кнопку** , щелкните **добавить** для добавления кнопки. Изменение **заголовок** для `&New`, **идентификатор** для `ID_FILE_NEW`, **изображение** для `0`, **большое изображение** для `0`.

   1. Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для `&Save`, **идентификатор** для `ID_FILE_SAVE`, **изображение** для `2`, и **большое изображение** для `2`.

   1. Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для `Save &As`, **идентификатор** для `ID_FILE_SAVE_AS`, **изображение** для `3`, и **большое изображение** для `3`.

   1. Нажмите кнопку **добавить** для добавления кнопки. Изменение **заголовок** для `&Print`, **идентификатор** для `ID_FILE_PRINT`, **изображение** для `4`, и **большое изображение** для `4`.

   1. Изменение **элемент** тип **разделителя** и нажмите кнопку **добавить**.

   1. Изменение **элемент** тип **кнопку**. Нажмите кнопку **добавить** для пятая кнопка "Добавить". Изменение **заголовок** для `&Close`, **идентификатор** для `ID_FILE_CLOSE`, **изображение** для `5`, и **большое изображение** для `5`.

1. Следующие изменения Создание вложенного меню **печати** кнопке, созданной на предыдущем шаге.

   1. Нажмите кнопку **печати** "Кнопка", измените **элемент** тип **метка**и нажмите кнопку **вставить**. Изменение **заголовок** для `Preview and print the document`.

   1. Нажмите кнопку **печати** "Кнопка", измените **элемент** тип **кнопку**и нажмите кнопку **вставить**. Изменение **заголовок** для `&Print`, **идентификатор** для `ID_FILE_PRINT`, **изображение** для `4`, и **большое изображение** для `4`.

   1. Нажмите кнопку **печати** а затем нажмите кнопку **вставить** для добавления кнопки. Изменение **заголовок** для `&Quick Print`, **идентификатор** для `ID_FILE_PRINT_DIRECT`, **изображение** для `7`, и **большое изображение** для `7`.

   1. Нажмите кнопку **печати** а затем нажмите кнопку **вставить** добавить еще одну кнопку. Изменение **заголовок** для `Print Pre&view`, **идентификатор** для `ID_FILE_PRINT_PREVIEW`, **изображение** для `6`, и **большое изображение** для `6`.

   1. Теперь вы изменили **элементы Main**. Нажмите кнопку **закрыть** для выхода из **редактор элементов**.

1. Следующее изменение создает кнопку выхода, которая отображается в нижней части **приложения** кнопку меню.

   1. В **свойства** окно, нажмите кнопку с многоточием (**...** ) рядом с полем **кнопку** открыть **редактор элементов**.

   1. С помощью **элемент** тип **кнопку** , щелкните **добавить** для добавления кнопки. Изменение **заголовок** для `E&xit`, **идентификатор** для `ID_APP_EXIT`, **изображение** для `8`.

   1. Вы изменили **кнопки**. Нажмите кнопку **закрыть** для выхода из **редактор элементов**.

##  <a name="createinstance"></a> Создание экземпляра ленты

Ниже показано, как создать экземпляр панели ленты при запуске приложения. Чтобы добавить на панель ленты в приложение, объявите панели ленты в файле mainfrm.h. Затем в файле mainfrm.cpp написать код для загрузки ресурса ленты.

### <a name="to-create-an-instance-of-the-ribbon-bar"></a>Для создания экземпляра ленты

1. Добавить элемент данных защищенный раздел в файле mainfrm.h `CMainFrame`, в определении класса для главного фрейма. Этот член представляет панели ленты.

    ```cpp
    // Ribbon bar for the application
    CMFCRibbonBar m_wndRibbonBar;
    ```

2. В файле mainfrm.cpp, добавьте следующий код перед последней `return` инструкции в конце `CMainFrame::OnCreate` функции. Это создает экземпляр панели ленты.

    ```cpp
    // Create the ribbon bar
    if (!m_wndRibbonBar.Create(this))
    {
        return -1;   //Failed to create ribbon bar
    }
    m_wndRibbonBar.LoadFromResource(IDR_RIBBON1);
    ```

##  <a name="addcategory"></a> Настройка ресурс ленты

Теперь, когда вы создали **приложения** кнопки, можно добавить элементы на ленту.

> [!NOTE]
> В этом пошаговом руководстве используется один и тот же самый значок панели для всех панелей. Тем не менее можно использовать другие индексы списка изображений для отображения других значков.

### <a name="to-add-a-home-category-and-edit-panel"></a>Чтобы добавить категорию домашней и изменять панели

1. Scribble программе требуется только одна категория. В режиме конструктора в **элементов**, дважды щелкните **категории** Чтобы добавить его и вывести ее свойства. Измените значения свойств следующим образом: **заголовок** для `&Home`, **больших изображений** для `IDB_RIBBON_HOMELARGE`, **маленькие изображения** для `IDB_RIBBON_HOMESMALL`.

1. Каждая категория ленты организована в именованный панелей. Каждая панель содержит набор элементов управления, выполняющих связанные операции. Эта категория содержит одну панель. Нажмите кнопку **панели**, а затем измените **заголовок** для `Edit`.

1. Чтобы **изменить** панели, добавление кнопки, которая отвечает за очистки содержимого документа. Идентификатор сообщения для данной кнопки уже было определено в `IDR_SCRIBBTYPE` ресурса меню. Укажите `Clear All` как текст кнопки и индекс точечного рисунка, который оформляет кнопки. Откройте **элементов**и затем перетащите **кнопку** для **изменить** панели. Нажмите кнопку, а затем измените **заголовок** для `Clear All`, **идентификатор** для `ID_EDIT_CLEAR_ALL`, **индекс образа** для `0`, **большой индекс образа**  для `0`.

1. Сохраните изменения и затем постройте и запустите приложение. Должны быть на панель ленты в верхней части окна, а не строку меню, и приложения Scribble должны отображаться. Ленты должны иметь одну категорию **Главная**, и **Главная** должны иметь одну панель **изменить**. Кнопок ленты, которые вы добавили должны быть связаны с существующие обработчики событий и **откройте**, **закрыть**, **Сохранить**, **печати**, и **очистить все** кнопок должен работать соответствующим образом.

##  <a name="setlook"></a> Настройка внешнего вида приложения

Объект *наглядный диспетчер* — это глобальный объект, управляющий все прорисовки для приложения. Так как в исходном приложении Scribble использует стиль пользовательского интерфейса пользователя Office 2000, приложение может выглядеть доброе. Вы можете сбросить приложения для использования Office 2007 наглядный диспетчер, как указано в приложениях Office 2007.

### <a name="to-set-the-look-of-the-application"></a>Чтобы задать внешний вид приложения

1. В `CMainFrame::OnCreate` функции, введите следующий код перед `return 0;` инструкцию, чтобы изменить значение по умолчанию наглядный диспетчер и стиль.

    ```cpp
    // Set the default manager to Office 2007
    CMFCVisualManager::SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerOffice2007));
    CMFCVisualManagerOffice2007::SetStyle(CMFCVisualManagerOffice2007::Office2007_LunaBlue);
    ```

1. Сохраните изменения и затем постройте и запустите приложение. Пользовательский Интерфейс приложения должно выглядеть как пользовательского интерфейса Office 2007.

## <a name="next-steps"></a>Следующие шаги

Вы изменили классический пример Scribble 1.0 MFC для использования **конструктор лент**. Теперь перейдите к [часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md).

## <a name="see-also"></a>См. также

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)<br/>
[Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md)
