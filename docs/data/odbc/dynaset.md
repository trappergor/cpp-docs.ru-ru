---
title: Динамический набор
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets, dynasets
- ODBC cursor library [ODBC], dynasets
- keyset-driven cursors in dynasets
- cursors [ODBC], keyset-driven cursors in dynasets
- cursor library [ODBC], dynaset availability
- recordsets [C++], dynasets
- dynasets
ms.assetid: 2867e6be-208e-4fe7-8bbe-b8697cb1045c
ms.openlocfilehash: ed7098600126005978c8b017e7db378fca4c1a68
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80213243"
---
# <a name="dynaset"></a>Динамический набор

В этом разделе описываются динамические подмножества и обсуждаются их [доступность](#_core_availability_of_dynasets).

> [!NOTE]
>  Этот раздел относится к классам MFC ODBC, включая [CRecordset](../../mfc/reference/crecordset-class.md). Сведения о динамических подмножеств данных в классах DAO см. в разделе [CDaoRecordset](../../mfc/reference/cdaorecordset-class.md). С помощью DAO можно открывать наборы записей динамического типа.

Динамическое подмножество — это набор записей с динамическими свойствами. В течение времени существования объект набора записей в режиме динамического подмножества (обычно называемый динамическим набором) остается синхронизированным с источником данных следующим образом. В многопользовательской среде другие пользователи могут изменять или удалять записи, которые находятся в динамическом наборе, или добавлять записи в таблицу, которую представляет ваш динамический набор. Записи, которые приложение добавляет или удаляет из набора записей, отражаются в динамическом наборе. Записи, добавленные другими пользователями в таблицу, не будут отражаться в динамическом наборе до тех пор, пока не будет перестроен динамический набор путем вызова его функции члена `Requery`. Когда другие пользователи удаляют записи, код MFC пропускает операции удаления в наборе записей. Изменения в существующих записях, внесенные другими пользователями, отражаются в динамическом наборе сразу после прокрутки до затронутой записи.

Аналогичным образом изменения, вносимые в записи в динамическом наборе, отражаются в динамических подмножествах, используемых другими пользователями. Добавляемые записи не отражаются в динамических подмножествах пользователей до тех пор, пока не будут изменяться их динамические наборы. Удаляемые записи помечаются как "Удаленные" в наборах записей других пользователей. При наличии нескольких подключений к одной и той же базе данных (несколько `CDatabase` объектов) наборы записей, связанные с этими подключениями, имеют то же состояние, что и наборы записей других пользователей.

Динамические подмножества данных наиболее полезны, если данные должны быть динамическими, как (например) в системе резервирования авиакомпании.

> [!NOTE]
> Для использования динамических подмножеств данных необходимо иметь драйвер ODBC, который поддерживает динамические наборы, а библиотека курсоров ODBC не должна быть загружена. Дополнительные сведения см. в разделе [доступность динамических подмножеств](#_core_availability_of_dynasets)данных.

Чтобы указать, что набор записей является динамическим, передайте `CRecordset::dynaset` в качестве первого параметра в функцию-член `Open` объекта Recordset.

> [!NOTE]
> Для обновляемых динамических подмножеств драйвер ODBC должен поддерживать либо позиционированные инструкции UPDATE, либо функцию `::SQLSetPos` ODBC API. Если обе поддерживаются, MFC использует `::SQLSetPos` для повышения эффективности.

##  <a name="availability-of-dynasets"></a><a name="_core_availability_of_dynasets"></a>Доступность динамических подмножеств данных

Классы базы данных MFC поддерживают динамические подмножества при соблюдении следующих требований.

- Библиотека DLL курсоров ODBC не должна использоваться для этого источника данных.

   Если используется библиотека курсоров, она маскирует некоторые функциональные возможности базового драйвера ODBC, необходимого для поддержки динамических подмножеств. Если вы хотите использовать динамические подмножества (а драйвер ODBC имеет функции, необходимые для динамических подмножеств данных, как описано в оставшейся части этого раздела), можно вызвать незагрузку библиотеки курсора MFC при создании объекта `CDatabase`. Дополнительные сведения см. в статьях [ODBC](../../data/odbc/odbc-basics.md) и [опенекс](../../mfc/reference/cdatabase-class.md#openex) или [Open](../../mfc/reference/cdatabase-class.md#open) Member функции класса `CDatabase`.

   В терминологии ODBC динамические подмножества и моментальные снимки называются курсорами. Курсор — это механизм, используемый для отслеживания его положения в наборе записей.

- Драйвер ODBC для источника данных должен поддерживать курсоры, управляемые набором ключей.

   Курсоры, управляемые набором ключей, управляют данными из таблицы, получая и сохраняя набор ключей. Ключи используются для получения текущих данных из таблицы, когда пользователь выполняет прокрутку на определенную запись. Чтобы определить, поддерживает ли драйвер такую поддержку, вызовите функцию `::SQLGetInfo` ODBC API с параметром *SQL_SCROLL_OPTIONS* .

   При попытке открыть динамический набор без поддержки набора ключей вы получаете `CDBException` со значением кода возврата AFX_SQL_ERROR_DYNASET_NOT_SUPPORTED.

- Драйвер ODBC для источника данных должен поддерживать расширенную выборку.

   Расширенная выборка — это возможность прокрутки назад, а также перенаправления результирующих записей SQL-запроса. Чтобы определить, поддерживает ли драйвер эту возможность, вызовите функцию `::SQLGetFunctions` ODBC API с параметром *SQL_API_SQLEXTENDEDFETCH* .

Если вам нужны обновляемые динамические подмножества (или моментальные снимки), драйвер ODBC также должен поддерживать либо функцию API `::SQLSetPos` ODBC, либо позиционированные обновления. Функция `::SQLSetPos` позволяет MFC обновлять источник данных без отправки инструкций SQL. Если эта поддержка доступна, MFC использует ее в качестве предпочтений для внесения обновлений с помощью SQL. Чтобы определить, поддерживает ли драйвер `::SQLSetPos`, вызовите метод `::SQLGetInfo` с параметром *SQL_POS_OPERATIONS* .

Позиционированные обновления используют синтаксис SQL (в форме, **где Current of** \<курсорнаме >) для обнаружения определенной строки в таблице в источнике данных. Чтобы определить, поддерживает ли драйвер позиционированные обновления, вызовите `::SQLGetInfo` с помощью параметра *SQL_POSITIONED_STATEMENTS* .

Как правило, для динамических подмножеств MFC (но не для наборов записей прямого доступа) требуется драйвер ODBC с соответствием API уровня 2. Если драйвер для источника данных соответствует набору API уровня 1, вы можете использовать как обновляемые, так и моментальные снимки только для чтения, а также наборы записей последовательного доступа, но не динамические подмножества. Однако драйвер уровня 1 может поддерживать динамические наборы данных, если он поддерживает расширенные выборки и курсоры, управляемые набором ключей. Дополнительные сведения об уровнях соответствия ODBC см. в разделе [ODBC](../../data/odbc/odbc-basics.md).

> [!NOTE]
> Если вы хотите использовать как моментальные снимки, так и динамические наборы данных, их необходимо основывать на двух разных `CDatabase`ных объектах (два разных соединения).

В отличие от моментальных снимков, использующих промежуточное хранилище, поддерживаемое библиотекой курсоров ODBC, динамические подмножества получают запись непосредственно из источника данных сразу после прокрутки. Это позволит сохранить записи, изначально выбранные динамическим набором, синхронизированным с источником данных.

Список драйверов ODBC, включенных в эту версию Visual C++, и сведения о получении дополнительных драйверов см. в статье [Список драйверов ODBC](../../data/odbc/odbc-driver-list.md).

## <a name="see-also"></a>См. также раздел

[Интерфейс ODBC](../../data/odbc/open-database-connectivity-odbc.md)
