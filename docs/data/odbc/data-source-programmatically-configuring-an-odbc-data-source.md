---
title: Источник данных. Программная настройка источника данных ODBC
ms.date: 11/04/2016
f1_keywords:
- SQLConfigDataSource
helpviewer_keywords:
- ODBC data sources, configuring
- SQLConfigDataSource method example
- ODBC connections, configuring
- configuring ODBC data sources
ms.assetid: b8cabe9b-9e12-4d73-ae36-7cb12dee3213
ms.openlocfilehash: ba0224d166795b34d636ace610265e115209e49c
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81358862"
---
# <a name="data-source-programmatically-configuring-an-odbc-data-source"></a>Источник данных. Программная настройка источника данных ODBC

Эта тема объясняет, как можно настроить имена источников открытых баз данных (ODBC) программно. Это дает вам гибкость в доступе к данным, не заставляя пользователя явно использовать администраторod ODBC или другие программы для указания имен источников данных.

Обычно пользователь запускает администратор ODBC для создания источника данных, если связанная система управления базами данных (DBMS) поддерживает эту операцию.

При создании источника данных Microsoft Access ODBC через администраторODБ предоставляется два варианта: вы можете выбрать существующий файл .mdb или создать новый файл .mdb. Существует нет программного способа создания файла .mdb из вашего приложения MFC ODBC. Поэтому, если ваше приложение требует, чтобы вы размещали данные в источник данных Microsoft Access (.mdb файл), вы, скорее всего, хотите иметь пустой файл .mdb, который вы можете использовать или копировать, когда вам это нужно.

Тем не менее, многие DBMS позволяют программное создание источника данных. Некоторые источники данных поддерживают спецификацию каталога для баз данных. То есть каталог является источником данных, и каждая таблица в источнике данных хранится в отдельном файле (в случае dBASE каждая таблица представляет собой файл .dbf). Драйверы для других баз данных ODBC, таких как Microsoft Access и S'L Server, требуют, чтобы некоторые конкретные критерии были удовлетворены, прежде чем можно будет установить источник данных. Например, при использовании драйвера s'L Server ODBC необходимо создать компьютер S'L Server.

## <a name="sqlconfigdatasource-example"></a><a name="_core_sqlconfigdatasource_example"></a>Пример сазлКонигДатаИсточник

В следующем примере `::SQLConfigDataSource` используется функция ODBC API для создания нового источника данных Excel под названием New Excel Data Source:

```
SQLConfigDataSource(NULL,ODBC_ADD_DSN, "Excel Files (*.xls)",
                   "DSN=New Excel Data Source\0"
                   "Description=New Excel Data Source\0"
                   "FileType=Excel\0"
                   "DataDirectory=C:\\EXCELDIR\0"
                   "MaxScanRows=20\0");
```

Обратите внимание, что источник данных на самом деле является каталогом (C: EXCELDIR); этот каталог должен существовать. Драйвер Excel использует каталоги в качестве источников данных и файлов в качестве отдельных таблиц (одна таблица для файла .xls).

Для получения дополнительной информации о создании таблиц [см. Источник данных: Программное создание таблицы в источнике данных ODBC](../../data/odbc/data-source-programmatically-creating-a-table-in-an-odbc-data-source.md).

Ниже приводится информация о параметрах, которые `::SQLConfigDataSource` необходимо передать функции ODBC API. Для `::SQLConfigDataSource`использования необходимо включить файл заголовка Odbcinst.h и использовать библиотеку импорта Odbcinst.lib. Кроме того, Odbccp32.dll должен быть в пути во время выполнения (или Odbcinst.dll для 16 бит).

Вы можете создать имя источника данных ODBC с помощью администратора ODBC или аналогичной утилиты. Однако иногда желательно создать имя источника данных непосредственно из приложения, чтобы получить доступ, не требуя от пользователя запуска отдельной утилиты.

Администратор ODBC (обычно установленный в панели управления) создает новый источник данных, помещая записи в реестр Windows (или, на 16 бит, в файл odbc.ini). Диспетчер драйверов ODBC запрашивает этот файл для получения необходимой информации об источнике данных. Важно знать, какая информация должна быть помещена в реестр, потому `::SQLConfigDataSource`что вы должны предоставить его с вызовом .

Хотя эта информация может быть записана непосредственно в реестр без использования, `::SQLConfigDataSource`любое приложение, которое делает это, опирается на текущий метод, который менеджер драйвера использует для поддержания своих данных. Если более поздний пересмотр менеджера драйверов ODBC по-другому реализует учет источников данных, любое приложение, использующее этот метод, нарушается. Как правило, рекомендуется использовать функцию API, когда она предоставляется. Например, ваш код является портативным от 16 бит `::SQLConfigDataSource` до 32 бит, если вы используете функцию, потому что функция правильно пишет в файл Odbc.ini или в реестр.

## <a name="sqlconfigdatasource-parameters"></a><a name="_core_sqlconfigdatasource_parameters"></a>Параметры S'LConfigDataИсточник

Ниже объясняется параметры функции. `::SQLConfigDataSource` Большая часть информации взята из *справки программиста* ODBC API, поставляемой с визуальной версией 1.5 и позже.

### <a name="function-prototype"></a><a name="_core_function_prototype"></a>Прототип функции

```
BOOL SQLConfigDataSource(HWND hwndParent,UINT fRequest, LPCSTR lpszDriver, LPCSTR lpszAttributes);
```

### <a name="remarks"></a>Remarks

#### <a name="parameters-and-usage"></a><a name="_core_parameters_and_usage"></a>Параметры и использование

*hwndParent*<br/>
Окно, указанное в качестве владельца любых диалоговых коробок, которые создает либо диспетчер драйвера ODBC, либо конкретный драйвер ODBC для получения дополнительной информации от пользователя о новом источнике данных. Если параметр *lpszAttributes* не дает достаточноинформации, появляется диалоговая коробка. Параметр *hwndParent* может быть NULL.

*lpszDriver*<br/>
Описание драйвера. Это имя, представленное пользователям, а не физическое имя драйвера (DLL).

*lpszАтрибуты*<br/>
Список атрибутов в виде "keyname-value". Эти строки разделены нулевыми терминаторами с двумя последовательными терминаторами в конце списка. Эти атрибуты в основном являются записями драйверов по умолчанию, которые входят в реестр для нового источника данных. Одним из важных ключевых моментов, которые не упоминаются в ссылке ODBC API для этой функции, является "DSN" ("имя источника данных"), в котором указывается название нового источника данных. Остальные записи специфичны для драйвера для нового источника данных. Часто нет необходимости поставлять все записи, потому что драйвер может подсказать пользователю диалоговые коробки для новых значений. (Установить *hwndParent* null, чтобы вызвать это.) Возможно, вы захотите явно предоставить значения по умолчанию, чтобы пользователь не был предложен.

#### <a name="to-determine-the-description-of-a-driver-for-the-lpszdriver-parameter-using-odbc-administrator"></a>Определить описание драйвера для параметра lpszDriver с помощью администратора ODBC

1. Выполнить администраторODБ.

1. Нажмите кнопку **Добавить**.

Это дает вам список установленных драйверов и их описания. Используйте это описание в качестве параметра *lpszDriver.* Обратите внимание, что вы используете все описание, например "Excel Files ('.xls)», включая расширение имени файла и скобки, если они существуют в описании.

В качестве альтернативы можно изучить реестр (или, за 16 бит, файл Odbcinst.ini), который содержит список всех записей и описаний драйверов в разделе "Драйверы ODBC" (или раздел "OdBC Драйверы" в Odbcinst.ini).

Одним из способов поиска ключевых имен и значений для параметра *lpszAttributes* является изучение файла Odbc.ini для уже настроенного источника данных (возможно, настроенного администратором ODBC).

#### <a name="to-find-keynames-and-values-for-the-lpszattributes-parameter"></a>Поиск ключевых имен и значений для параметра lpszAttributes

1. Выполнить редактор реестра Windows (или, для 16 бит, открыть файл Odbc.ini).

1. Найти информацию об источниках данных ODBC, используя одно из следующих:

   - Для 32 бита, найти ключевой **HKEY_CURRENT_USER»Software »ODBC.ODBC. Источники данных ИНИЗБК** в левом стеле.

      Правое стекло перечисляет записи формы: "pub: REG_SZ:*\<имя источника данных>*", где * \<имя источника данных>* является источником данных, который уже был настроен с желаемыми настройками для драйвера, который вы собираетесь использовать. Выберите нужный источник данных, например, сервер S'L. Элементы, следующие за строкой "pub:" являются, по порядку, ключевым именем и значением для использования в параметре *lpszAttributes.*

   - Для 16 битов, найти раздел в файле Odbc.ini отмечены*\<именем источника данных>. *

      Строки, следующие за этой строкой, имеют форму "keyname-value". Это именно записи для использования в параметре *lpszAttributes.*

Вы также можете изучить документацию для конкретного драйвера, который вы собираетесь использовать. Вы можете найти полезную информацию в онлайн Справка для водителя, который вы можете получить доступ, запустив АДМИНИСТРАТОРODБ. Эти файлы справки обычно помещаются в каталог WINDOWS-SYSTEM для Windows NT, Windows 3.1 или Windows 95.

#### <a name="to-obtain-online-help-for-your-odbc-driver"></a>Чтобы получить онлайн Справку для драйвера ODBC

1. Выполнить администраторODБ.

1. Нажмите кнопку **Добавить**.

1. Выберите имя драйвера.

1. Нажмите кнопку **ОК**.

Когда администратор ODBC отображает информацию для создания нового источника данных для конкретного драйвера, нажмите **Справка.** Это открывает файл справки для конкретного драйвера, который обычно содержит важную информацию об использовании драйвера.

## <a name="see-also"></a>См. также раздел

[Источник данных (ODBC)](../../data/odbc/data-source-odbc.md)
