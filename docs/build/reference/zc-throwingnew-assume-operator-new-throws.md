---
title: /Zc:throwingNew (новые исключения оператора assume)
ms.date: 03/01/2018
f1_keywords:
- throwingNew
- /Zc:throwingNew
helpviewer_keywords:
- -Zc compiler options (C++)
- throwingNew
- Assume operator new Throws
- /Zc compiler options (C++)
- Zc compiler options (C++)
ms.assetid: 20ff0101-9677-4d83-8c7b-8ec9ca49f04f
ms.openlocfilehash: 7593107a280995145d252efa76e0a88bddbd2275
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87211870"
---
# <a name="zcthrowingnew-assume-operator-new-throws"></a>/Zc:throwingNew (новые исключения оператора assume)

Если указан параметр **/Zc: throwingNew** , компилятор оптимизирует вызовы, `operator new` чтобы пропускать проверки для возврата пустого указателя. Этот параметр указывает компилятору на то, что все связанные реализации `operator new` и пользовательские распределительы соответствуют стандарту C++ и вызывают ошибку выделения памяти. По умолчанию в Visual Studio компилятор пессимистикалли создает проверки NULL (**/Zc: throwingNew-**) для этих вызовов, так как пользователи могут связываться с реализацией `operator new` или создавать пользовательские подпрограммы распределителя, возвращающие указатели NULL.

## <a name="syntax"></a>Синтаксис

> **/Zc: throwingNew**[ **-** ]

## <a name="remarks"></a>Remarks

С ISO C++ 98 стандартом задано, что оператор по умолчанию [New](../../standard-library/new-operators.md#op_new) вызывает исключение `std::bad_alloc` при сбое выделения памяти. Версии Visual C++ до Visual Studio 6,0 вернули пустой указатель на ошибку выделения. Начиная с Visual Studio 2002, `operator new` соответствует стандарту и вызывает ошибку. Для поддержки кода, использующего старый стиль выделения, Visual Studio предоставляет возможность компоновки `operator new` в носровнев. obj, которая возвращает указатель null при сбое. По умолчанию компилятор также создает защищенные проверки NULL, чтобы предотвратить немедленный сбой в работе распределительов старых версий. Параметр **/Zc: throwingNew** предписывает компилятору оставлять эти проверки значений NULL, предполагая, что все связанные распределительы памяти соответствуют стандарту. Это не относится к явным невызывающим `operator new` перегрузкам, которые объявляются с помощью дополнительного параметра типа `std::nothrow_t` и имеют явную **`noexcept`** спецификацию.

По сути, для создания объекта в бесплатном хранилище компилятор создает код для выделения памяти, а затем вызывает его конструктор для инициализации памяти. Так как компилятор КОМПИЛЯТОРОМ MSVC обычно не может определить, будет ли этот код привязан к несогласованному механизму, по умолчанию он также создает проверку значения null перед вызовом конструктора. Это предотвращает разыменование пустого указателя в вызове конструктора в случае сбоя выделения без вызова. В большинстве случаев эти проверки не требуются, так как распределитель по умолчанию выдает `operator new` исключение, а не возвращает пустые указатели. Проверки также имеют побочные эффекты. Они выдавали размер кода, они переполняют прогнозируемый прогноз и препятствуют другим полезным средствам оптимизации компилятора, таким как Девиртуализация или постоянное распространение из инициализированного объекта. Проверки существуют только для поддержки кода, который ссылается на *носровнев. obj* или имеет пользовательские несогласованные `operator new` реализации. Если вы не используете несоответствие `operator new` , мы рекомендуем использовать **/Zc: throwingNew** для оптимизации кода.

Параметр **/Zc: throwingNew** отключен по умолчанию и не влияет на параметр [/permissive-](permissive-standards-conformance.md) .

При компиляции с помощью создания кода во время компоновки (LTCG) не нужно указывать параметр **/Zc: throwingNew**. При компиляции кода с помощью LTCG компилятор может определить, используется ли по умолчанию, согласованная `operator new` реализация. Если это так, компилятор автоматически снимает проверки NULL. Компоновщик ищет флаг **/сровингнев** , чтобы определить, является ли реализация `operator new` согласованной. Этот флаг можно задать для компоновщика, включив эту директиву в источник для создания собственной реализации оператора.

```cpp
#pragma comment(linker, "/ThrowingNew")
```

Дополнительные сведения о вопросах соответствия в Visual C++ см. в статье [Nonstandard Behavior](../../cpp/nonstandard-behavior.md).

## <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. В раскрывающемся меню **Конфигурация** выберите пункт **все конфигурации**.

1. Выберите страницу свойств **Свойства конфигурации**  >  **C/C++**  >  **Командная строка** .

1. Измените свойство **Дополнительные параметры** , чтобы включить **/Zc: throwingNew** или **/Zc: ThrowingNew-** и нажмите кнопку **ОК**.

## <a name="see-also"></a>См. также раздел

[Параметры компилятора MSVC](compiler-options.md)<br/>
[Синтаксис командной строки компилятора КОМПИЛЯТОРОМ MSVC](compiler-command-line-syntax.md)<br/>
[/Zc (соответствие)](zc-conformance.md)<br/>
[noexcept (C++)](../../cpp/noexcept-cpp.md)<br/>
[Спецификации исключений (throw) (C++)](../../cpp/exception-specifications-throw-cpp.md)<br/>
[завершить (исключение)](../../standard-library/exception-functions.md#terminate)<br/>
