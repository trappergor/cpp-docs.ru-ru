---
title: Общие сведения о x64 соглашения о вызовах | Документация Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-tools
ms.topic: conceptual
dev_langs:
- C++
ms.assetid: a05db5eb-0844-4d9d-8b92-b1b2434be0ea
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: e70f4017cb31fcc76b1cf3ef2a77d3a28e31bd28
ms.sourcegitcommit: 92f2fff4ce77387b57a4546de1bd4bd464fb51b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2018
ms.locfileid: "45707997"
---
# <a name="overview-of-x64-calling-conventions"></a>Общие сведения о соглашениях о вызовах для архитектуры x64

Два важных отличия между x86 и x64 является возможность адресации 64-разрядных и плоский набор 16 64-битных регистров общего назначения. Имея набор развернутой регистров, использует x64 [__fastcall](../cpp/fastcall.md) соглашение о вызовах и модель обработки исключений RISC-архитектуры. `__fastcall` Соглашение использует регистры для первых четырех аргументов и кадр стека для передачи дополнительных аргументов.

Следующий параметр компилятора помогает оптимизировать приложение для x64:

- [/favor (оптимизация для особенностей архитектуры)](../build/reference/favor-optimize-for-architecture-specifics.md)

## <a name="calling-convention"></a>Соглашение о вызовах

По умолчанию x64 используемых четыре register fast-соглашения о вызовах с двоичным интерфейсом приложений (ABI). Пространство выделяется в стеке вызовов в качестве теневого хранилища для вызывающих объектов для сохранения этих регистров. Есть точное однозначное соответствие между аргументы для вызова функции и регистров, используемых для этих аргументов. Любой аргумент, который не умещается в 8 байт, или не 1, 2, 4 или 8 байт должны передаваться по ссылке. Нет не пытается распределить по нескольким регистрам один аргумент. X87 стек регистра не используется. Он может использоваться вызываемым объектом, но должен быть временным при вызове функций. Число с плавающей запятой, все операции выполняются с помощью 16 регистров XMM. Целочисленные аргументы передаются в регистры RCX, RDX, R8 и R9. Число с плавающей запятой, что аргументы передаются в XMM0L, XMM1L, XMM2L и XMM3L. 16-байтовый аргументы передаются по ссылке. Передача параметров описан подробно [передача параметров](../build/parameter-passing.md). Регистры RAX, R10, R11, XMM4 и XMM5 считаются временными. Все остальные регистры являются долговременного. Использование регистров описан подробно [зарегистрировать использование](../build/register-usage.md) и ["Вызывающий/вызываемый" сохранен регистрирует](../build/caller-callee-saved-registers.md).

Вызывающий объект отвечает за выделение пространства для параметров в вызываемый объект и всегда должен выделить достаточно места для хранения четырех параметров, даже если вызываемый объект не принимает такое количество параметров. Это упрощает поддержку функции без прототипа языка C и функции C/C++ с переменным количеством аргументов. Для функций с переменным количеством аргументов или без прототипа, любое число с плавающей запятой значения должны дублироваться в соответствующем регистре общего назначения. Любые параметры, за первые четыре должны храниться в стеке, выше в хранилище теневых для первые четыре, до вызова метода. Сведения о функции с переменным количеством аргументов можно найти в [Varargs](../build/varargs.md). Сведения о функции без прототипа подробно описана в [функции без прототипа](../build/unprototyped-functions.md).

## <a name="alignment"></a>Выравнивание

Большинство структур выровнены естественным выравниванием. Главными исключениями являются указатель стека и `malloc` или `alloca` памяти, что выравниваются по 16 байт для сохранения производительности. Выравнивание свыше 16 байт, которые должны выполняться вручную, но поскольку 16 байт общее выравнивание размера для операций XMM, это должно работать для большей части кода. Дополнительные сведения о структуре и выравнивании см. в разделе [типы и хранилище](../build/types-and-storage.md). Сведения о стеке, см. в разделе [использование стека](../build/stack-usage.md).

## <a name="unwindability"></a>Способность очищаться

Конечный это функции, которые не изменяются любые неизменяемые регистры. Функция неконечных может измениться долговременного RSP, например, путем вызова функции или выделения дополнительных стекового пространства для локальных переменных. Чтобы восстановить неизменяемые регистры, когда исключение обрабатывается, неконечных функции должно быть помечено атрибутом статических данных, описывающий, каким образом выполнять функции в строке произвольные команды. Эти данные хранятся в виде *pdata*, или данные процедуры, которые в свою очередь ссылается на *xdata*, обработки данных исключения. Xdata со сведениями, очистки и может указывать на дополнительные pdata или функцию-обработчик. Прологи и эпилоги становятся сильно ограничено, так что они могут быть правильно описаны в xdata. Указатель стека должен быть выровнен по 16 байт в любой области кода, который не является частью эпилога или пролога, за исключением в конечным функциям. Конечным функциям можно развернута просто имитируя возврата, pdata и xdata не являются обязательными. Дополнительные сведения о структуре функция Прологи и эпилоги, см. в разделе [пролога и эпилога](../build/prolog-and-epilog.md). Дополнительные сведения об обработке исключений и обработки исключений и очистке pdata и xdata см. в разделе [(x64) обработка исключений](../build/exception-handling-x64.md).

## <a name="see-also"></a>См. также

[Программные соглашения для X64](../build/x64-software-conventions.md)