---
title: Практическое руководство. Добавление пользовательского этапа сборки в проекты MSBuild
ms.date: 10/16/2019
helpviewer_keywords:
- 'msbuild (c++), howto: add a custom build step'
ms.assetid: a20a0c47-4df4-4754-a1f0-a94a99958916
ms.openlocfilehash: 78d40a5b4a02fe9b065bbbdde33afc6180d75381
ms.sourcegitcommit: 9aab425662a66825772f091112986952f341f7c8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2019
ms.locfileid: "72444920"
---
# <a name="how-to-add-a-custom-build-step-to-msbuild-projects"></a>Практическое руководство. Добавление пользовательского этапа сборки в проекты MSBuild

Настраиваемый этап сборки — это этап, определяемый пользователем. Настраиваемый этап сборки выполняется так же, как и любой другой этап *программы командной строки*, например стандартный этап компиляции или компоновки.

Задайте настраиваемый этап сборки в файле проекта (VCXPROJ). В этом этапе можно указать командную строку для выполнения, любые дополнительные входные или выходные файлы, а также отображаемые сообщения. Если средство **MSBuild** определяет, что выходные файлы устарели по отношению к входным, оно отображает соответствующее сообщение и выполняет команду.

Чтобы указать место настраиваемого этапа сборки в последовательности целей сборки, используйте в файле проекта один или оба XML-элемента `CustomBuildAfterTargets` и `CustomBuildBeforeTargets`. Например, можно указать, что настраиваемый этап сборки выполняется после цели средства компоновки и перед целью средства манифеста. Фактический набор доступных целей зависит от конкретной сборки.

Укажите элемент `CustomBuildBeforeTargets`, чтобы выполнять настраиваемый этап сборки перед запуском определенной цели. Укажите элемент `CustomBuildAfterTargets` для выполнения этапа после определенной цели. Укажите оба элемента для выполнения этапа между выполнением двух целей. Если элементы не указаны, настраиваемое средство сборки выполняется в расположении по умолчанию, которое находится после цели **Компоновка**.

Настраиваемые этапы сборки и настраиваемые инструменты сборки используют общие сведения, указанные в XML-элементах `CustomBuildBeforeTargets` и `CustomBuildAfterTargets`. Поэтому эти цели нужно указать в файле проекта один раз.

### <a name="to-define-what-is-executed-by-the-custom-build-step"></a>Определение действий, выполняемых настраиваемым этапом сборки

1. Добавьте группу свойств в файл проекта. В этой группе свойств укажите команду, ее входные и выходные данные, а также сообщение, как показано в приведенном ниже примере. В этом примере создается CAB-файл из файла main.cpp, созданного в [пошаговом руководстве по использованию MSBuild для создания проекта C++](walkthrough-using-msbuild-to-create-a-visual-cpp-project.md).

    ```
    <ItemDefinitionGroup>
      <CustomBuildStep>
        <Command>makecab.exe $(ProjectDir)main.cpp $(TargetName).cab</Command>
        <Outputs>$(TargetName).cab</Outputs>
        <Inputs>$(ProjectDir)main.cpp</Inputs>
      </CustomBuildStep>
    </ItemDefinitionGroup>
    ```

### <a name="to-define-where-in-the-build-the-custom-build-step-will-execute"></a>Определение места в сборке для выполнения настраиваемого этапа

1. Добавьте следующую группу свойств в файл проекта. Можно указать обе цели или опустить одну из них, если настраиваемый этап должен выполняться просто до или после определенной цели. В этом примере средству **MSBuild** предписывается выполнить настраиваемый этап после этапа компиляции, но до этапа компоновки.

    ```
    <PropertyGroup>
      <CustomBuildAfterTargets>ClCompile</CustomBuildAfterTargets>
      <CustomBuildBeforeTargets>Link</CustomBuildBeforeTargets>
    </PropertyGroup>
    ```

## <a name="see-also"></a>См. также

[Пошаговое руководство: Использование MSBuild для создания проекта C++](walkthrough-using-msbuild-to-create-a-visual-cpp-project.md)<br/>
[Практическое руководство. Использование событий сборки в проектах MSBuild](how-to-use-build-events-in-msbuild-projects.md)<br/>
[Практическое руководство. Добавление пользовательских средств сборки в проекты MSBuild](how-to-add-custom-build-tools-to-msbuild-projects.md)
