---
title: Практическое руководство. Добавление настраиваемых инструментов сборки в проекты MSBuild
ms.date: 11/04/2016
helpviewer_keywords:
- 'msbuild (c++), howto: add custom build tools'
ms.assetid: de03899a-371d-4396-9bf9-34f45a65e909
ms.openlocfilehash: 812932d9e668ab5ee0eb75eadbf75be3d791cddb
ms.sourcegitcommit: da32511dd5baebe27451c0458a95f345144bd439
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2019
ms.locfileid: "65220721"
---
# <a name="how-to-add-custom-build-tools-to-msbuild-projects"></a>Практическое руководство. Добавление настраиваемых инструментов сборки в проекты MSBuild

Настраиваемый инструмент сборки — это определяемое пользователем средство командной строки, связанное с конкретным файлом.

Можно указать конкретный файл проекта (VCPROJ), который будет выполняться в командной строке, а также любые дополнительные входные или выходные файлы и отображаемые сообщения. Если средство **MSBuild** определяет, что выходные файлы устарели по отношению к входным файлам, оно отображает соответствующее сообщение и выполняет программу командной строки.

Чтобы указать место выполнения настраиваемого инструмента сборки, используйте в файле проекта один или оба XML-элемента `CustomBuildBeforeTargets` и `CustomBuildAfterTargets`. Например, можно указать, что настраиваемый инструмент сборки будет выполняться после компилятора MIDL и перед компилятором C/C++. Укажите элемент `CustomBuildBeforeTargets`, чтобы выполнять средство перед запуском определенного целевого объекта. Укажите элемент `CustomBuildAfterTargets` для выполнения средства после определенного целевого объекта. Укажите оба элемента для запуска средства между выполнением двух целевых объектов. Если элементы не указаны, настраиваемый инструмент сборки выполняется в расположении по умолчанию, которое находится до целевого объекта **MIDL**.

Настраиваемые этапы сборки и настраиваемые инструменты сборки используют общие сведения, указанные в XML-элементах `CustomBuildBeforeTargets` и `CustomBuildAfterTargets`. Эти целевые объекты нужно указать в файле проекта один раз.

### <a name="to-add-a-custom-build-tool"></a>Добавление настраиваемого инструмента сборки

1. Добавьте группу элементов в файл проекта и добавьте элемент для каждого входного файла. Укажите команду, дополнительные входные и выходные данные и сообщение в качестве метаданных элемента, как показано ниже. В этом примере предполагается, что файл с именем "faq.txt" существует в том же каталоге, что и проект.

    ```
    <ItemGroup>
      <CustomBuild Include="faq.txt">
        <Message>Copying readme...</Message>
        <Command>copy %(Identity) $(OutDir)%(Identity)</Command>
        <Outputs>$(OutDir)%(Identity)</Outputs>
      </CustomBuild>
    </ItemGroup>
    ```

### <a name="to-define-where-in-the-build-the-custom-build-tools-will-execute"></a>Определение места в сборке для выполнения настраиваемых инструментов сборки

1. Добавьте следующую группу свойств в файл проекта. Если нужно, чтобы шаг сборки выполнялся только до (или после) определенного целевого объекта, необходимо указать хотя бы один из целевых объектов. В этом примере настраиваемый шаг выполняется после компиляции, но перед компоновкой.

    ```
    <PropertyGroup>
      <CustomBuildAfterTargets>ClCompile</CustomBuildAfterTargets>
      <CustomBuildBeforeTargets>Link</CustomBuildBeforeTargets>
    </PropertyGroup>
    ```

## <a name="see-also"></a>См. также

[Пошаговое руководство: Использование MSBuild для создания проекта C++](walkthrough-using-msbuild-to-create-a-visual-cpp-project.md)<br/>
[Практическое руководство. Использование событий сборки в проектах MSBuild](how-to-use-build-events-in-msbuild-projects.md)<br/>
[Практическое руководство. Добавление пользовательского шага сборки в проекты MSBuild](how-to-add-a-custom-build-step-to-msbuild-projects.md)
