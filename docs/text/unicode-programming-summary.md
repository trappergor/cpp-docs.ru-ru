---
title: Общие сведения о программировании Юникода
ms.date: 11/04/2016
helpviewer_keywords:
- Unicode [C++], programming with
- Unicode [C++], MFC and C run-time functions
ms.assetid: a4c9770f-6c9c-447c-996b-980920288bed
ms.openlocfilehash: 5095e1c58db3e5c35eb9215367f2fbb064bc228a
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91504716"
---
# <a name="unicode-programming-summary"></a>Общие сведения о программировании Юникода

Чтобы воспользоваться преимуществами поддержки Юникода и времени выполнения C в Юникоде, необходимо выполнить следующие действия:

- Определите `_UNICODE` .

   Определите символ `_UNICODE` перед сборкой программы.

- Укажите точку входа.

   На странице **Дополнительно** в папке **Компоновщик** в диалоговом окне [страницы свойств](../build/reference/property-pages-visual-cpp.md) проекта задайте для символа **точки входа** значение `wWinMainCRTStartup` .

- Используйте переносимые функции и типы времени выполнения.

   Используйте подходящие функции времени выполнения языка C для обработки строк в Юникоде. Вы можете использовать `wcs` семейство функций, но вы можете предпочесть полностью переносимые (международные) `_TCHAR` макросы. Все эти макросы начинаются с префикса `_tcs` ; они заменяют, по одному, для `str` семейства функций. Эти функции подробно описаны в разделе [интернационализации](../c-runtime-library/internationalization.md) *справочника по библиотеке времени выполнения*. Дополнительные сведения см. [в разделе Универсальные текстовые сопоставления в файле Tchar. h](../text/generic-text-mappings-in-tchar-h.md).

   Используйте `_TCHAR` и связанные переносимые типы данных, описанные в разделе [Поддержка Юникода](../text/support-for-unicode.md).

- Правильно обрабатывайте литеральные строки.

   Компилятор Visual C++ интерпретирует литеральную строку, закодированную следующим образом:

    ```cpp
    L"this is a literal string"
    ```

   значение для обозначения строки символов Юникода. Для литеральных символов можно использовать один и тот же префикс. Используйте `_T` макрос для универсального кода строковых литералов, чтобы они были скомпилированы в виде строк Юникода в Юникоде или в виде строк ANSI (включая MBCS) без Юникода. Например, вместо:

    ```cpp
    pWnd->SetWindowText( "Hello" );
    ```

   использует

    ```cpp
    pWnd->SetWindowText( _T("Hello") );
    ```

   `_UNICODE`Если задано, `_T` преобразует литеральную строку в форму с префиксом l. в противном случае `_T` преобразует строку без префикса l.

    > [!TIP]
    >  `_T`Макрос идентичен `_TEXT` макросу.

- Будьте внимательны при передаче в функции длины строк.

   Некоторые функции должны иметь количество символов в строке; для других требуется число байтов. Например, если `_UNICODE` определено, следующий вызов `CArchive` объекта не будет работать ( `str` — `CString` ):

    ```cpp
    archive.Write( str, str.GetLength( ) );    // invalid
    ```

   В приложении, поддерживающем Юникод, длина дает число символов, но не правильное число байтов, так как каждый символ имеет ширину 2 байта. Вместо этого необходимо использовать:

    ```cpp
    archive.Write( str, str.GetLength( ) * sizeof( _TCHAR ) );    // valid
    ```

   , который указывает правильное число байтов для записи.

   Однако функции-члены MFC, ориентированные на символьные, а не ориентированные на байт, работают без этого дополнительного кода:

    ```cpp
    pDC->TextOut( str, str.GetLength( ) );
    ```

   `CDC::TextOut` принимает несколько символов, а не число байтов.

- Используйте [fopen_s, _wfopen_s,](../c-runtime-library/reference/fopen-s-wfopen-s.md) чтобы открыть файлы в Юникоде.

В итоге MFC и библиотека времени выполнения обеспечивают следующую поддержку программирования Юникода:

- За исключением функций-членов класса базы данных, все функции MFC поддерживаются с поддержкой Юникода, включая `CString` . `CString` также предоставляет функции преобразования в Юникоде и ANSI.

- Библиотека времени выполнения предоставляет версии Юникода для всех функций обработки строк. (Библиотека времени выполнения также предоставляет переносимые версии, пригодные для Юникода или для MBCS. Это `_tcs` макросы.)

- TCHAR. h предоставляет переносимые типы данных и `_T` макрос для преобразования строковых литералов и символов. Дополнительные сведения см. [в разделе Универсальные текстовые сопоставления в файле Tchar. h](../text/generic-text-mappings-in-tchar-h.md).

- Библиотека времени выполнения предоставляет версию для расширенных символов `main` . Используйте `wmain` , чтобы сделать приложение совместимым с Юникодом.

## <a name="see-also"></a>См. также раздел

[Поддержка Юникода](../text/support-for-unicode.md)
