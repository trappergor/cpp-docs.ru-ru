---
title: С помощью Tchar см. Типы данных H с кодом _MBCS | Документация Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-windows
ms.topic: conceptual
f1_keywords:
- tchar.h
- TCHAR
dev_langs:
- C++
helpviewer_keywords:
- mapping generic-text
- generic-text data types [C++]
- generic-text mappings [C++]
- MBCS [C++], generic-text mappings
- TCHAR.H data types, mapping
- mappings [C++], TCHAR.H
ms.assetid: 298583c5-22c3-40f6-920e-9ec96d42abd8
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: 6a52dded31c1037130a9e4ee6182003f522c062d
ms.sourcegitcommit: 799f9b976623a375203ad8b2ad5147bd6a2212f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/19/2018
ms.locfileid: "46372059"
---
# <a name="using-tcharh-data-types-with-mbcs-code"></a>Использование типов данных TCHAR.H с кодом _MBCS

Когда константа манифеста `_MBCS` будет определен, каждая универсальная текстовая подпрограмма сопоставляются одного из следующих видов:

- Подпрограмма для однобайтовой кодировки, которая правильно обрабатывает многобайтовые символы и строки. В этом случае ожидается, что строковые аргументы будут иметь тип `char*`. Например, функция `_tprintf` сопоставляется с функцией `printf`; строковые аргументы функции `printf` имеют тип `char*`. При использовании универсального строкового типа данных `_TCHAR` типы формальных и фактических параметров функции `printf` совпадают, потому что `_TCHAR*` сопоставляется с `char*`.

- Подпрограмма, специально созданная для многобайтовой кодировки. В этом случае ожидается, что строковые аргументы будут иметь тип `unsigned char*`. Например, функция `_tcsrev`сопоставляется с функцией `_mbsrev`, которая ожидает и возвращает строку типа `unsigned char*`. Если вы используете `_TCHAR` тип текстовых данных для строкового есть вероятность конфликта типов, так как `_TCHAR` сопоставляется с типом `char`.

Есть три способа предотвратить такой конфликт типов (и избежать предупреждений компилятора C или ошибок компиляции C++).

- Использовать поведение по умолчанию. Файл Tchar.h содержит прототипы универсальных текстовых подпрограмм в библиотеках времени выполнения, как показано в следующем примере.

    ```cpp
    char * _tcsrev(char *);
    ```

   В случае по умолчанию прототип для `_tcsrev` сопоставляется `_mbsrev` через преобразователь в Libc.lib. Это изменяет типы `_mbsrev` входного параметра и результата возвращения значения из `_TCHAR*` (то есть `char *`) для `unsigned char *`. Этот метод гарантирует соответствие типов при использовании `_TCHAR`, но он является сравнительно медленным из-за дополнительного вызова функции.

- Использовать встраивание функций, включив в код следующую инструкцию препроцессора.

    ```cpp
    #define _USE_INLINING
    ```

   Этот метод вызывает встроенный преобразователь функции, реализованный в файле Tchar.h, сопоставляется универсальная текстовая подпрограмма непосредственно на соответствующую MBCS-подпрограмму. Следующий фрагмент кода из Tchar.h иллюстрирует, как это делается.

    ```cpp
    __inline char *_tcsrev(char *_s1)
    {return (char *)_mbsrev((unsigned char *)_s1);}
    ```

   Это решение будет оптимальным, если используется встраивание, поскольку гарантирует соответствие типов и не замедляет работу.

- Используйте прямое сопоставление путем включения в код следующей инструкции препроцессора.

    ```cpp
    #define _MB_MAP_DIRECT
    ```

   Такой подход позволяет быстро решить проблему, если вы не хотите использовать поведение по умолчанию или не можете использовать встраивание. Это вызывает универсальная текстовая подпрограмма сопоставляются через макрос непосредственно на MBCS-версию подпрограммы, как в следующем примере из Tchar.h.

    ```cpp
    #define _tcschr _mbschr
    ```

   При использовании этого подхода Будьте внимательны, чтобы обеспечить использование соответствующие типы данных для строковых аргументов и возвращаемых значений строки. Можно воспользоваться явным приведением типов, чтобы гарантировать соответствие типов, либо универсальным строковым типом данных `_TXCHAR`. `_TXCHAR` сопоставляется с типом **char** в коде с однобайтовой Кодировкой, но сопоставляется с типом **unsigned char** в коде с многобайтовой Кодировкой. Дополнительные сведения об универсальных текстовых макросах см. в разделе [универсальные текстовые сопоставления](../c-runtime-library/generic-text-mappings.md) в *Справочник по библиотеке времени выполнения*.

## <a name="see-also"></a>См. также

[Универсальные текстовые сопоставления в файле Tchar.h](../text/generic-text-mappings-in-tchar-h.md)