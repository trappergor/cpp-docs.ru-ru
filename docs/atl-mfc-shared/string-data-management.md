---
title: Управление строковыми данными
ms.date: 11/04/2016
helpviewer_keywords:
- Unicode, string objects
ms.assetid: 0b53a542-eeb1-4108-9ada-6700645b6f8f
ms.openlocfilehash: 2da8967effeb6ff439cf5b3cece31f63ee77a761
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87219044"
---
# <a name="string-data-management"></a>Управление строковыми данными

Visual C++ предоставляет несколько способов управления строковыми данными:

- [Обработка строк](../c-runtime-library/string-manipulation-crt.md) для работы с строками с завершающим нулем в стиле C

- Функции API Win32 для управления строками

- Класс MFC Class [CStringT](../atl-mfc-shared/reference/cstringt-class.md), предоставляющий гибкие масштабируемые объекты String

- Класс [CStringT](../atl-mfc-shared/reference/cstringt-class.md), предоставляющий независимый от MFC строковый объект с теми же функциональными возможностями, что и`CString`

Почти все программы работают с строковыми данными. Класс MFC `CString` часто является лучшим решением для гибкой обработки строк. Начиная с версии 7,0, `CString` можно использовать программы, независимые от MFC или MFC. Библиотека времени выполнения и `CString` строки поддержки, содержащие многобайтовые (широкие) символы, как в программировании в Юникоде или МНОГОбайтовой кодировке.

В этой статье описываются службы общего назначения, которые библиотека классов предоставляет для операций со строками. В этой статье рассматриваются следующие темы:

- [Юникод и многобайтовая кодировка обеспечивают переносимость](#_core_unicode_and_mbcs_provide_portability)

- [Указатели CString и const char](#_core_cstrings_and_const_char_pointers)

- [Подсчет ссылок CString](#_core_cstring_reference_counting)

Класс [класса CStringT](../atl-mfc-shared/reference/cstringt-class.md) обеспечивает поддержку управления строками. Он предназначен для замены и расширения функциональных возможностей, обычно предоставляемых строковым пакетом библиотеки времени выполнения C. `CString`Класс предоставляет функции и операторы элементов для упрощения обработки строк, аналогичные тем, которые находятся в базовых. Класс также предоставляет конструкторы и операторы для создания, присваивания и сравнения `CString` строк и стандартных типов данных C++. Поскольку `CString` не является производным от `CObject` , объекты можно использовать `CString` независимо от большинства Библиотека Microsoft Foundation Class (MFC).

`CString`объекты следуют за семантикой значений. `CString`Объект представляет уникальное значение. Представьте себе `CString` как фактическую строку, а не указатель на строку.

`CString`Объект представляет последовательность с переменным числом символов. `CString`объекты можно рассматривать как массивы символов.

## <a name="unicode-and-mbcs-provide-portability"></a><a name="_core_unicode_and_mbcs_provide_portability"></a>Юникод и многобайтовая кодировка обеспечивают переносимость

В MFC версии 3,0 и более поздних версиях MFC, включая `CString` , включены как для кодировки Юникод, так и для многобайтовых кодировок. Эта поддержка упрощает написание переносимых приложений, которые можно создать для символов Юникода или ANSI. Чтобы обеспечить эту переносимость, каждый символ в `CString` объекте имеет тип TCHAR, который определяется так, как **`wchar_t`** если бы вы определили символ _UNICODE при построении приложения или как **`char`** Если нет. **`wchar_t`** Символ имеет ширину 16 бит. Многобайтовая кодировка включается при построении с использованием символа _MBCS определенного. Сама библиотека MFC строится с помощью _MBCS символа (для библиотек НАФКС) или _UNICODEного символа (для библиотек УАФКС).

> [!NOTE]
> В `CString` примерах из этой и сопровождающих статей о строках показаны литеральные строки, правильно отформатированные для переносимости в Юникоде, с помощью макроса _T, который преобразует литеральную строку в форму:

`L"literal string"`

> [!NOTE]
> который обрабатывается компилятором как строка Юникода. Например, приведенный ниже код

[!code-cpp[NVC_ATLMFC_Utilities#187](../atl-mfc-shared/codesnippet/cpp/string-data-management_1.cpp)]

> [!NOTE]
> преобразуется в строку Юникода, если _UNICODE определена, или как строка ANSI, если нет. Дополнительные сведения см. в статье [Поддержка Юникода и многобайтовой кодировки (MBCS)](../atl-mfc-shared/unicode-and-multibyte-character-set-mbcs-support.md).

`CString`Объект может хранить до INT_MAX (2 147 483 647) символов. Тип данных TCHAR используется для получения или задания отдельных символов внутри `CString` объекта. В отличие от массивов символов, `CString` класс имеет встроенную возможность выделения памяти. Это позволяет `CString` объектам автоматически увеличиваться по мере необходимости (т. е. не нужно беспокоиться о том, `CString` чтобы увеличивать объект в соответствии с более длинными строками).

## <a name="cstrings-and-const-char-pointers"></a><a name="_core_cstrings_and_const_char_pointers"></a>Указатели CString и const char

`CString`Объект также может действовать как литеральная строка в стиле C ( `PCXSTR` , которая аналогична **константе char** , <strong>\*</strong> если не используется Юникод). Оператор преобразования [ксимплестрингт:: operator пкксстр](../atl-mfc-shared/reference/csimplestringt-class.md#operator_pcxstr) позволяет `CString` свободно подставлять объекты для указателей символов в вызовах функций. Конструктор **CString (лпквстр** `pszSrc` **)** позволяет подставлять указатели символов для `CString` объектов.

Не предпринимается попытка выполнить свертывание `CString` объектов. Если вы представите два `CString` объекта `Chicago` , содержащие, например, символы в хранятся `Chicago` в двух местах. (Это может быть не так для будущих версий MFC, поэтому не следует зависеть от нее.)

> [!NOTE]
> Используйте функции-члены [ксимплестрингт::](../atl-mfc-shared/reference/csimplestringt-class.md#getbuffer) Ксимплестрингт и [:: релеасебуффер](../atl-mfc-shared/reference/csimplestringt-class.md#releasebuffer) , если требуется прямой доступ к `CString` как неконстантному указателю на символ.

> [!NOTE]
> Используйте функции-члены [CStringT:: аллоксисстринг](../atl-mfc-shared/reference/cstringt-class.md#allocsysstring) и [CStringT:: сетсисстринг](../atl-mfc-shared/reference/cstringt-class.md#setsysstring) для выделения и установки объектов BSTR, используемых в службе автоматизации (прежнее название — OLE Automation).

> [!NOTE]
> Там, где это возможно, выделяйте `CString` объекты в кадре, а не в куче. Это экономит память и упрощает передачу параметров.

`CString`Класс не реализуется как класс коллекции Библиотека Microsoft Foundation Class, хотя `CString` объекты можно хранить как элементы в коллекциях.

## <a name="cstring-reference-counting"></a><a name="_core_cstring_reference_counting"></a>Подсчет ссылок CString

Начиная с MFC версии 4,0 при копировании объектов [класса CStringT](../atl-mfc-shared/reference/cstringt-class.md) , MFC увеличивает счетчик ссылок, а не копирует данные. Это делает передачу параметров по значению и возвращает `CString` объекты по значению более эффективно. Эти операции вызывают вызов конструктора копии, иногда более одного раза. Увеличение числа ссылок сокращает затраты на эти распространенные операции и делает использование `CString` более привлекательного варианта.

При удалении каждой копии счетчик ссылок в исходном объекте уменьшается. Исходный `CString` объект не уничтожается до тех пор, пока значение счетчика ссылок не уменьшится до нуля.

`CString`Для отключения или включения подсчета ссылок можно использовать функции элементов [ксимплестрингт:: Локкбуффер](../atl-mfc-shared/reference/csimplestringt-class.md#lockbuffer) и [ксимплестрингт:: унлоккбуффер](../atl-mfc-shared/reference/csimplestringt-class.md#unlockbuffer) .

## <a name="see-also"></a>См. также раздел

[Общие разделы по MFC](../mfc/general-mfc-topics.md)
